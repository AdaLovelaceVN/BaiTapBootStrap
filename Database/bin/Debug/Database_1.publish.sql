/*
Deployment script for QuanLyKhoaHoc

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "QuanLyKhoaHoc"
:setvar DefaultFilePrefix "QuanLyKhoaHoc"
:setvar DefaultDataPath "C:\Program Files\Microsoft SQL Server\MSSQL12.MSSQLSERVER\MSSQL\DATA\"
:setvar DefaultLogPath "C:\Program Files\Microsoft SQL Server\MSSQL12.MSSQLSERVER\MSSQL\DATA\"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [master];


GO

IF (DB_ID(N'$(DatabaseName)') IS NOT NULL) 
BEGIN
    ALTER DATABASE [$(DatabaseName)]
    SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
    DROP DATABASE [$(DatabaseName)];
END

GO
PRINT N'Creating $(DatabaseName)...'
GO
CREATE DATABASE [$(DatabaseName)]
    ON 
    PRIMARY(NAME = [$(DatabaseName)], FILENAME = N'$(DefaultDataPath)$(DefaultFilePrefix)_Primary.mdf')
    LOG ON (NAME = [$(DatabaseName)_log], FILENAME = N'$(DefaultLogPath)$(DefaultFilePrefix)_Primary.ldf') COLLATE SQL_Latin1_General_CP1_CI_AS
GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ANSI_NULLS ON,
                ANSI_PADDING ON,
                ANSI_WARNINGS ON,
                ARITHABORT ON,
                CONCAT_NULL_YIELDS_NULL ON,
                NUMERIC_ROUNDABORT OFF,
                QUOTED_IDENTIFIER ON,
                ANSI_NULL_DEFAULT ON,
                CURSOR_DEFAULT LOCAL,
                RECOVERY FULL,
                CURSOR_CLOSE_ON_COMMIT OFF,
                AUTO_CREATE_STATISTICS ON,
                AUTO_SHRINK OFF,
                AUTO_UPDATE_STATISTICS ON,
                RECURSIVE_TRIGGERS OFF 
            WITH ROLLBACK IMMEDIATE;
        ALTER DATABASE [$(DatabaseName)]
            SET AUTO_CLOSE OFF 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ALLOW_SNAPSHOT_ISOLATION OFF;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET READ_COMMITTED_SNAPSHOT OFF 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET AUTO_UPDATE_STATISTICS_ASYNC OFF,
                PAGE_VERIFY NONE,
                DATE_CORRELATION_OPTIMIZATION OFF,
                DISABLE_BROKER,
                PARAMETERIZATION SIMPLE,
                SUPPLEMENTAL_LOGGING OFF 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF IS_SRVROLEMEMBER(N'sysadmin') = 1
    BEGIN
        IF EXISTS (SELECT 1
                   FROM   [master].[dbo].[sysdatabases]
                   WHERE  [name] = N'$(DatabaseName)')
            BEGIN
                EXECUTE sp_executesql N'ALTER DATABASE [$(DatabaseName)]
    SET TRUSTWORTHY OFF,
        DB_CHAINING OFF 
    WITH ROLLBACK IMMEDIATE';
            END
    END
ELSE
    BEGIN
        PRINT N'The database settings cannot be modified. You must be a SysAdmin to apply these settings.';
    END


GO
IF IS_SRVROLEMEMBER(N'sysadmin') = 1
    BEGIN
        IF EXISTS (SELECT 1
                   FROM   [master].[dbo].[sysdatabases]
                   WHERE  [name] = N'$(DatabaseName)')
            BEGIN
                EXECUTE sp_executesql N'ALTER DATABASE [$(DatabaseName)]
    SET HONOR_BROKER_PRIORITY OFF 
    WITH ROLLBACK IMMEDIATE';
            END
    END
ELSE
    BEGIN
        PRINT N'The database settings cannot be modified. You must be a SysAdmin to apply these settings.';
    END


GO
ALTER DATABASE [$(DatabaseName)]
    SET TARGET_RECOVERY_TIME = 0 SECONDS 
    WITH ROLLBACK IMMEDIATE;


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET FILESTREAM(NON_TRANSACTED_ACCESS = OFF),
                CONTAINMENT = NONE 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET AUTO_CREATE_STATISTICS ON(INCREMENTAL = OFF),
                MEMORY_OPTIMIZED_ELEVATE_TO_SNAPSHOT = OFF,
                DELAYED_DURABILITY = DISABLED 
            WITH ROLLBACK IMMEDIATE;
    END


GO
USE [$(DatabaseName)];


GO
IF fulltextserviceproperty(N'IsFulltextInstalled') = 1
    EXECUTE sp_fulltext_database 'enable';


GO
PRINT N'Creating [FTC_DANGKYDETAI_TenDeTai]...';


GO
CREATE FULLTEXT CATALOG [FTC_DANGKYDETAI_TenDeTai]
    AUTHORIZATION [dbo];


GO
PRINT N'Creating [FTC_NhanYeuCauLaySoLieu_TenDeTai]...';


GO
CREATE FULLTEXT CATALOG [FTC_NhanYeuCauLaySoLieu_TenDeTai]
    AUTHORIZATION [dbo];


GO
PRINT N'Creating [FTC_XetDuyet_HDDaoDuc]...';


GO
CREATE FULLTEXT CATALOG [FTC_XetDuyet_HDDaoDuc]
    AUTHORIZATION [dbo];


GO
PRINT N'Creating [dbo].[DANGKYDETAI]...';


GO
CREATE TABLE [dbo].[DANGKYDETAI] (
    [DeTaiID]             INT             IDENTITY (1, 1) NOT NULL,
    [MaDeTai]             NVARCHAR (1000) NULL,
    [TenDeTai]            NVARCHAR (1000) NULL,
    [ThucHienTuNgay]      DATE            NULL,
    [ThucHienDenNgay]     DATE            NULL,
    [KinhPhiThucHien]     MONEY           NULL,
    [NguonKinhPhiID]      INT             NULL,
    [CapQuanLy]           INT             NULL,
    [ThuocChuongTrinh]    NVARCHAR (1000) NULL,
    [ChuNhiemDeTaiID]     INT             NULL,
    [DongChuNhiemDeTaiID] INT             NULL,
    [DiaDiemTrienKhai]    NVARCHAR (1000) NULL,
    [CoQuanChuTri]        NVARCHAR (1000) NULL,
    [KhoaPhongID]         INT             NULL,
    [TinhTrangDeTaiID]    INT             NULL,
    [TrangThaiDeTai]      INT             NULL,
    [MucTieuDeTai]        NVARCHAR (1000) NULL,
    [NoiDungNghienCuu]    NVARCHAR (1000) NULL,
    [PhuongPhapNghienCuu] NVARCHAR (1000) NULL,
    [MucDoBaoMat]         INT             NULL,
    [LoaiDeTai]           INT             NULL,
    [UserID]              INT             NULL,
    [DeTaiNhanh]          BIT             NOT NULL,
    CONSTRAINT [PK_DANGKYDETAI_DeTaiID] PRIMARY KEY CLUSTERED ([DeTaiID] ASC)
);


GO
PRINT N'Creating [dbo].[DANGKYDETAI].[IX_DANGKYDETAI_NguonKinhPhiID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DANGKYDETAI_NguonKinhPhiID]
    ON [dbo].[DANGKYDETAI]([NguonKinhPhiID] ASC);


GO
PRINT N'Creating [dbo].[DANGKYDETAI].[IX_DANGKYDETAI_KhoaPhongID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DANGKYDETAI_KhoaPhongID]
    ON [dbo].[DANGKYDETAI]([KhoaPhongID] ASC);


GO
PRINT N'Creating [dbo].[DANGKYDETAI].[IX_DANGKYDETAI_TinhTrangDeTaiID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DANGKYDETAI_TinhTrangDeTaiID]
    ON [dbo].[DANGKYDETAI]([TinhTrangDeTaiID] ASC);


GO
PRINT N'Creating [dbo].[DANGKYDETAI].[IX_DANGKYDETAI_ChuNhiemDeTaiID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DANGKYDETAI_ChuNhiemDeTaiID]
    ON [dbo].[DANGKYDETAI]([ChuNhiemDeTaiID] ASC);


GO
PRINT N'Creating [dbo].[DANGKYDETAI].[IX_DANGKYDETAI_DongChuNhiemDeTaiID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DANGKYDETAI_DongChuNhiemDeTaiID]
    ON [dbo].[DANGKYDETAI]([DongChuNhiemDeTaiID] ASC);


GO
PRINT N'Creating [dbo].[DANGKYDETAI_CONGSUTHAMGIA]...';


GO
CREATE TABLE [dbo].[DANGKYDETAI_CONGSUTHAMGIA] (
    [CongSuThamGiaID] INT IDENTITY (1, 1) NOT NULL,
    [DeTaiID]         INT NULL,
    [CanBoThucHienID] INT NULL,
    CONSTRAINT [PK_DANGKYDETAI_CONGSUTHAMGIA_CongSuThamGiaID] PRIMARY KEY CLUSTERED ([CongSuThamGiaID] ASC)
);


GO
PRINT N'Creating [dbo].[DANGKYDETAI_CONGSUTHAMGIA].[IX_DANGKYDETAI_CONGSUTHAMGIA_DeTaiID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DANGKYDETAI_CONGSUTHAMGIA_DeTaiID]
    ON [dbo].[DANGKYDETAI_CONGSUTHAMGIA]([DeTaiID] ASC);


GO
PRINT N'Creating [dbo].[DANGKYDETAI_CONGSUTHAMGIA].[IX_DANGKYDETAI_CONGSUTHAMGIA_CanBoThucHienID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DANGKYDETAI_CONGSUTHAMGIA_CanBoThucHienID]
    ON [dbo].[DANGKYDETAI_CONGSUTHAMGIA]([CanBoThucHienID] ASC);


GO
PRINT N'Creating [dbo].[DANGKYDETAI_DETAINHANH]...';


GO
CREATE TABLE [dbo].[DANGKYDETAI_DETAINHANH] (
    [DeTaiNhanhID]    INT             IDENTITY (1, 1) NOT NULL,
    [GhiNhanKetQuaID] INT             NULL,
    [TenDeTaiNhanh]   NVARCHAR (1000) NULL,
    [CanBoThucHienID] INT             NULL,
    CONSTRAINT [PK_DANGKYDETAI_DETAINHANH_DeTaiNhanhID] PRIMARY KEY CLUSTERED ([DeTaiNhanhID] ASC)
);


GO
PRINT N'Creating [dbo].[DANGKYDETAI_DETAINHANH].[IX_DANGKYDETAI_DETAINHANH_GhiNhanKetQuaID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DANGKYDETAI_DETAINHANH_GhiNhanKetQuaID]
    ON [dbo].[DANGKYDETAI_DETAINHANH]([GhiNhanKetQuaID] ASC);


GO
PRINT N'Creating [dbo].[DANGKYDETAI_DETAINHANH].[IX_DANGKYDETAI_DETAINHANH_CanBoThucHienID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DANGKYDETAI_DETAINHANH_CanBoThucHienID]
    ON [dbo].[DANGKYDETAI_DETAINHANH]([CanBoThucHienID] ASC);


GO
PRINT N'Creating [dbo].[DANHMUC_CANBOTHUCHIEN]...';


GO
CREATE TABLE [dbo].[DANHMUC_CANBOTHUCHIEN] (
    [CanBoThucHienID]   INT             IDENTITY (1, 1) NOT NULL,
    [MaCanBoThucHien]   NVARCHAR (1000) NULL,
    [HoTen]             NVARCHAR (1000) NULL,
    [HocHamHocViID]     INT             NULL,
    [ChucDanhKhoaHocID] INT             NULL,
    [DiaChiCoQuan]      NVARCHAR (1000) NULL,
    [DienThoai]         NVARCHAR (1000) NULL,
    [DiaChiNhaRieng]    NVARCHAR (1000) NULL,
    [Email]             NVARCHAR (1000) NULL,
    [Fax]               NVARCHAR (1000) NULL,
    [GioiTinh]          BIT             NOT NULL,
    [ChucVuID]          INT             NULL,
    [KhoaPhongID]       INT             NULL,
    CONSTRAINT [PK_DANHMUC_CANBOTHUCHIEN_CanBoThucHienID] PRIMARY KEY CLUSTERED ([CanBoThucHienID] ASC)
);


GO
PRINT N'Creating [dbo].[DANHMUC_CANBOTHUCHIEN].[IX_DANHMUC_CANBOTHUCHIEN_HocHamHocViID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DANHMUC_CANBOTHUCHIEN_HocHamHocViID]
    ON [dbo].[DANHMUC_CANBOTHUCHIEN]([HocHamHocViID] ASC);


GO
PRINT N'Creating [dbo].[DANHMUC_CANBOTHUCHIEN].[IX_DANHMUC_CANBOTHUCHIEN_ChucDanhKhoaHocID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DANHMUC_CANBOTHUCHIEN_ChucDanhKhoaHocID]
    ON [dbo].[DANHMUC_CANBOTHUCHIEN]([ChucDanhKhoaHocID] ASC);


GO
PRINT N'Creating [dbo].[DANHMUC_CANBOTHUCHIEN].[IX_DANHMUC_CANBOTHUCHIEN_ChucVuID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DANHMUC_CANBOTHUCHIEN_ChucVuID]
    ON [dbo].[DANHMUC_CANBOTHUCHIEN]([ChucVuID] ASC);


GO
PRINT N'Creating [dbo].[DANHMUC_CANBOTHUCHIEN].[IX_DANHMUC_CANBOTHUCHIEN_KhoaPhongID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DANHMUC_CANBOTHUCHIEN_KhoaPhongID]
    ON [dbo].[DANHMUC_CANBOTHUCHIEN]([KhoaPhongID] ASC);


GO
PRINT N'Creating [dbo].[DANHMUC_CHUCDANHKHOAHOC]...';


GO
CREATE TABLE [dbo].[DANHMUC_CHUCDANHKHOAHOC] (
    [DMChucDanhKhoaHocID] INT             IDENTITY (1, 1) NOT NULL,
    [MaChucDanhKhoaHoc]   NVARCHAR (1000) NULL,
    [TenChucDanhKhoaHoc]  NVARCHAR (1000) NULL,
    [Active]              BIT             NOT NULL,
    CONSTRAINT [PK_DANHMUC_CHUCDANHKHOAHOC_DMChucDanhKhoaHocID] PRIMARY KEY CLUSTERED ([DMChucDanhKhoaHocID] ASC)
);


GO
PRINT N'Creating [dbo].[DANHMUC_CHUCVU]...';


GO
CREATE TABLE [dbo].[DANHMUC_CHUCVU] (
    [DMChucVuID] INT             IDENTITY (1, 1) NOT NULL,
    [MaChucVu]   NVARCHAR (1000) NULL,
    [TenChucVu]  NVARCHAR (1000) NULL,
    [Active]     BIT             NOT NULL,
    CONSTRAINT [PK_DANHMUC_CHUCVU_DMChucVuID] PRIMARY KEY CLUSTERED ([DMChucVuID] ASC)
);


GO
PRINT N'Creating [dbo].[DANHMUC_HOCHAMHOCVI]...';


GO
CREATE TABLE [dbo].[DANHMUC_HOCHAMHOCVI] (
    [DMHocHamHocViID] INT             IDENTITY (1, 1) NOT NULL,
    [MaHocHamHocVi]   NVARCHAR (1000) NULL,
    [TenHocHamHocVi]  NVARCHAR (1000) NULL,
    [Active]          BIT             NOT NULL,
    CONSTRAINT [PK_DANHMUC_HOCHAMHOCVI_DMHocHamHocViID] PRIMARY KEY CLUSTERED ([DMHocHamHocViID] ASC)
);


GO
PRINT N'Creating [dbo].[DANHMUC_HOIDONG_NHIEMKY_THANHVIEN]...';


GO
CREATE TABLE [dbo].[DANHMUC_HOIDONG_NHIEMKY_THANHVIEN] (
    [ThanhVienNhiemKyID] INT             IDENTITY (1, 1) NOT NULL,
    [MaThanhVien]        NVARCHAR (1000) NULL,
    [TenThanhVien]       NVARCHAR (1000) NULL,
    [ThongTinLienLac]    NVARCHAR (1000) NULL,
    [ChucVuID]           INT             NULL,
    [NoiCongTac]         NVARCHAR (1000) NULL,
    [NhiemVuTrongHD]     NVARCHAR (1000) NULL,
    [Active]             BIT             NOT NULL,
    CONSTRAINT [PK_DANHMUC_HOIDONG_NHIEMKY_THANHVIEN_ThanhVienNhiemKyID] PRIMARY KEY CLUSTERED ([ThanhVienNhiemKyID] ASC)
);


GO
PRINT N'Creating [dbo].[DANHMUC_HOIDONG_NHIEMKY_THANHVIEN].[IX_DANHMUC_HOIDONG_NHIEMKY_THANHVIEN_ChucVuID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DANHMUC_HOIDONG_NHIEMKY_THANHVIEN_ChucVuID]
    ON [dbo].[DANHMUC_HOIDONG_NHIEMKY_THANHVIEN]([ChucVuID] ASC);


GO
PRINT N'Creating [dbo].[DANHMUC_HOIDONG_NHIEMKY_THANHVIEN].[IX_HOIDONG_NHIEMKY_CHITIET_ThanhVienNhiemKyID]...';


GO
CREATE NONCLUSTERED INDEX [IX_HOIDONG_NHIEMKY_CHITIET_ThanhVienNhiemKyID]
    ON [dbo].[DANHMUC_HOIDONG_NHIEMKY_THANHVIEN]([ThanhVienNhiemKyID] ASC);


GO
PRINT N'Creating [dbo].[DANHMUC_KHOAPHONG]...';


GO
CREATE TABLE [dbo].[DANHMUC_KHOAPHONG] (
    [DMKhoaPhongID] INT             IDENTITY (1, 1) NOT NULL,
    [MaKhoaPhong]   NVARCHAR (1000) NULL,
    [TenKhoaPhong]  NVARCHAR (1000) NULL,
    [KhoiID]        INT             NULL,
    [Active]        BIT             NOT NULL,
    CONSTRAINT [PK_DANHMUC_KHOAPHONG_DMKhoaPhongID] PRIMARY KEY CLUSTERED ([DMKhoaPhongID] ASC)
);


GO
PRINT N'Creating [dbo].[DANHMUC_KHOAPHONG].[IX_HOIDONG_YEUCAU_XETDUYET_DMKhoaPhongID]...';


GO
CREATE NONCLUSTERED INDEX [IX_HOIDONG_YEUCAU_XETDUYET_DMKhoaPhongID]
    ON [dbo].[DANHMUC_KHOAPHONG]([DMKhoaPhongID] ASC);


GO
PRINT N'Creating [dbo].[DANHMUC_KHOI]...';


GO
CREATE TABLE [dbo].[DANHMUC_KHOI] (
    [DMKhoiID] INT             IDENTITY (1, 1) NOT NULL,
    [MaKhoi]   NVARCHAR (1000) NULL,
    [TenKhoi]  NVARCHAR (1000) NULL,
    [Active]   BIT             NOT NULL,
    CONSTRAINT [PK_DANHMUC_KHOI_DMKhoiID] PRIMARY KEY CLUSTERED ([DMKhoiID] ASC)
);


GO
PRINT N'Creating [dbo].[DANHMUC_LOAIHOSO]...';


GO
CREATE TABLE [dbo].[DANHMUC_LOAIHOSO] (
    [DMLoaiHoSoID] INT             IDENTITY (1, 1) NOT NULL,
    [MaLoaiHoSo]   NVARCHAR (1000) NULL,
    [TenLoaiHoSo]  NVARCHAR (1000) NULL,
    [Active]       BIT             NOT NULL,
    CONSTRAINT [PK_DANHMUC_LOAIHOSO_DMLoaiHoSoID] PRIMARY KEY CLUSTERED ([DMLoaiHoSoID] ASC)
);


GO
PRINT N'Creating [dbo].[DANHMUC_LOAIHOSO].[IX_HOIDONG_YEUCAU_XETDUYET_DMLoaiHoSoID]...';


GO
CREATE NONCLUSTERED INDEX [IX_HOIDONG_YEUCAU_XETDUYET_DMLoaiHoSoID]
    ON [dbo].[DANHMUC_LOAIHOSO]([DMLoaiHoSoID] ASC);


GO
PRINT N'Creating [dbo].[DANHMUC_LOAIVANBANDINHKEM]...';


GO
CREATE TABLE [dbo].[DANHMUC_LOAIVANBANDINHKEM] (
    [LoaiVanBanDinhKemID] INT             IDENTITY (1, 1) NOT NULL,
    [MaVanBanDinhKem]     NVARCHAR (1000) NULL,
    [TenVanBanDinhKem]    NVARCHAR (1000) NULL,
    [LoaiQuyTrinh]        INT             NULL,
    [Form]                INT             NULL,
    [Active]              BIT             NOT NULL,
    CONSTRAINT [PK_DANHMUC_LOAIVANBANDINHKEM_LoaiVanBanDinhKemID] PRIMARY KEY CLUSTERED ([LoaiVanBanDinhKemID] ASC)
);


GO
PRINT N'Creating [dbo].[DANHMUC_NGUONKINHPHI]...';


GO
CREATE TABLE [dbo].[DANHMUC_NGUONKINHPHI] (
    [DMNguonKinhPhiID] INT             IDENTITY (1, 1) NOT NULL,
    [MaNguonKinhPhi]   NVARCHAR (1000) NULL,
    [TenNguonKinhPhi]  NVARCHAR (1000) NULL,
    [Active]           BIT             NOT NULL,
    CONSTRAINT [PK_DANHMUC_NGUONKINHPHI] PRIMARY KEY CLUSTERED ([DMNguonKinhPhiID] ASC)
);


GO
PRINT N'Creating [dbo].[DANHMUC_TINHTRANGDETAI]...';


GO
CREATE TABLE [dbo].[DANHMUC_TINHTRANGDETAI] (
    [DMTinhTrangDeTaiID] INT             IDENTITY (1, 1) NOT NULL,
    [MaTinhTrangDeTai]   NVARCHAR (1000) NULL,
    [TenTinhTrangDeTai]  NVARCHAR (1000) NULL,
    [Active]             BIT             NOT NULL,
    CONSTRAINT [PK_DANHMUC_TINHTRANGDETAI_DMTinhTrangDeTaiID] PRIMARY KEY CLUSTERED ([DMTinhTrangDeTaiID] ASC)
);


GO
PRINT N'Creating [dbo].[DETAIBENNGOAI_BAOCAOHOANTAT]...';


GO
CREATE TABLE [dbo].[DETAIBENNGOAI_BAOCAOHOANTAT] (
    [BaoCaoHoanTatID]   INT  IDENTITY (1, 1) NOT NULL,
    [DeTaiBenNgoaiID]   INT  NULL,
    [ThoiGianLaySoLieu] DATE NULL,
    CONSTRAINT [PK_DETAIBENNGOAI_BAOCAOHOANTAT_BaoCaoHoanTatID] PRIMARY KEY CLUSTERED ([BaoCaoHoanTatID] ASC)
);


GO
PRINT N'Creating [dbo].[DETAIBENNGOAI_BAOCAOHOANTAT].[IX_DETAIBENNGOAI_BAOCAOHOANTAT_DeTaiBenNgoaiID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DETAIBENNGOAI_BAOCAOHOANTAT_DeTaiBenNgoaiID]
    ON [dbo].[DETAIBENNGOAI_BAOCAOHOANTAT]([DeTaiBenNgoaiID] ASC);


GO
PRINT N'Creating [dbo].[DETAIBENNGOAI_GIAMSATKIEMTRA]...';


GO
CREATE TABLE [dbo].[DETAIBENNGOAI_GIAMSATKIEMTRA] (
    [GiamSatKiemTraID] INT  IDENTITY (1, 1) NOT NULL,
    [NgayThucHienGS]   DATE NULL,
    [DeTaiBenNgoaiID]  INT  NULL,
    CONSTRAINT [PK_DETAIBENNGOAI_GIAMSATKIEMTRA_GiamSatKiemTraID] PRIMARY KEY CLUSTERED ([GiamSatKiemTraID] ASC)
);


GO
PRINT N'Creating [dbo].[DETAIBENNGOAI_GIAMSATKIEMTRA].[IX_DETAIBENNGOAI_GIAMSATKIEMTRA_DeTaiBenNgoaiID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DETAIBENNGOAI_GIAMSATKIEMTRA_DeTaiBenNgoaiID]
    ON [dbo].[DETAIBENNGOAI_GIAMSATKIEMTRA]([DeTaiBenNgoaiID] ASC);


GO
PRINT N'Creating [dbo].[DETAIBENNGOAI_GIAMSATKIEMTRA_THANHVIEN]...';


GO
CREATE TABLE [dbo].[DETAIBENNGOAI_GIAMSATKIEMTRA_THANHVIEN] (
    [ThanhVienGiamSatID] INT             IDENTITY (1, 1) NOT NULL,
    [MaThanhVien]        NVARCHAR (1000) NULL,
    [TenThanhVien]       NVARCHAR (1000) NULL,
    [ChucVu]             NVARCHAR (1000) NULL,
    [GiamSatKiemTraID]   INT             NULL,
    CONSTRAINT [PK_DETAIBENNGOAI_GIAMSATKIEMTRA_THANHVIEN_ThanhVienGiamSatID] PRIMARY KEY CLUSTERED ([ThanhVienGiamSatID] ASC)
);


GO
PRINT N'Creating [dbo].[DETAIBENNGOAI_GIAMSATKIEMTRA_THANHVIEN].[IX_DETAIBENNGOAI_GIAMSATKIEMTRA_THANHVIEN_ThanhVienGiamSatID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DETAIBENNGOAI_GIAMSATKIEMTRA_THANHVIEN_ThanhVienGiamSatID]
    ON [dbo].[DETAIBENNGOAI_GIAMSATKIEMTRA_THANHVIEN]([ThanhVienGiamSatID] ASC);


GO
PRINT N'Creating [dbo].[DETAIBENNGOAI_LAMGIAYGIOITHIEU]...';


GO
CREATE TABLE [dbo].[DETAIBENNGOAI_LAMGIAYGIOITHIEU] (
    [LamGiayGioiThieuID] INT IDENTITY (1, 1) NOT NULL,
    [DeTaiBenNgoaiID]    INT NULL,
    [DMKhoaPhongID]      INT NULL,
    CONSTRAINT [PK_DETAIBENNGOAI_LAMGIAYGIOITHIEU_LamGiayGioiThieuID] PRIMARY KEY CLUSTERED ([LamGiayGioiThieuID] ASC)
);


GO
PRINT N'Creating [dbo].[DETAIBENNGOAI_LAMGIAYGIOITHIEU].[IX_DETAIBENNGOAI_LAMGIAYGIOITHIEU_DeTaiBenNgoaiID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DETAIBENNGOAI_LAMGIAYGIOITHIEU_DeTaiBenNgoaiID]
    ON [dbo].[DETAIBENNGOAI_LAMGIAYGIOITHIEU]([DeTaiBenNgoaiID] ASC);


GO
PRINT N'Creating [dbo].[DETAIBENNGOAI_LAMGIAYGIOITHIEU].[IX_DETAIBENNGOAI_LAMGIAYGIOITHIEU_DMKhoaPhongID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DETAIBENNGOAI_LAMGIAYGIOITHIEU_DMKhoaPhongID]
    ON [dbo].[DETAIBENNGOAI_LAMGIAYGIOITHIEU]([DMKhoaPhongID] ASC);


GO
PRINT N'Creating [dbo].[DETAIBENNGOAI_NGHIENCUUSINH]...';


GO
CREATE TABLE [dbo].[DETAIBENNGOAI_NGHIENCUUSINH] (
    [NghienCuuSinhID]    INT             IDENTITY (1, 1) NOT NULL,
    [MaNghienCuuSinh]    NVARCHAR (1000) NULL,
    [TenMaNghienCuuSinh] NVARCHAR (1000) NULL,
    [NamSinh]            DATE            NULL,
    [TrinhDo]            NVARCHAR (1000) NULL,
    [SoDT]               NVARCHAR (1000) NULL,
    [Email]              NVARCHAR (1000) NULL,
    [CoQuanCongTac]      NVARCHAR (1000) NULL,
    [CoQuanGioiThieu]    NVARCHAR (1000) NULL,
    [ChuyenNganh]        NVARCHAR (1000) NULL,
    [DeTaiBenNgoaiID]    INT             NULL,
    CONSTRAINT [PK_DETAIBENNGOAI_NGHIENCUUSINH_NghienCuuSinhID] PRIMARY KEY CLUSTERED ([NghienCuuSinhID] ASC)
);


GO
PRINT N'Creating [dbo].[DETAIBENNGOAI_NGHIENCUUSINH].[IX_DETAIBENNGOAI_NGHIENCUUSINH_DeTaiBenNgoaiID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DETAIBENNGOAI_NGHIENCUUSINH_DeTaiBenNgoaiID]
    ON [dbo].[DETAIBENNGOAI_NGHIENCUUSINH]([DeTaiBenNgoaiID] ASC);


GO
PRINT N'Creating [dbo].[DETAIBENNGOAI_NHANYEUCAU]...';


GO
CREATE TABLE [dbo].[DETAIBENNGOAI_NHANYEUCAU] (
    [DeTaiBenNgoaiID]        INT             IDENTITY (1, 1) NOT NULL,
    [MaDeTai]                NVARCHAR (1000) NULL,
    [TenDeTai]               NVARCHAR (1000) NULL,
    [NguoiHuongDan]          NVARCHAR (1000) NULL,
    [ThoiGianThucHien_Tu]    DATE            NULL,
    [ThoiGianThucHien_Den]   DATE            NULL,
    [NgayHopHĐĐĐNCYSH]       DATETIME        NULL,
    [ChuNhiemDeTai]          NVARCHAR (1000) NULL,
    [DiaDiem]                NVARCHAR (1000) NULL,
    [ThoiGianNghienCuu_Tu]   DATE            NULL,
    [ThoiGianNghienCuu_Den]  DATE            NULL,
    [ThoiGianChapThuan]      DATE            NULL,
    [ThoiGianLaySoLieu_Tu]   DATE            NULL,
    [ThoiGianLaySoLieu_Den]  DATE            NULL,
    [LoaiDeTai]              INT             NULL,
    [DoiTuongNghienCuu]      NVARCHAR (1000) NULL,
    [ThietKeNghienCuu]       NVARCHAR (1000) NULL,
    [TrangThaiDeTaiBenNgoai] INT             NULL,
    [DuThuTuc]               BIT             NOT NULL,
    [ThieuChapThuan]         BIT             NOT NULL,
    [UserID]                 INT             NULL,
    CONSTRAINT [PK_DETAIBENNGOAI_NHANYEUCAU_DeTaiBenNgoaiID] PRIMARY KEY CLUSTERED ([DeTaiBenNgoaiID] ASC)
);


GO
PRINT N'Creating [dbo].[DETAIBENNGOAI_XETDUYET_HDDAODUC]...';


GO
CREATE TABLE [dbo].[DETAIBENNGOAI_XETDUYET_HDDAODUC] (
    [XetDuyetHDDDID]     INT             IDENTITY (1, 1) NOT NULL,
    [PhuongThucXetDuyet] NVARCHAR (1000) NULL,
    [NgayXetDuyet]       DATE            NULL,
    [NgayChapThuan]      DATE            NULL,
    [DeTaiBenNgoaiID]    INT             NULL,
    [HoiDongID]          INT             NULL,
    CONSTRAINT [PK_DETAIBENNGOAI_XETDUYET_HDDAODUC_XetDuyetHDDDID] PRIMARY KEY CLUSTERED ([XetDuyetHDDDID] ASC)
);


GO
PRINT N'Creating [dbo].[DETAIBENNGOAI_XETDUYET_HDDAODUC].[IX_DETAIBENNGOAI_XETDUYET_HDDAODUC_DeTaiBenNgoaiID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DETAIBENNGOAI_XETDUYET_HDDAODUC_DeTaiBenNgoaiID]
    ON [dbo].[DETAIBENNGOAI_XETDUYET_HDDAODUC]([DeTaiBenNgoaiID] ASC);


GO
PRINT N'Creating [dbo].[DETAIBENNGOAI_XETDUYET_HDDAODUC].[IX_DETAIBENNGOAI_XETDUYET_HDDAODUC_HoiDongID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DETAIBENNGOAI_XETDUYET_HDDAODUC_HoiDongID]
    ON [dbo].[DETAIBENNGOAI_XETDUYET_HDDAODUC]([HoiDongID] ASC);


GO
PRINT N'Creating [dbo].[DINHKEM_DINHKEMVANBAN]...';


GO
CREATE TABLE [dbo].[DINHKEM_DINHKEMVANBAN] (
    [DinhKemVanBanID]     INT            IDENTITY (1, 1) NOT NULL,
    [LoaiQuyTrinh]        INT            NULL,
    [Form]                INT            NULL,
    [IDTrongForm]         INT            NULL,
    [TenTapTin]           NVARCHAR (MAX) NULL,
    [PhanMoRong]          NVARCHAR (MAX) NULL,
    [KichThuoc]           NVARCHAR (MAX) NULL,
    [LoaiVanBanDinhKemID] INT            NULL,
    CONSTRAINT [PK_DINHKEM_DINHKEMVANBAN_DinhKemVanBanID] PRIMARY KEY CLUSTERED ([DinhKemVanBanID] ASC)
);


GO
PRINT N'Creating [dbo].[DINHKEM_DINHKEMVANBAN].[IX_DINHKEM_DINHKEMVANBAN_LoaiVanBanDinhKemID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DINHKEM_DINHKEMVANBAN_LoaiVanBanDinhKemID]
    ON [dbo].[DINHKEM_DINHKEMVANBAN]([LoaiVanBanDinhKemID] ASC);


GO
PRINT N'Creating [dbo].[Function]...';


GO
CREATE TABLE [dbo].[Function] (
    [FunctionCode]  NVARCHAR (100)  NOT NULL,
    [FunctionType]  TINYINT         NULL,
    [FunctionLink]  NVARCHAR (1000) NULL,
    [FunctionGroup] TINYINT         NULL,
    [IsDanhMuc]     BIT             NOT NULL,
    [Operator]      TINYINT         NULL,
    [Description]   NVARCHAR (1000) NULL,
    CONSTRAINT [PK_Function_FunctionCode] PRIMARY KEY CLUSTERED ([FunctionCode] ASC)
);


GO
PRINT N'Creating [dbo].[HOIDONG_CHONLUA]...';


GO
CREATE TABLE [dbo].[HOIDONG_CHONLUA] (
    [ChonLuaID]    INT  IDENTITY (1, 1) NOT NULL,
    [HoiDongID]    INT  NULL,
    [LoaiHoiDong]  INT  NULL,
    [NgayThanhLap] DATE NULL,
    CONSTRAINT [PK_HOIDONG_CHONLUA_ChonLuaID] PRIMARY KEY CLUSTERED ([ChonLuaID] ASC)
);


GO
PRINT N'Creating [dbo].[HOIDONG_CHONLUA].[IX_HOIDONG_CHONLUA_HoiDong_HoiDongID]...';


GO
CREATE NONCLUSTERED INDEX [IX_HOIDONG_CHONLUA_HoiDong_HoiDongID]
    ON [dbo].[HOIDONG_CHONLUA]([HoiDongID] ASC);


GO
PRINT N'Creating [dbo].[HOIDONG_CHONLUA_THANHVIEN]...';


GO
CREATE TABLE [dbo].[HOIDONG_CHONLUA_THANHVIEN] (
    [ThanhVienHDID]   INT             IDENTITY (1, 1) NOT NULL,
    [MaThanhVien]     NVARCHAR (1000) NULL,
    [TenThanhVien]    NVARCHAR (1000) NULL,
    [ThongTinLienLac] NVARCHAR (1000) NULL,
    [ChucVuID]        INT             NULL,
    [NoiCongTac]      NVARCHAR (1000) NULL,
    [NhiemVuTrongHD]  NVARCHAR (1000) NULL,
    [ChonLuaID]       INT             NULL,
    CONSTRAINT [PK_HOIDONG_CHONLUA_THANHVIEN_HOIDONG_CHONLUA_THANHVIENID] PRIMARY KEY CLUSTERED ([ThanhVienHDID] ASC)
);


GO
PRINT N'Creating [dbo].[HOIDONG_CHONLUA_THANHVIEN].[IX_HOIDONG_CHONLUA_THANHVIEN_THANHVIENID]...';


GO
CREATE NONCLUSTERED INDEX [IX_HOIDONG_CHONLUA_THANHVIEN_THANHVIENID]
    ON [dbo].[HOIDONG_CHONLUA_THANHVIEN]([ThanhVienHDID] ASC);


GO
PRINT N'Creating [dbo].[HOIDONG_CHUANBI_CUOCHOP]...';


GO
CREATE TABLE [dbo].[HOIDONG_CHUANBI_CUOCHOP] (
    [CuocHopID]      INT             IDENTITY (1, 1) NOT NULL,
    [HoiDongID]      INT             NULL,
    [ThoiGian]       DATETIME        NULL,
    [DiaDiem]        NVARCHAR (1000) NULL,
    [LoaiXetDuyetID] INT             NULL,
    CONSTRAINT [PK_HOIDONG_CHUANBI_CUOCHOP_CuocHopID] PRIMARY KEY CLUSTERED ([CuocHopID] ASC)
);


GO
PRINT N'Creating [dbo].[HOIDONG_CHUANBI_CUOCHOP].[IX_HOIDONG_CHUANBI_CUOCHOP_HoiDongID]...';


GO
CREATE NONCLUSTERED INDEX [IX_HOIDONG_CHUANBI_CUOCHOP_HoiDongID]
    ON [dbo].[HOIDONG_CHUANBI_CUOCHOP]([HoiDongID] ASC);


GO
PRINT N'Creating [dbo].[HOIDONG_CHUANBI_CUOCHOP_THANHVIEN]...';


GO
CREATE TABLE [dbo].[HOIDONG_CHUANBI_CUOCHOP_THANHVIEN] (
    [ThanhVienCuocHopID] INT IDENTITY (1, 1) NOT NULL,
    [CuocHopID]          INT NULL,
    [ThanhVienHDID]      INT NULL,
    CONSTRAINT [PK_HOIDONG_CHUANBI_CUOCHOP_THANHVIEN_ThanhVienID] PRIMARY KEY CLUSTERED ([ThanhVienCuocHopID] ASC)
);


GO
PRINT N'Creating [dbo].[HOIDONG_CHUANBI_CUOCHOP_THANHVIEN].[IX_HOIDONG_CHUANBI_CUOCHOP_CUOCHOPID]...';


GO
CREATE NONCLUSTERED INDEX [IX_HOIDONG_CHUANBI_CUOCHOP_CUOCHOPID]
    ON [dbo].[HOIDONG_CHUANBI_CUOCHOP_THANHVIEN]([CuocHopID] ASC);


GO
PRINT N'Creating [dbo].[HOIDONG_CHUANBI_CUOCHOP_THANHVIEN].[IX_HOIDONG_CHUANBI_CUOCHOP_ThanhVienHDID]...';


GO
CREATE NONCLUSTERED INDEX [IX_HOIDONG_CHUANBI_CUOCHOP_ThanhVienHDID]
    ON [dbo].[HOIDONG_CHUANBI_CUOCHOP_THANHVIEN]([ThanhVienHDID] ASC);


GO
PRINT N'Creating [dbo].[HOIDONG_GHINHAN_KETQUA]...';


GO
CREATE TABLE [dbo].[HOIDONG_GHINHAN_KETQUA] (
    [GhiNhanKetQuaID] INT             IDENTITY (1, 1) NOT NULL,
    [ThoiGian]        DATETIME        NULL,
    [DiaDiem]         NVARCHAR (1000) NULL,
    [KetLuan]         NVARCHAR (1000) NULL,
    [HoiDongID]       INT             NULL,
    CONSTRAINT [PK_HOIDONG_GHINHAN_KETQUA_GhiNhanKetQuaID] PRIMARY KEY CLUSTERED ([GhiNhanKetQuaID] ASC)
);


GO
PRINT N'Creating [dbo].[HOIDONG_GHINHAN_KETQUA].[IX_HOIDONG_GHINHAN_KETQUA_HoiDongID]...';


GO
CREATE NONCLUSTERED INDEX [IX_HOIDONG_GHINHAN_KETQUA_HoiDongID]
    ON [dbo].[HOIDONG_GHINHAN_KETQUA]([HoiDongID] ASC);


GO
PRINT N'Creating [dbo].[HOIDONG_GHINHAN_KETQUA_THANVIEN]...';


GO
CREATE TABLE [dbo].[HOIDONG_GHINHAN_KETQUA_THANVIEN] (
    [ThanhVienGhiNhanID] INT IDENTITY (1, 1) NOT NULL,
    [ThanhVienCuocHopID] INT NULL,
    [GhiNhanKetQuaID]    INT NULL,
    CONSTRAINT [PK_HOIDONG_GHINHAN_KETQUA_THANVIEN_GhiNhan_CuocHop_ThanhVienID] PRIMARY KEY CLUSTERED ([ThanhVienGhiNhanID] ASC)
);


GO
PRINT N'Creating [dbo].[HOIDONG_GHINHAN_KETQUA_THANVIEN].[IX_HOIDONG_GHINHAN_KETQUA_THANVIEN_GhiNhan_CuocHop_ThanhVienCuocHopID]...';


GO
CREATE NONCLUSTERED INDEX [IX_HOIDONG_GHINHAN_KETQUA_THANVIEN_GhiNhan_CuocHop_ThanhVienCuocHopID]
    ON [dbo].[HOIDONG_GHINHAN_KETQUA_THANVIEN]([ThanhVienCuocHopID] ASC);


GO
PRINT N'Creating [dbo].[HOIDONG_NHIEMKY]...';


GO
CREATE TABLE [dbo].[HOIDONG_NHIEMKY] (
    [HDNhiemKyID]  INT             IDENTITY (1, 1) NOT NULL,
    [MaHoiDong]    NVARCHAR (1000) NULL,
    [NgayThanhLap] DATE            NULL,
    [NhiemKy_Tu]   DATE            NULL,
    [NhiemKy_Den]  DATE            NULL,
    [LoaiHoiDong]  INT             NULL,
    CONSTRAINT [PK_HOIDONG_NHIEMKY_HDNhiemKyID] PRIMARY KEY CLUSTERED ([HDNhiemKyID] ASC)
);


GO
PRINT N'Creating [dbo].[HOIDONG_NHIEMKY_CHITIET]...';


GO
CREATE TABLE [dbo].[HOIDONG_NHIEMKY_CHITIET] (
    [HDNhiemKyChiTietID] INT IDENTITY (1, 1) NOT NULL,
    [HDNhiemKyID]        INT NULL,
    [ThanhVienNhiemKyID] INT NULL,
    CONSTRAINT [PK_HOIDONG_NHIEMKY_CHITIET_HDNhiemKyChiTietID] PRIMARY KEY CLUSTERED ([HDNhiemKyChiTietID] ASC)
);


GO
PRINT N'Creating [dbo].[HOIDONG_NHIEMKY_CHITIET].[IX_HOIDONG_NHIEMKY_CHITIET_HDNhiemKyID]...';


GO
CREATE NONCLUSTERED INDEX [IX_HOIDONG_NHIEMKY_CHITIET_HDNhiemKyID]
    ON [dbo].[HOIDONG_NHIEMKY_CHITIET]([HDNhiemKyID] ASC);


GO
PRINT N'Creating [dbo].[HOIDONG_YEUCAU_XETDUYET]...';


GO
CREATE TABLE [dbo].[HOIDONG_YEUCAU_XETDUYET] (
    [HoiDongID]        INT             IDENTITY (1, 1) NOT NULL,
    [MaHoiDong]        NVARCHAR (1000) NULL,
    [DMLoaiHoSoID]     INT             NULL,
    [DoiTuongXetDuyet] NVARCHAR (1000) NULL,
    [DMKhoaPhongID]    INT             NULL,
    [ThoiGianDangKy]   DATE            NULL,
    [TrangThaiHD]      INT             NULL,
    [DayDuHoSo]        BIT             NOT NULL,
    [UserID]           INT             NULL,
    CONSTRAINT [PK_HOIDONG_YEUCAU_XETDUYET_HoiDongID] PRIMARY KEY CLUSTERED ([HoiDongID] ASC)
);


GO
PRINT N'Creating [dbo].[HOINGHI_DANGKY]...';


GO
CREATE TABLE [dbo].[HOINGHI_DANGKY] (
    [DangKyHoiNghiID] INT             IDENTITY (1, 1) NOT NULL,
    [TenBai]          NVARCHAR (1000) NULL,
    [ChuyenKhoa]      NVARCHAR (1000) NULL,
    [BaoCaoVien]      NVARCHAR (1000) NULL,
    [SoDT_BCV]        NVARCHAR (1000) NULL,
    [Email_BCV]       NVARCHAR (1000) NULL,
    [ChucDanh]        NVARCHAR (1000) NULL,
    [DMKhoaPhongID]   INT             NULL,
    [DMKhoiID]        INT             NULL,
    [CongSu]          NVARCHAR (1000) NULL,
    [LoaiBaoCao]      INT             NULL,
    [DangTapChi]      INT             NULL,
    [TapChiDang]      BIT             NOT NULL,
    [NhanXet]         NVARCHAR (1000) NULL,
    [GhiChu]          NVARCHAR (1000) NULL,
    [HoiNghiID]       INT             NULL,
    CONSTRAINT [PK_HOINGHI_DANGKY_ToChucDangKyID] PRIMARY KEY CLUSTERED ([DangKyHoiNghiID] ASC)
);


GO
PRINT N'Creating [dbo].[HOINGHI_DANGKY].[IX_HOINGHI_DANGKY_DMKhoaPhongID]...';


GO
CREATE NONCLUSTERED INDEX [IX_HOINGHI_DANGKY_DMKhoaPhongID]
    ON [dbo].[HOINGHI_DANGKY]([DMKhoaPhongID] ASC);


GO
PRINT N'Creating [dbo].[HOINGHI_DANGKY].[IX_HOINGHI_DANGKY_DMKhoiID]...';


GO
CREATE NONCLUSTERED INDEX [IX_HOINGHI_DANGKY_DMKhoiID]
    ON [dbo].[HOINGHI_DANGKY]([DMKhoiID] ASC);


GO
PRINT N'Creating [dbo].[HOINGHI_DANGKY].[IX_HOINGHI_DANGKY_HoiNghiID]...';


GO
CREATE NONCLUSTERED INDEX [IX_HOINGHI_DANGKY_HoiNghiID]
    ON [dbo].[HOINGHI_DANGKY]([HoiNghiID] ASC);


GO
PRINT N'Creating [dbo].[HOINGHI_DUYEBAIDANGKY]...';


GO
CREATE TABLE [dbo].[HOINGHI_DUYEBAIDANGKY] (
    [DuyetBaiDangKyID] INT             IDENTITY (1, 1) NOT NULL,
    [BoSung]           BIT             NOT NULL,
    [KinhPhi]          MONEY           NULL,
    [NgayNhan]         DATE            NULL,
    [NguoiNhan]        NVARCHAR (1000) NULL,
    [NguoiNop]         NVARCHAR (1000) NULL,
    [Duyet]            BIT             NOT NULL,
    [HoiNghiID]        INT             NULL,
    CONSTRAINT [PK_HOINGHI_DUYEBAIDANGKY_DuyetBaiDangKyID] PRIMARY KEY CLUSTERED ([DuyetBaiDangKyID] ASC)
);


GO
PRINT N'Creating [dbo].[HOINGHI_DUYEBAIDANGKY].[IX_HOINGHI_DUYEBAIDANGKY_HoiNghiID]...';


GO
CREATE NONCLUSTERED INDEX [IX_HOINGHI_DUYEBAIDANGKY_HoiNghiID]
    ON [dbo].[HOINGHI_DUYEBAIDANGKY]([HoiNghiID] ASC);


GO
PRINT N'Creating [dbo].[HOINGHI_GHINHANKETQUA]...';


GO
CREATE TABLE [dbo].[HOINGHI_GHINHANKETQUA] (
    [GhiNhanKetQuaID] INT             IDENTITY (1, 1) NOT NULL,
    [HoiNghiID]       INT             NULL,
    [KetQua]          NVARCHAR (1000) NULL,
    [NhanXet]         NVARCHAR (1000) NULL,
    [NgayGhiNhan]     DATETIME        NULL,
    CONSTRAINT [PK_HOINGHI_GHINHANKETQUA_GhiNhanKetQuaID] PRIMARY KEY CLUSTERED ([GhiNhanKetQuaID] ASC)
);


GO
PRINT N'Creating [dbo].[HOINGHI_GHINHANKETQUA].[IX_HOINGHI_GHINHANKETQUA_HoiNghiID]...';


GO
CREATE NONCLUSTERED INDEX [IX_HOINGHI_GHINHANKETQUA_HoiNghiID]
    ON [dbo].[HOINGHI_GHINHANKETQUA]([HoiNghiID] ASC);


GO
PRINT N'Creating [dbo].[HOINGHI_GUIBAIDANGKY]...';


GO
CREATE TABLE [dbo].[HOINGHI_GUIBAIDANGKY] (
    [GuiBaiDangKyID] INT             IDENTITY (1, 1) NOT NULL,
    [NguoiNhan]      NVARCHAR (1000) NULL,
    [DMKhoaPhongID]  INT             NULL,
    [Email]          NVARCHAR (1000) NULL,
    [SoDT]           NVARCHAR (1000) NULL,
    [NgayGui]        DATE            NULL,
    [HoiNghiID]      INT             NULL,
    CONSTRAINT [PK_HOINGHI_GUIBAIDANGKY_GuiBaiDangKyID] PRIMARY KEY CLUSTERED ([GuiBaiDangKyID] ASC)
);


GO
PRINT N'Creating [dbo].[HOINGHI_GUIBAIDANGKY].[IX_HOINGHI_GUIBAIDANGKY_HoiNghiID]...';


GO
CREATE NONCLUSTERED INDEX [IX_HOINGHI_GUIBAIDANGKY_HoiNghiID]
    ON [dbo].[HOINGHI_GUIBAIDANGKY]([HoiNghiID] ASC);


GO
PRINT N'Creating [dbo].[HOINGHI_LAPCHUONGTRINH]...';


GO
CREATE TABLE [dbo].[HOINGHI_LAPCHUONGTRINH] (
    [LapChuongTrinhID] INT             IDENTITY (1, 1) NOT NULL,
    [HoiNghiID]        INT             NULL,
    [ChiTiet]          NVARCHAR (1000) NULL,
    [GhiChu]           NVARCHAR (1000) NULL,
    [Ngay]             DATE            NULL,
    CONSTRAINT [PK_HOINGHI_LAPCHUONGTRINH_LapChuongTrinhID] PRIMARY KEY CLUSTERED ([LapChuongTrinhID] ASC)
);


GO
PRINT N'Creating [dbo].[HOINGHI_LAPCHUONGTRINH].[IX_HOINGHI_LAPCHUONGTRINH_HoiNghiID]...';


GO
CREATE NONCLUSTERED INDEX [IX_HOINGHI_LAPCHUONGTRINH_HoiNghiID]
    ON [dbo].[HOINGHI_LAPCHUONGTRINH]([HoiNghiID] ASC);


GO
PRINT N'Creating [dbo].[HOINGHI_LAPCHUONGTRINH_CHITIET]...';


GO
CREATE TABLE [dbo].[HOINGHI_LAPCHUONGTRINH_CHITIET] (
    [LapChuongTrinhChiTietID] INT             IDENTITY (1, 1) NOT NULL,
    [DiaDiem]                 NVARCHAR (1000) NULL,
    [ThoiGianTu]              DATETIME        NULL,
    [ThoiGianDen]             DATETIME        NULL,
    [ChuToa]                  NVARCHAR (1000) NULL,
    [Phien]                   NVARCHAR (1000) NULL,
    [STT]                     INT             NULL,
    [NoiDung]                 NVARCHAR (1000) NULL,
    [BaoCaoVien]              NVARCHAR (1000) NULL,
    [DMKhoiID]                INT             NULL,
    [GhiChu]                  NVARCHAR (1000) NULL,
    [LapChuongTrinhID]        INT             NULL,
    CONSTRAINT [PK_HOINGHI_LAPCHUONGTRINH_CHITIET_LapChuongTrinhChiTietID] PRIMARY KEY CLUSTERED ([LapChuongTrinhChiTietID] ASC)
);


GO
PRINT N'Creating [dbo].[HOINGHI_TOCHUCMODOT]...';


GO
CREATE TABLE [dbo].[HOINGHI_TOCHUCMODOT] (
    [HoiNghiID]        INT             IDENTITY (1, 1) NOT NULL,
    [MaHoiNGhi]        NVARCHAR (1000) NULL,
    [TenHoiNghi]       NVARCHAR (1000) NULL,
    [ThoiGianTu]       DATETIME        NULL,
    [ThoiGianDen]      DATETIME        NULL,
    [UserID]           INT             NULL,
    [TrangThaiHoiNghi] INT             NULL,
    CONSTRAINT [PK_HOINGHI_TOCHUCMODOT_HoiNghiID] PRIMARY KEY CLUSTERED ([HoiNghiID] ASC)
);


GO
PRINT N'Creating [dbo].[NGHIEMTHU_BOSUNGSUADOI]...';


GO
CREATE TABLE [dbo].[NGHIEMTHU_BOSUNGSUADOI] (
    [BoSungSuaDoiID]           INT             IDENTITY (1, 1) NOT NULL,
    [LoaiVanBanChinhSuaBoSung] NVARCHAR (1000) NULL,
    [NgayChinhSuaBoSung]       DATE            NULL,
    [DeTaiID]                  INT             NULL,
    [CoHopHoiDongXetLai]       BIT             NOT NULL,
    CONSTRAINT [PK_NGHIEMTHU_BOSUNGSUADOI_BoSungSuaDoiID] PRIMARY KEY CLUSTERED ([BoSungSuaDoiID] ASC)
);


GO
PRINT N'Creating [dbo].[NGHIEMTHU_BOSUNGSUADOI].[IX_NGHIEMTHU_BOSUNGSUADOI_DeTaiID]...';


GO
CREATE NONCLUSTERED INDEX [IX_NGHIEMTHU_BOSUNGSUADOI_DeTaiID]
    ON [dbo].[NGHIEMTHU_BOSUNGSUADOI]([DeTaiID] ASC);


GO
PRINT N'Creating [dbo].[NGHIEMTHU_DENGHICAPCOSO]...';


GO
CREATE TABLE [dbo].[NGHIEMTHU_DENGHICAPCOSO] (
    [DeNghiNghiemThuCapCoSoID] INT             IDENTITY (1, 1) NOT NULL,
    [NgayDeNghi]               DATE            NULL,
    [GhiChu]                   NVARCHAR (1000) NULL,
    [DeTaiID]                  INT             NULL,
    CONSTRAINT [PK_NGHIEMTHU_DENGHICAPCOSO_DeNghiNghiemThuCapCoSoID] PRIMARY KEY CLUSTERED ([DeNghiNghiemThuCapCoSoID] ASC)
);


GO
PRINT N'Creating [dbo].[NGHIEMTHU_DENGHICAPCOSO].[IX_NGHIEMTHU_DENGHICAPCOSO_DeTaiID]...';


GO
CREATE NONCLUSTERED INDEX [IX_NGHIEMTHU_DENGHICAPCOSO_DeTaiID]
    ON [dbo].[NGHIEMTHU_DENGHICAPCOSO]([DeTaiID] ASC);


GO
PRINT N'Creating [dbo].[NGHIEMTHU_DENGHICAPQUANLY]...';


GO
CREATE TABLE [dbo].[NGHIEMTHU_DENGHICAPQUANLY] (
    [DeNghiNghiemThuCapQuanLyID] INT             IDENTITY (1, 1) NOT NULL,
    [NgayDeNghi]                 DATE            NULL,
    [GhiChu]                     NVARCHAR (1000) NULL,
    [DeTaiID]                    INT             NULL,
    CONSTRAINT [PK_NGHIEMTHU_DENGHICAPQUANLY_DeNghiNghiemThuCapQuanLyID] PRIMARY KEY CLUSTERED ([DeNghiNghiemThuCapQuanLyID] ASC)
);


GO
PRINT N'Creating [dbo].[NGHIEMTHU_DENGHICAPQUANLY].[IX_NGHIEMTHU_DENGHICAPQUANLY_DeTaiID]...';


GO
CREATE NONCLUSTERED INDEX [IX_NGHIEMTHU_DENGHICAPQUANLY_DeTaiID]
    ON [dbo].[NGHIEMTHU_DENGHICAPQUANLY]([DeTaiID] ASC);


GO
PRINT N'Creating [dbo].[NGHIEMTHU_NGHIEMTHUDETAICAPCOSO]...';


GO
CREATE TABLE [dbo].[NGHIEMTHU_NGHIEMTHUDETAICAPCOSO] (
    [NghiemThuDeTaiCapCoSoID]  INT             IDENTITY (1, 1) NOT NULL,
    [DeTaiID]                  INT             NULL,
    [NgayBaoVeBaoCaoNghiemThu] DATE            NULL,
    [HoiDongID]                INT             NULL,
    [KetQuaDeTai]              INT             NULL,
    [KetQuaNghiemThuCapCoSo]   BIT             NULL,
    [CoChinhSuaBoSung]         BIT             NOT NULL,
    [GhiChu]                   NVARCHAR (1000) NULL,
    CONSTRAINT [PK_NGHIEMTHU_NGHIEMTHUDETAICAPCOSO_NghiemThuDeTaiCapCoSoID] PRIMARY KEY CLUSTERED ([NghiemThuDeTaiCapCoSoID] ASC)
);


GO
PRINT N'Creating [dbo].[NGHIEMTHU_NGHIEMTHUDETAICAPCOSO].[IX_NGHIEMTHU_NGHIEMTHUDETAICAPCOSO_DeTaiID]...';


GO
CREATE NONCLUSTERED INDEX [IX_NGHIEMTHU_NGHIEMTHUDETAICAPCOSO_DeTaiID]
    ON [dbo].[NGHIEMTHU_NGHIEMTHUDETAICAPCOSO]([DeTaiID] ASC);


GO
PRINT N'Creating [dbo].[NGHIEMTHU_NGHIEMTHUDETAICAPCOSO].[IX_NGHIEMTHU_NGHIEMTHUDETAICAPCOSO_HoiDongID]...';


GO
CREATE NONCLUSTERED INDEX [IX_NGHIEMTHU_NGHIEMTHUDETAICAPCOSO_HoiDongID]
    ON [dbo].[NGHIEMTHU_NGHIEMTHUDETAICAPCOSO]([HoiDongID] ASC);


GO
PRINT N'Creating [dbo].[NGHIEMTHU_NGHIEMTHUDETAICAPQUANLY]...';


GO
CREATE TABLE [dbo].[NGHIEMTHU_NGHIEMTHUDETAICAPQUANLY] (
    [NghiemThuDeTaiCapQuanLyID] INT             IDENTITY (1, 1) NOT NULL,
    [DeTaiID]                   INT             NULL,
    [NgayNghiemThu]             DATE            NULL,
    [KetQuaNghiemThuCapQuanLy]  BIT             NOT NULL,
    [GhiChu]                    NVARCHAR (1000) NULL,
    CONSTRAINT [PK_NGHIEMTHU_NGHIEMTHUDETAICAPQUANLY_NghiemThuDeTaiCapQuanLyID] PRIMARY KEY CLUSTERED ([NghiemThuDeTaiCapQuanLyID] ASC)
);


GO
PRINT N'Creating [dbo].[NGHIEMTHU_NGHIEMTHUDETAICAPQUANLY].[IX_NGHIEMTHU_NGHIEMTHUDETAICAPQUANLY_DeTaiID]...';


GO
CREATE NONCLUSTERED INDEX [IX_NGHIEMTHU_NGHIEMTHUDETAICAPQUANLY_DeTaiID]
    ON [dbo].[NGHIEMTHU_NGHIEMTHUDETAICAPQUANLY]([DeTaiID] ASC);


GO
PRINT N'Creating [dbo].[RoleRight]...';


GO
CREATE TABLE [dbo].[RoleRight] (
    [RoleRightId]  INT            IDENTITY (1, 1) NOT NULL,
    [RoleName]     NVARCHAR (256) NULL,
    [FunctionCode] NVARCHAR (100) NULL,
    [CanCreate]    BIT            NULL,
    [CanUpdate]    BIT            NULL,
    [CanDelete]    BIT            NULL,
    CONSTRAINT [PK_RoleRight_RoleRightId] PRIMARY KEY CLUSTERED ([RoleRightId] ASC)
);


GO
PRINT N'Creating [dbo].[RoleRight].[IX_RoleRight_RoleName]...';


GO
CREATE NONCLUSTERED INDEX [IX_RoleRight_RoleName]
    ON [dbo].[RoleRight]([RoleName] ASC);


GO
PRINT N'Creating [dbo].[THUCHIENDETAI_BAOCAODINHKY]...';


GO
CREATE TABLE [dbo].[THUCHIENDETAI_BAOCAODINHKY] (
    [BaoCaoDinhKyID] INT             IDENTITY (1, 1) NOT NULL,
    [DeTaiID]        INT             NULL,
    [GhiChu]         NVARCHAR (1000) NULL,
    CONSTRAINT [PK_THUCHIENDETAI_BAOCAODINHKY_BaoCaoDinhKyID] PRIMARY KEY CLUSTERED ([BaoCaoDinhKyID] ASC)
);


GO
PRINT N'Creating [dbo].[THUCHIENDETAI_BAOCAODINHKY].[IX_THUCHIENDETAI_BAOCAODINHKY_DeTaiID]...';


GO
CREATE NONCLUSTERED INDEX [IX_THUCHIENDETAI_BAOCAODINHKY_DeTaiID]
    ON [dbo].[THUCHIENDETAI_BAOCAODINHKY]([DeTaiID] ASC);


GO
PRINT N'Creating [dbo].[THUCHIENDETAI_BAOCAODINHKY_CHITIET]...';


GO
CREATE TABLE [dbo].[THUCHIENDETAI_BAOCAODINHKY_CHITIET] (
    [BaoCaoDinhKyChiTietID] INT             IDENTITY (1, 1) NOT NULL,
    [BaoCaoDinhKyID]        INT             NULL,
    [KyBaoCao]              INT             NULL,
    [NgayBaoCao]            DATE            NULL,
    [NoiDungBaoCao]         NVARCHAR (1000) NULL,
    [VanDeTonTai]           NVARCHAR (1000) NULL,
    [DuKienCanTrienKhai]    NVARCHAR (1000) NULL,
    [KetLuan]               NVARCHAR (1000) NULL,
    CONSTRAINT [THUCHIENDETAI_BAOCAODINHKY_CHITIET_BaoCaoDinhKyChiTietID] PRIMARY KEY CLUSTERED ([BaoCaoDinhKyChiTietID] ASC)
);


GO
PRINT N'Creating [dbo].[THUCHIENDETAI_BAOCAODINHKY_CHITIET].[IX_THUCHIENDETAI_BAOCAODINHKY_CHITIET_BaoCaoDinhKyID]...';


GO
CREATE NONCLUSTERED INDEX [IX_THUCHIENDETAI_BAOCAODINHKY_CHITIET_BaoCaoDinhKyID]
    ON [dbo].[THUCHIENDETAI_BAOCAODINHKY_CHITIET]([BaoCaoDinhKyID] ASC);


GO
PRINT N'Creating [dbo].[THUCHIENDETAI_DENGHIDIEUCHINHNOIDUNG]...';


GO
CREATE TABLE [dbo].[THUCHIENDETAI_DENGHIDIEUCHINHNOIDUNG] (
    [DeNghiDieuChinhNoiDungID] INT             IDENTITY (1, 1) NOT NULL,
    [GhiChu]                   NVARCHAR (1000) NULL,
    [DeTaiID]                  INT             NULL,
    CONSTRAINT [PK_THUCHIENDETAI_DENGHIDIEUCHINHNOIDUNG_DeNghiDieuChinhNoiDungID] PRIMARY KEY CLUSTERED ([DeNghiDieuChinhNoiDungID] ASC)
);


GO
PRINT N'Creating [dbo].[THUCHIENDETAI_DENGHIDIEUCHINHNOIDUNG].[IX_THUCHIENDETAI_DENGHIDIEUCHINHNOIDUNG_DeTaiID]...';


GO
CREATE NONCLUSTERED INDEX [IX_THUCHIENDETAI_DENGHIDIEUCHINHNOIDUNG_DeTaiID]
    ON [dbo].[THUCHIENDETAI_DENGHIDIEUCHINHNOIDUNG]([DeTaiID] ASC);


GO
PRINT N'Creating [dbo].[THUCHIENDETAI_DENGHIDIEUCHINHNOIDUNG_CHITIET]...';


GO
CREATE TABLE [dbo].[THUCHIENDETAI_DENGHIDIEUCHINHNOIDUNG_CHITIET] (
    [DeNghiDieuChinhNoiDungChiTietID] INT             IDENTITY (1, 1) NOT NULL,
    [LoaiDieuChinh]                   INT             NULL,
    [NgayDeNghi]                      DATE            NULL,
    [NoiDungDieuChinh]                NVARCHAR (1000) NULL,
    [KetQuaDeNghiDieuChinh]           BIT             NOT NULL,
    [DeNghiDieuChinhNoiDungID]        INT             NULL,
    [GhiChu]                          NVARCHAR (1000) NULL,
    CONSTRAINT [PK_THUCHIENDETAI_DENGHIDIEUCHINHNOIDUNG_CHITIET_DeNghiDieuChinhNoiDungChiTietID] PRIMARY KEY CLUSTERED ([DeNghiDieuChinhNoiDungChiTietID] ASC)
);


GO
PRINT N'Creating [dbo].[THUCHIENDETAI_DENGHIDIEUCHINHNOIDUNG_CHITIET].[IX_THUCHIENDETAI_DENGHIDIEUCHINHNOIDUNG_CHITIET_DeNghiDieuChinhNoiDungID]...';


GO
CREATE NONCLUSTERED INDEX [IX_THUCHIENDETAI_DENGHIDIEUCHINHNOIDUNG_CHITIET_DeNghiDieuChinhNoiDungID]
    ON [dbo].[THUCHIENDETAI_DENGHIDIEUCHINHNOIDUNG_CHITIET]([DeNghiDieuChinhNoiDungID] ASC);


GO
PRINT N'Creating [dbo].[THUCHIENDETAI_DENGHIGIAHAN]...';


GO
CREATE TABLE [dbo].[THUCHIENDETAI_DENGHIGIAHAN] (
    [DeNghiGiaHanID] INT             IDENTITY (1, 1) NOT NULL,
    [DeTaiID]        INT             NULL,
    [GhiChu]         NVARCHAR (1000) NULL,
    CONSTRAINT [PK_THUCHIENDETAI_DENGHIGIAHAN_DeNghiGiaHanID] PRIMARY KEY CLUSTERED ([DeNghiGiaHanID] ASC)
);


GO
PRINT N'Creating [dbo].[THUCHIENDETAI_DENGHIGIAHAN].[IX_THUCHIENDETAI_DENGHIGIAHAN_DeTaiID]...';


GO
CREATE NONCLUSTERED INDEX [IX_THUCHIENDETAI_DENGHIGIAHAN_DeTaiID]
    ON [dbo].[THUCHIENDETAI_DENGHIGIAHAN]([DeTaiID] ASC);


GO
PRINT N'Creating [dbo].[THUCHIENDETAI_DENGHIGIAHAN_CHITIET]...';


GO
CREATE TABLE [dbo].[THUCHIENDETAI_DENGHIGIAHAN_CHITIET] (
    [DeNghiGiaHanChiTietID] INT             IDENTITY (1, 1) NOT NULL,
    [DeNghiGiaHanID]        INT             NULL,
    [NgayDeNghiGiaHan]      DATE            NULL,
    [GiaHanTuNgay]          DATE            NULL,
    [GiaHanDenNgay]         DATE            NULL,
    [NgayTraLoiDeNghi]      DATE            NULL,
    [KetQuaDeNghiGiaHan]    BIT             NOT NULL,
    [GhiChu]                NVARCHAR (1000) NULL,
    CONSTRAINT [PK_THUCHIENDETAI_DENGHIGIAHAN_CHITIET_DeNghiGiaHanChiTietID] PRIMARY KEY CLUSTERED ([DeNghiGiaHanChiTietID] ASC)
);


GO
PRINT N'Creating [dbo].[THUCHIENDETAI_DENGHIGIAHAN_CHITIET].[IX_THUCHIENDETAI_DENGHIGIAHAN_CHITIET_DeNghiGiaHanID]...';


GO
CREATE NONCLUSTERED INDEX [IX_THUCHIENDETAI_DENGHIGIAHAN_CHITIET_DeNghiGiaHanID]
    ON [dbo].[THUCHIENDETAI_DENGHIGIAHAN_CHITIET]([DeNghiGiaHanID] ASC);


GO
PRINT N'Creating [dbo].[THUCHIENDETAI_KIEMTRAGIAMSAT]...';


GO
CREATE TABLE [dbo].[THUCHIENDETAI_KIEMTRAGIAMSAT] (
    [KiemTraGiamSatID] INT             IDENTITY (1, 1) NOT NULL,
    [CapGiamSat]       INT             NULL,
    [GhiChu]           NVARCHAR (1000) NULL,
    [DeTaiID]          INT             NULL,
    CONSTRAINT [PK_THUCHIENDETAI_KIEMTRAGIAMSAT_KiemTraGiamSatID] PRIMARY KEY CLUSTERED ([KiemTraGiamSatID] ASC)
);


GO
PRINT N'Creating [dbo].[THUCHIENDETAI_KIEMTRAGIAMSAT].[IX_THUCHIENDETAI_KIEMTRAGIAMSAT_DeTaiID]...';


GO
CREATE NONCLUSTERED INDEX [IX_THUCHIENDETAI_KIEMTRAGIAMSAT_DeTaiID]
    ON [dbo].[THUCHIENDETAI_KIEMTRAGIAMSAT]([DeTaiID] ASC);


GO
PRINT N'Creating [dbo].[THUCHIENDETAI_KIEMTRAGIAMSAT_CHITIET]...';


GO
CREATE TABLE [dbo].[THUCHIENDETAI_KIEMTRAGIAMSAT_CHITIET] (
    [KiemTraGiamSatChiTietID] INT             IDENTITY (1, 1) NOT NULL,
    [HoiDongID]               INT             NULL,
    [KiemTraGiamSatID]        INT             NULL,
    [NgayKiemTra]             DATE            NULL,
    [GhiChu]                  NVARCHAR (1000) NULL,
    CONSTRAINT [PK_THUCHIENDETAI_KIEMTRAGIAMSAT_CHITIET_KiemTraGiamSatChiTietID] PRIMARY KEY CLUSTERED ([KiemTraGiamSatChiTietID] ASC)
);


GO
PRINT N'Creating [dbo].[THUCHIENDETAI_KIEMTRAGIAMSAT_CHITIET].[IX_THUCHIENDETAI_KIEMTRAGIAMSAT_CHITIET_KiemTraGiamSatID]...';


GO
CREATE NONCLUSTERED INDEX [IX_THUCHIENDETAI_KIEMTRAGIAMSAT_CHITIET_KiemTraGiamSatID]
    ON [dbo].[THUCHIENDETAI_KIEMTRAGIAMSAT_CHITIET]([KiemTraGiamSatID] ASC);


GO
PRINT N'Creating [dbo].[THUCHIENDETAI_KIEMTRAGIAMSAT_CHITIET].[IX_THUCHIENDETAI_KIEMTRAGIAMSAT_CHITIET_HoiDongID]...';


GO
CREATE NONCLUSTERED INDEX [IX_THUCHIENDETAI_KIEMTRAGIAMSAT_CHITIET_HoiDongID]
    ON [dbo].[THUCHIENDETAI_KIEMTRAGIAMSAT_CHITIET]([HoiDongID] ASC);


GO
PRINT N'Creating [dbo].[THUCHIENDETAI_TOCHUCHOINGHIHOITHAO]...';


GO
CREATE TABLE [dbo].[THUCHIENDETAI_TOCHUCHOINGHIHOITHAO] (
    [ToChucHoiNghiHoiThaoID] INT             IDENTITY (1, 1) NOT NULL,
    [DeTaiID]                INT             NULL,
    [GhiChu]                 NVARCHAR (1000) NULL,
    CONSTRAINT [PK_THUCHIENDETAI_TOCHUCHOINGHIHOITHAO_ToChucHoiNghiHoiThaoID] PRIMARY KEY CLUSTERED ([ToChucHoiNghiHoiThaoID] ASC)
);


GO
PRINT N'Creating [dbo].[THUCHIENDETAI_TOCHUCHOINGHIHOITHAO].[IX_THUCHIENDETAI_TOCHUCHOINGHIHOITHAO_DeTaiID]...';


GO
CREATE NONCLUSTERED INDEX [IX_THUCHIENDETAI_TOCHUCHOINGHIHOITHAO_DeTaiID]
    ON [dbo].[THUCHIENDETAI_TOCHUCHOINGHIHOITHAO]([DeTaiID] ASC);


GO
PRINT N'Creating [dbo].[THUCHIENDETAI_TOCHUCHOINGHIHOITHAO_CHITIET]...';


GO
CREATE TABLE [dbo].[THUCHIENDETAI_TOCHUCHOINGHIHOITHAO_CHITIET] (
    [ToChucHoiNghiHoiThaoChiTietID] INT             IDENTITY (1, 1) NOT NULL,
    [ToChucHoiNghiHoiThaoID]        INT             NULL,
    [HoiNghiHoiThaoID]              INT             NULL,
    [GhiChu]                        NVARCHAR (1000) NULL,
    CONSTRAINT [PK_THUCHIENDETAI_TOCHUCHOINGHIHOITHAO_CHITIET_ToChucHoiNghiHoiThaoChiTietID] PRIMARY KEY CLUSTERED ([ToChucHoiNghiHoiThaoChiTietID] ASC)
);


GO
PRINT N'Creating [dbo].[THUCHIENDETAI_TOCHUCHOINGHIHOITHAO_CHITIET].[IX_THUCHIENDETAI_TOCHUCHOINGHIHOITHAO_CHITIET_ToChucHoiNghiHoiThaoID]...';


GO
CREATE NONCLUSTERED INDEX [IX_THUCHIENDETAI_TOCHUCHOINGHIHOITHAO_CHITIET_ToChucHoiNghiHoiThaoID]
    ON [dbo].[THUCHIENDETAI_TOCHUCHOINGHIHOITHAO_CHITIET]([ToChucHoiNghiHoiThaoID] ASC);


GO
PRINT N'Creating [dbo].[THUCHIENDETAI_TOCHUCHOINGHIHOITHAO_CHITIET].[IX_THUCHIENDETAI_TOCHUCHOINGHIHOITHAO_CHITIET_HoiNghiHoiThaoID]...';


GO
CREATE NONCLUSTERED INDEX [IX_THUCHIENDETAI_TOCHUCHOINGHIHOITHAO_CHITIET_HoiNghiHoiThaoID]
    ON [dbo].[THUCHIENDETAI_TOCHUCHOINGHIHOITHAO_CHITIET]([HoiNghiHoiThaoID] ASC);


GO
PRINT N'Creating [dbo].[THUCHIENDETAI_XETDUYETHOIDONGKHKT]...';


GO
CREATE TABLE [dbo].[THUCHIENDETAI_XETDUYETHOIDONGKHKT] (
    [XetDuyetHoiDongKHKTID] INT             IDENTITY (1, 1) NOT NULL,
    [DeTaiID]               INT             NULL,
    [GhiChu]                NVARCHAR (1000) NULL,
    CONSTRAINT [PK_THUCHIENDETAI_XETDUYETHOIDONGKHKT_XetDuyetHoiDongKHKTID] PRIMARY KEY CLUSTERED ([XetDuyetHoiDongKHKTID] ASC)
);


GO
PRINT N'Creating [dbo].[THUCHIENDETAI_XETDUYETHOIDONGKHKT].[IX_THUCHIENDETAI_XETDUYETHOIDONGKHKT_DeTaiID]...';


GO
CREATE NONCLUSTERED INDEX [IX_THUCHIENDETAI_XETDUYETHOIDONGKHKT_DeTaiID]
    ON [dbo].[THUCHIENDETAI_XETDUYETHOIDONGKHKT]([DeTaiID] ASC);


GO
PRINT N'Creating [dbo].[THUCHIENDETAI_XETDUYETHOIDONGKHKT_CHITIET]...';


GO
CREATE TABLE [dbo].[THUCHIENDETAI_XETDUYETHOIDONGKHKT_CHITIET] (
    [XetDuyetHoiDongKHKTChiTietID] INT             IDENTITY (1, 1) NOT NULL,
    [HoiDongID]                    INT             NULL,
    [XetDuyetHoiDongKHKTID]        INT             NULL,
    [GhiChu]                       NVARCHAR (1000) NULL,
    CONSTRAINT [PK_THUCHIENDETAI_XETDUYETHOIDONGKHKT_CHITIET_XetDuyetHoiDongKHKTChiTietID] PRIMARY KEY CLUSTERED ([XetDuyetHoiDongKHKTChiTietID] ASC)
);


GO
PRINT N'Creating [dbo].[THUCHIENDETAI_XETDUYETHOIDONGKHKT_CHITIET].[IX_THUCHIENDETAI_XETDUYETHOIDONGKHKT_CHITIET_HoiDongID]...';


GO
CREATE NONCLUSTERED INDEX [IX_THUCHIENDETAI_XETDUYETHOIDONGKHKT_CHITIET_HoiDongID]
    ON [dbo].[THUCHIENDETAI_XETDUYETHOIDONGKHKT_CHITIET]([HoiDongID] ASC);


GO
PRINT N'Creating [dbo].[THUCHIENDETAI_XETDUYETHOIDONGKHKT_CHITIET].[IX_THUCHIENDETAI_XETDUYETHOIDONGKHKT_CHITIET_XetDuyetHoiDongKHKTID]...';


GO
CREATE NONCLUSTERED INDEX [IX_THUCHIENDETAI_XETDUYETHOIDONGKHKT_CHITIET_XetDuyetHoiDongKHKTID]
    ON [dbo].[THUCHIENDETAI_XETDUYETHOIDONGKHKT_CHITIET]([XetDuyetHoiDongKHKTID] ASC);


GO
PRINT N'Creating [dbo].[UserProfile]...';


GO
CREATE TABLE [dbo].[UserProfile] (
    [UserId]         INT            IDENTITY (1, 1) NOT NULL,
    [UserType]       TINYINT        NULL,
    [UserName]       NVARCHAR (50)  NULL,
    [FullName]       NVARCHAR (100) NULL,
    [Email]          NVARCHAR (50)  NULL,
    [MaTinh]         VARCHAR (10)   NULL,
    [MaCSKCB]        VARCHAR (10)   NULL,
    [MaChiNhanh]     VARCHAR (10)   NULL,
    [DbName]         VARCHAR (10)   NULL,
    [ChucDanh]       NVARCHAR (100) NULL,
    [DonViCongTac]   NVARCHAR (100) NULL,
    [ManHinhChinh]   NVARCHAR (50)  NULL,
    [Active]         BIT            NULL,
    [NamSinh]        CHAR (4)       NULL,
    [GioiTinh]       TINYINT        NULL,
    [TrinhDo]        NVARCHAR (50)  NULL,
    [LoaiHinhDaoTao] NVARCHAR (200) NULL,
    [SoDienThoai]    VARCHAR (15)   NULL,
    CONSTRAINT [PK_UserProfile] PRIMARY KEY CLUSTERED ([UserId] ASC)
);


GO
PRINT N'Creating [dbo].[UserProfile].[IX_UserProfile_UserName]...';


GO
CREATE NONCLUSTERED INDEX [IX_UserProfile_UserName]
    ON [dbo].[UserProfile]([UserName] ASC);


GO
PRINT N'Creating [dbo].[webpages_Membership]...';


GO
CREATE TABLE [dbo].[webpages_Membership] (
    [UserId]                                  INT            NOT NULL,
    [CreateDate]                              DATETIME       NULL,
    [ConfirmationToken]                       NVARCHAR (128) NULL,
    [IsConfirmed]                             BIT            NULL,
    [LastPasswordFailureDate]                 DATETIME       NULL,
    [PasswordFailuresSinceLastSuccess]        INT            NOT NULL,
    [Password]                                NVARCHAR (128) NOT NULL,
    [PasswordChangedDate]                     DATETIME       NULL,
    [PasswordSalt]                            NVARCHAR (128) NOT NULL,
    [PasswordVerificationToken]               NVARCHAR (128) NULL,
    [PasswordVerificationTokenExpirationDate] DATETIME       NULL,
    PRIMARY KEY CLUSTERED ([UserId] ASC)
);


GO
PRINT N'Creating [dbo].[webpages_OAuthMembership]...';


GO
CREATE TABLE [dbo].[webpages_OAuthMembership] (
    [Provider]       NVARCHAR (30)  NOT NULL,
    [ProviderUserId] NVARCHAR (100) NOT NULL,
    [UserId]         INT            NOT NULL,
    PRIMARY KEY CLUSTERED ([Provider] ASC, [ProviderUserId] ASC)
);


GO
PRINT N'Creating [dbo].[webpages_Roles]...';


GO
CREATE TABLE [dbo].[webpages_Roles] (
    [RoleId]   INT            IDENTITY (1, 1) NOT NULL,
    [RoleName] NVARCHAR (256) NOT NULL,
    PRIMARY KEY CLUSTERED ([RoleId] ASC),
    UNIQUE NONCLUSTERED ([RoleName] ASC)
);


GO
PRINT N'Creating [dbo].[webpages_UsersInRoles]...';


GO
CREATE TABLE [dbo].[webpages_UsersInRoles] (
    [UserId] INT NOT NULL,
    [RoleId] INT NOT NULL,
    PRIMARY KEY CLUSTERED ([UserId] ASC, [RoleId] ASC)
);


GO
PRINT N'Creating [dbo].[XETDUYETDETAI_BOSUNGSUADOI]...';


GO
CREATE TABLE [dbo].[XETDUYETDETAI_BOSUNGSUADOI] (
    [BoSungSuaDoiID]           INT             IDENTITY (1, 1) NOT NULL,
    [LoaiVanBanChinhSuaBoSung] NVARCHAR (1000) NULL,
    [NgayChinhSuaBoSung]       DATE            NULL,
    [DeTaiID]                  INT             NULL,
    CONSTRAINT [PK_XETDUYETDETAI_BOSUNGSUADOI_BoSungSuaDoiID] PRIMARY KEY CLUSTERED ([BoSungSuaDoiID] ASC)
);


GO
PRINT N'Creating [dbo].[XETDUYETDETAI_BOSUNGSUADOI].[IX_XETDUYETDETAI_BOSUNGSUADOI_DeTaiID]...';


GO
CREATE NONCLUSTERED INDEX [IX_XETDUYETDETAI_BOSUNGSUADOI_DeTaiID]
    ON [dbo].[XETDUYETDETAI_BOSUNGSUADOI]([DeTaiID] ASC);


GO
PRINT N'Creating [dbo].[XETDUYETDETAI_DANGKYCAPQUANLY]...';


GO
CREATE TABLE [dbo].[XETDUYETDETAI_DANGKYCAPQUANLY] (
    [DangKyCapQuanLyID] INT             IDENTITY (1, 1) NOT NULL,
    [DeTaiID]           INT             NULL,
    [GhiChu]            NVARCHAR (1000) NULL,
    CONSTRAINT [PK_XETDUYETDETAI_DANGKYCAPQUANLY_DangKyCapQuanLyID] PRIMARY KEY CLUSTERED ([DangKyCapQuanLyID] ASC)
);


GO
PRINT N'Creating [dbo].[XETDUYETDETAI_DANGKYCAPQUANLY].[IX_XETDUYETDETAI_DANGKYCAPQUANLY_DeTaiID]...';


GO
CREATE NONCLUSTERED INDEX [IX_XETDUYETDETAI_DANGKYCAPQUANLY_DeTaiID]
    ON [dbo].[XETDUYETDETAI_DANGKYCAPQUANLY]([DeTaiID] ASC);


GO
PRINT N'Creating [dbo].[XETDUYETDETAI_GHINHANKETQUA]...';


GO
CREATE TABLE [dbo].[XETDUYETDETAI_GHINHANKETQUA] (
    [GhiNhanKetQuaID]           INT   IDENTITY (1, 1) NOT NULL,
    [DeTaiID]                   INT   NULL,
    [KinhPhiCapQuanLy]          MONEY NULL,
    [ThoiGianThucHienCapQuanLy] DATE  NULL,
    CONSTRAINT [PK_XETDUYETDETAI_GHINHANKETQUA_GhiNhanKetQuaID] PRIMARY KEY CLUSTERED ([GhiNhanKetQuaID] ASC)
);


GO
PRINT N'Creating [dbo].[XETDUYETDETAI_GHINHANKETQUA].[IX_XETDUYETDETAI_GHINHANKETQUA_DeTaiID]...';


GO
CREATE NONCLUSTERED INDEX [IX_XETDUYETDETAI_GHINHANKETQUA_DeTaiID]
    ON [dbo].[XETDUYETDETAI_GHINHANKETQUA]([DeTaiID] ASC);


GO
PRINT N'Creating [dbo].[XETDUYETDETAI_HOIDONGDAODUC]...';


GO
CREATE TABLE [dbo].[XETDUYETDETAI_HOIDONGDAODUC] (
    [HoiDongDaoDucID]  INT  IDENTITY (1, 1) NOT NULL,
    [DeTaiID]          INT  NULL,
    [HoiDongID]        INT  NULL,
    [NgayXetDuyet]     DATE NULL,
    [NgayChapThuan]    DATE NULL,
    [KetQuaXetDuyet]   BIT  NOT NULL,
    [CoChinhSuaBoSung] BIT  NOT NULL,
    CONSTRAINT [PK_XETDUYETDETAI_HOIDONGDAODUC_HoiDongDaoDucID] PRIMARY KEY CLUSTERED ([HoiDongDaoDucID] ASC)
);


GO
PRINT N'Creating [dbo].[XETDUYETDETAI_HOIDONGDAODUC].[IX_XETDUYETDETAI_HOIDONGDAODUC_DeTaiID]...';


GO
CREATE NONCLUSTERED INDEX [IX_XETDUYETDETAI_HOIDONGDAODUC_DeTaiID]
    ON [dbo].[XETDUYETDETAI_HOIDONGDAODUC]([DeTaiID] ASC);


GO
PRINT N'Creating [dbo].[XETDUYETDETAI_HOIDONGDAODUC].[IX_XETDUYETDETAI_HOIDONGDAODUC_HoiDongID]...';


GO
CREATE NONCLUSTERED INDEX [IX_XETDUYETDETAI_HOIDONGDAODUC_HoiDongID]
    ON [dbo].[XETDUYETDETAI_HOIDONGDAODUC]([HoiDongID] ASC);


GO
PRINT N'Creating [dbo].[XETDUYETDETAI_TUYENCHONCAPQUANLY]...';


GO
CREATE TABLE [dbo].[XETDUYETDETAI_TUYENCHONCAPQUANLY] (
    [TuyenChonCapQuanLyID] INT             IDENTITY (1, 1) NOT NULL,
    [DeTaiID]              INT             NULL,
    [GhiChu]               NVARCHAR (1000) NULL
);


GO
PRINT N'Creating [dbo].[XETDUYETDETAI_TUYENCHONCAPQUANLY].[IX_XETDUYETDETAI_TUYENCHONCAPQUANLY_DeTaiID]...';


GO
CREATE NONCLUSTERED INDEX [IX_XETDUYETDETAI_TUYENCHONCAPQUANLY_DeTaiID]
    ON [dbo].[XETDUYETDETAI_TUYENCHONCAPQUANLY]([DeTaiID] ASC);


GO
PRINT N'Creating [dbo].[XETDUYETDETAI_YEUCAUXETDUYET]...';


GO
CREATE TABLE [dbo].[XETDUYETDETAI_YEUCAUXETDUYET] (
    [YeuCauXetDuyetID]   INT  IDENTITY (1, 1) NOT NULL,
    [ThoiGianXetDuyet]   DATE NULL,
    [PhuongThucXetDuyet] INT  NULL,
    [DeTaiID]            INT  NULL,
    [LoaiHoiDong]        INT  NULL,
    CONSTRAINT [PK_XETDUYETDETAI_YEUCAUXETDUYET_YeuCauXetDuyetID] PRIMARY KEY CLUSTERED ([YeuCauXetDuyetID] ASC)
);


GO
PRINT N'Creating [dbo].[XETDUYETDETAI_YEUCAUXETDUYET].[IX_XETDUYETDETAI_YEUCAUXETDUYET_DeTaiID]...';


GO
CREATE NONCLUSTERED INDEX [IX_XETDUYETDETAI_YEUCAUXETDUYET_DeTaiID]
    ON [dbo].[XETDUYETDETAI_YEUCAUXETDUYET]([DeTaiID] ASC);


GO
PRINT N'Creating [dbo].[DF_DANGKYDETAI_DeTaiNhanh]...';


GO
ALTER TABLE [dbo].[DANGKYDETAI]
    ADD CONSTRAINT [DF_DANGKYDETAI_DeTaiNhanh] DEFAULT 1 FOR [DeTaiNhanh];


GO
PRINT N'Creating [dbo].[DF_DANHMUC_CANBOTHUCHIEN_GioiTinh]...';


GO
ALTER TABLE [dbo].[DANHMUC_CANBOTHUCHIEN]
    ADD CONSTRAINT [DF_DANHMUC_CANBOTHUCHIEN_GioiTinh] DEFAULT 1 FOR [GioiTinh];


GO
PRINT N'Creating [dbo].[DF_DANHMUC_CHUCDANHKHOAHOC_Active]...';


GO
ALTER TABLE [dbo].[DANHMUC_CHUCDANHKHOAHOC]
    ADD CONSTRAINT [DF_DANHMUC_CHUCDANHKHOAHOC_Active] DEFAULT 1 FOR [Active];


GO
PRINT N'Creating [dbo].[DF_DANHMUC_CHUCVU_Active]...';


GO
ALTER TABLE [dbo].[DANHMUC_CHUCVU]
    ADD CONSTRAINT [DF_DANHMUC_CHUCVU_Active] DEFAULT 1 FOR [Active];


GO
PRINT N'Creating [dbo].[DF_DANHMUC_HOCHAMHOCVI_Active]...';


GO
ALTER TABLE [dbo].[DANHMUC_HOCHAMHOCVI]
    ADD CONSTRAINT [DF_DANHMUC_HOCHAMHOCVI_Active] DEFAULT 1 FOR [Active];


GO
PRINT N'Creating [dbo].[DF_DANHMUC_HOIDONG_NHIEMKY_THANHVIEN_Active]...';


GO
ALTER TABLE [dbo].[DANHMUC_HOIDONG_NHIEMKY_THANHVIEN]
    ADD CONSTRAINT [DF_DANHMUC_HOIDONG_NHIEMKY_THANHVIEN_Active] DEFAULT 1 FOR [Active];


GO
PRINT N'Creating [dbo].[DF_DANHMUC_KHOAPHONG_Active]...';


GO
ALTER TABLE [dbo].[DANHMUC_KHOAPHONG]
    ADD CONSTRAINT [DF_DANHMUC_KHOAPHONG_Active] DEFAULT 1 FOR [Active];


GO
PRINT N'Creating [dbo].[DF_DANHMUC_KHOI_Active]...';


GO
ALTER TABLE [dbo].[DANHMUC_KHOI]
    ADD CONSTRAINT [DF_DANHMUC_KHOI_Active] DEFAULT 1 FOR [Active];


GO
PRINT N'Creating [dbo].[DF_DANHMUC_LOAIHOSO_Active]...';


GO
ALTER TABLE [dbo].[DANHMUC_LOAIHOSO]
    ADD CONSTRAINT [DF_DANHMUC_LOAIHOSO_Active] DEFAULT 1 FOR [Active];


GO
PRINT N'Creating [dbo].[DF_DANHMUC_LOAIVANBANDINHKEM_Active]...';


GO
ALTER TABLE [dbo].[DANHMUC_LOAIVANBANDINHKEM]
    ADD CONSTRAINT [DF_DANHMUC_LOAIVANBANDINHKEM_Active] DEFAULT 1 FOR [Active];


GO
PRINT N'Creating [dbo].[DF_DANHMUC_NGUONKINHPHI_Active]...';


GO
ALTER TABLE [dbo].[DANHMUC_NGUONKINHPHI]
    ADD CONSTRAINT [DF_DANHMUC_NGUONKINHPHI_Active] DEFAULT 1 FOR [Active];


GO
PRINT N'Creating [dbo].[DF_DANHMUC_TINHTRANGDETAI_Active]...';


GO
ALTER TABLE [dbo].[DANHMUC_TINHTRANGDETAI]
    ADD CONSTRAINT [DF_DANHMUC_TINHTRANGDETAI_Active] DEFAULT 1 FOR [Active];


GO
PRINT N'Creating [dbo].[DETAIBENNGOAI_NHANYEUCAU_DuThuTuc]...';


GO
ALTER TABLE [dbo].[DETAIBENNGOAI_NHANYEUCAU]
    ADD CONSTRAINT [DETAIBENNGOAI_NHANYEUCAU_DuThuTuc] DEFAULT 1 FOR [DuThuTuc];


GO
PRINT N'Creating [dbo].[DETAIBENNGOAI_NHANYEUCAU_ThieuChapThuat]...';


GO
ALTER TABLE [dbo].[DETAIBENNGOAI_NHANYEUCAU]
    ADD CONSTRAINT [DETAIBENNGOAI_NHANYEUCAU_ThieuChapThuat] DEFAULT 1 FOR [ThieuChapThuan];


GO
PRINT N'Creating [dbo].[DF_Function_IsDanhMuc]...';


GO
ALTER TABLE [dbo].[Function]
    ADD CONSTRAINT [DF_Function_IsDanhMuc] DEFAULT 0 FOR [IsDanhMuc];


GO
PRINT N'Creating [dbo].[DF_HOIDONG_YEUCAU_XETDUYET_DayDuHoSo]...';


GO
ALTER TABLE [dbo].[HOIDONG_YEUCAU_XETDUYET]
    ADD CONSTRAINT [DF_HOIDONG_YEUCAU_XETDUYET_DayDuHoSo] DEFAULT 1 FOR [DayDuHoSo];


GO
PRINT N'Creating [dbo].[DF_HOINGHI_DANGKY_TapChiDang]...';


GO
ALTER TABLE [dbo].[HOINGHI_DANGKY]
    ADD CONSTRAINT [DF_HOINGHI_DANGKY_TapChiDang] DEFAULT 1 FOR [TapChiDang];


GO
PRINT N'Creating [dbo].[DF_HOINGHI_DUYEBAIDANGKY_BoSung]...';


GO
ALTER TABLE [dbo].[HOINGHI_DUYEBAIDANGKY]
    ADD CONSTRAINT [DF_HOINGHI_DUYEBAIDANGKY_BoSung] DEFAULT 1 FOR [BoSung];


GO
PRINT N'Creating [dbo].[DF_HOINGHI_DUYEBAIDANGKY_Duyet]...';


GO
ALTER TABLE [dbo].[HOINGHI_DUYEBAIDANGKY]
    ADD CONSTRAINT [DF_HOINGHI_DUYEBAIDANGKY_Duyet] DEFAULT 1 FOR [Duyet];


GO
PRINT N'Creating [dbo].[DF_NGHIEMTHU_BOSUNGSUADOI_CoHopHoiDongXetLai]...';


GO
ALTER TABLE [dbo].[NGHIEMTHU_BOSUNGSUADOI]
    ADD CONSTRAINT [DF_NGHIEMTHU_BOSUNGSUADOI_CoHopHoiDongXetLai] DEFAULT 1 FOR [CoHopHoiDongXetLai];


GO
PRINT N'Creating [dbo].[DF_NGHIEMTHU_NGHIEMTHUDETAICAPCOSO_CoChinhSuaBoSung]...';


GO
ALTER TABLE [dbo].[NGHIEMTHU_NGHIEMTHUDETAICAPCOSO]
    ADD CONSTRAINT [DF_NGHIEMTHU_NGHIEMTHUDETAICAPCOSO_CoChinhSuaBoSung] DEFAULT 1 FOR [CoChinhSuaBoSung];


GO
PRINT N'Creating [dbo].[DF_NGHIEMTHU_NGHIEMTHUDETAICAPQUANLY_KetQuaNghiemThuCapQuanLy]...';


GO
ALTER TABLE [dbo].[NGHIEMTHU_NGHIEMTHUDETAICAPQUANLY]
    ADD CONSTRAINT [DF_NGHIEMTHU_NGHIEMTHUDETAICAPQUANLY_KetQuaNghiemThuCapQuanLy] DEFAULT 1 FOR [KetQuaNghiemThuCapQuanLy];


GO
PRINT N'Creating [dbo].[DF_RoleRight_CanCreate]...';


GO
ALTER TABLE [dbo].[RoleRight]
    ADD CONSTRAINT [DF_RoleRight_CanCreate] DEFAULT 0 FOR [CanCreate];


GO
PRINT N'Creating [dbo].[DF_RoleRight_CanUpdate]...';


GO
ALTER TABLE [dbo].[RoleRight]
    ADD CONSTRAINT [DF_RoleRight_CanUpdate] DEFAULT 0 FOR [CanUpdate];


GO
PRINT N'Creating [dbo].[DF_RoleRight_CanDelete]...';


GO
ALTER TABLE [dbo].[RoleRight]
    ADD CONSTRAINT [DF_RoleRight_CanDelete] DEFAULT 0 FOR [CanDelete];


GO
PRINT N'Creating [dbo].[DF_THUCHIENDETAI_DENGHIDIEUCHINHNOIDUNG_CHITIET_KetQuaDeNghiDieuChinh]...';


GO
ALTER TABLE [dbo].[THUCHIENDETAI_DENGHIDIEUCHINHNOIDUNG_CHITIET]
    ADD CONSTRAINT [DF_THUCHIENDETAI_DENGHIDIEUCHINHNOIDUNG_CHITIET_KetQuaDeNghiDieuChinh] DEFAULT 1 FOR [KetQuaDeNghiDieuChinh];


GO
PRINT N'Creating [dbo].[DF_THUCHIENDETAI_DENGHIGIAHAN_CHITIET_KetQuaDeNghiGiaHan]...';


GO
ALTER TABLE [dbo].[THUCHIENDETAI_DENGHIGIAHAN_CHITIET]
    ADD CONSTRAINT [DF_THUCHIENDETAI_DENGHIGIAHAN_CHITIET_KetQuaDeNghiGiaHan] DEFAULT 1 FOR [KetQuaDeNghiGiaHan];


GO
PRINT N'Creating [dbo].[UserProfile_DEFAULT_Active]...';


GO
ALTER TABLE [dbo].[UserProfile]
    ADD CONSTRAINT [UserProfile_DEFAULT_Active] DEFAULT 1 FOR [Active];


GO
PRINT N'Creating unnamed constraint on [dbo].[webpages_Membership]...';


GO
ALTER TABLE [dbo].[webpages_Membership]
    ADD DEFAULT ((0)) FOR [IsConfirmed];


GO
PRINT N'Creating unnamed constraint on [dbo].[webpages_Membership]...';


GO
ALTER TABLE [dbo].[webpages_Membership]
    ADD DEFAULT ((0)) FOR [PasswordFailuresSinceLastSuccess];


GO
PRINT N'Creating [dbo].[DF_XETDUYETDETAI_HOIDONGDAODUC_KetQuaXetDuyet]...';


GO
ALTER TABLE [dbo].[XETDUYETDETAI_HOIDONGDAODUC]
    ADD CONSTRAINT [DF_XETDUYETDETAI_HOIDONGDAODUC_KetQuaXetDuyet] DEFAULT 1 FOR [KetQuaXetDuyet];


GO
PRINT N'Creating [dbo].[DF_XETDUYETDETAI_HOIDONGDAODUC_CoChinhSuaBoSung]...';


GO
ALTER TABLE [dbo].[XETDUYETDETAI_HOIDONGDAODUC]
    ADD CONSTRAINT [DF_XETDUYETDETAI_HOIDONGDAODUC_CoChinhSuaBoSung] DEFAULT 1 FOR [CoChinhSuaBoSung];


GO
PRINT N'Creating Full-text Index on [dbo].[DANGKYDETAI]...';


GO
CREATE FULLTEXT INDEX ON [dbo].[DANGKYDETAI]
    ([TenDeTai])
    KEY INDEX [PK_DANGKYDETAI_DeTaiID]
    ON [FTC_DANGKYDETAI_TenDeTai];


GO
PRINT N'Creating Full-text Index on [dbo].[DETAIBENNGOAI_NHANYEUCAU]...';


GO
CREATE FULLTEXT INDEX ON [dbo].[DETAIBENNGOAI_NHANYEUCAU]
    ([TenDeTai])
    KEY INDEX [PK_DETAIBENNGOAI_NHANYEUCAU_DeTaiBenNgoaiID]
    ON [FTC_NhanYeuCauLaySoLieu_TenDeTai];


GO
PRINT N'Creating Full-text Index on [dbo].[DETAIBENNGOAI_XETDUYET_HDDAODUC]...';


GO
CREATE FULLTEXT INDEX ON [dbo].[DETAIBENNGOAI_XETDUYET_HDDAODUC]
    ([PhuongThucXetDuyet])
    KEY INDEX [PK_DETAIBENNGOAI_XETDUYET_HDDAODUC_XetDuyetHDDDID]
    ON [FTC_XetDuyet_HDDaoDuc];


GO
PRINT N'Creating [dbo].[FK_DANGKYDETAI_NguonKinhPhiID]...';


GO
ALTER TABLE [dbo].[DANGKYDETAI]
    ADD CONSTRAINT [FK_DANGKYDETAI_NguonKinhPhiID] FOREIGN KEY ([NguonKinhPhiID]) REFERENCES [dbo].[DANHMUC_NGUONKINHPHI] ([DMNguonKinhPhiID]);


GO
PRINT N'Creating [dbo].[FK_DANGKYDETAI_KhoaPhongID]...';


GO
ALTER TABLE [dbo].[DANGKYDETAI]
    ADD CONSTRAINT [FK_DANGKYDETAI_KhoaPhongID] FOREIGN KEY ([KhoaPhongID]) REFERENCES [dbo].[DANHMUC_KHOAPHONG] ([DMKhoaPhongID]);


GO
PRINT N'Creating [dbo].[FK_DANGKYDETAI_TinhTrangDeTaiID]...';


GO
ALTER TABLE [dbo].[DANGKYDETAI]
    ADD CONSTRAINT [FK_DANGKYDETAI_TinhTrangDeTaiID] FOREIGN KEY ([TinhTrangDeTaiID]) REFERENCES [dbo].[DANHMUC_TINHTRANGDETAI] ([DMTinhTrangDeTaiID]);


GO
PRINT N'Creating [dbo].[FK_DANGKYDETAI_ChuNhiemDeTaiID]...';


GO
ALTER TABLE [dbo].[DANGKYDETAI]
    ADD CONSTRAINT [FK_DANGKYDETAI_ChuNhiemDeTaiID] FOREIGN KEY ([ChuNhiemDeTaiID]) REFERENCES [dbo].[DANHMUC_CANBOTHUCHIEN] ([CanBoThucHienID]);


GO
PRINT N'Creating [dbo].[FK_DANGKYDETAI_DongChuNhiemDeTaiID]...';


GO
ALTER TABLE [dbo].[DANGKYDETAI]
    ADD CONSTRAINT [FK_DANGKYDETAI_DongChuNhiemDeTaiID] FOREIGN KEY ([DongChuNhiemDeTaiID]) REFERENCES [dbo].[DANHMUC_CANBOTHUCHIEN] ([CanBoThucHienID]);


GO
PRINT N'Creating [dbo].[FK_DANGKYDETAI_CONGSUTHAMGIA_DeTaiID]...';


GO
ALTER TABLE [dbo].[DANGKYDETAI_CONGSUTHAMGIA]
    ADD CONSTRAINT [FK_DANGKYDETAI_CONGSUTHAMGIA_DeTaiID] FOREIGN KEY ([DeTaiID]) REFERENCES [dbo].[DANGKYDETAI] ([DeTaiID]);


GO
PRINT N'Creating [dbo].[FK_DANGKYDETAI_CONGSUTHAMGIA_CanBoThucHienID]...';


GO
ALTER TABLE [dbo].[DANGKYDETAI_CONGSUTHAMGIA]
    ADD CONSTRAINT [FK_DANGKYDETAI_CONGSUTHAMGIA_CanBoThucHienID] FOREIGN KEY ([CanBoThucHienID]) REFERENCES [dbo].[DANHMUC_CANBOTHUCHIEN] ([CanBoThucHienID]);


GO
PRINT N'Creating [dbo].[FK_DANGKYDETAI_DETAINHANH_GhiNhanKetQuaID]...';


GO
ALTER TABLE [dbo].[DANGKYDETAI_DETAINHANH]
    ADD CONSTRAINT [FK_DANGKYDETAI_DETAINHANH_GhiNhanKetQuaID] FOREIGN KEY ([GhiNhanKetQuaID]) REFERENCES [dbo].[XETDUYETDETAI_GHINHANKETQUA] ([GhiNhanKetQuaID]);


GO
PRINT N'Creating [dbo].[FK_DANGKYDETAI_DETAINHANH_CanBoThucHienID]...';


GO
ALTER TABLE [dbo].[DANGKYDETAI_DETAINHANH]
    ADD CONSTRAINT [FK_DANGKYDETAI_DETAINHANH_CanBoThucHienID] FOREIGN KEY ([CanBoThucHienID]) REFERENCES [dbo].[DANHMUC_CANBOTHUCHIEN] ([CanBoThucHienID]);


GO
PRINT N'Creating [dbo].[FK_DANHMUC_CANBOTHUCHIEN_HocHamHocViID]...';


GO
ALTER TABLE [dbo].[DANHMUC_CANBOTHUCHIEN]
    ADD CONSTRAINT [FK_DANHMUC_CANBOTHUCHIEN_HocHamHocViID] FOREIGN KEY ([HocHamHocViID]) REFERENCES [dbo].[DANHMUC_HOCHAMHOCVI] ([DMHocHamHocViID]);


GO
PRINT N'Creating [dbo].[FK_DANHMUC_CANBOTHUCHIEN_ChucDanhKhoaHocID]...';


GO
ALTER TABLE [dbo].[DANHMUC_CANBOTHUCHIEN]
    ADD CONSTRAINT [FK_DANHMUC_CANBOTHUCHIEN_ChucDanhKhoaHocID] FOREIGN KEY ([ChucDanhKhoaHocID]) REFERENCES [dbo].[DANHMUC_CHUCDANHKHOAHOC] ([DMChucDanhKhoaHocID]);


GO
PRINT N'Creating [dbo].[FK_DANHMUC_CANBOTHUCHIEN_ChucVuID]...';


GO
ALTER TABLE [dbo].[DANHMUC_CANBOTHUCHIEN]
    ADD CONSTRAINT [FK_DANHMUC_CANBOTHUCHIEN_ChucVuID] FOREIGN KEY ([ChucVuID]) REFERENCES [dbo].[DANHMUC_CHUCVU] ([DMChucVuID]);


GO
PRINT N'Creating [dbo].[FK_DANHMUC_CANBOTHUCHIEN_KhoaPhongID]...';


GO
ALTER TABLE [dbo].[DANHMUC_CANBOTHUCHIEN]
    ADD CONSTRAINT [FK_DANHMUC_CANBOTHUCHIEN_KhoaPhongID] FOREIGN KEY ([KhoaPhongID]) REFERENCES [dbo].[DANHMUC_KHOAPHONG] ([DMKhoaPhongID]);


GO
PRINT N'Creating [dbo].[FK_DANHMUC_HOIDONG_NHIEMKY_THANHVIEN_ToTable]...';


GO
ALTER TABLE [dbo].[DANHMUC_HOIDONG_NHIEMKY_THANHVIEN]
    ADD CONSTRAINT [FK_DANHMUC_HOIDONG_NHIEMKY_THANHVIEN_ToTable] FOREIGN KEY ([ChucVuID]) REFERENCES [dbo].[DANHMUC_CHUCVU] ([DMChucVuID]);


GO
PRINT N'Creating [dbo].[FK_DETAIBENNGOAI_BAOCAOHOANTAT_DETAIBENNGOAI_NHANYEUCAU]...';


GO
ALTER TABLE [dbo].[DETAIBENNGOAI_BAOCAOHOANTAT]
    ADD CONSTRAINT [FK_DETAIBENNGOAI_BAOCAOHOANTAT_DETAIBENNGOAI_NHANYEUCAU] FOREIGN KEY ([DeTaiBenNgoaiID]) REFERENCES [dbo].[DETAIBENNGOAI_NHANYEUCAU] ([DeTaiBenNgoaiID]);


GO
PRINT N'Creating [dbo].[FK_DETAIBENNGOAI_GIAMSATKIEMTRA_DETAIBENNGOAI_NHANYEUCAU]...';


GO
ALTER TABLE [dbo].[DETAIBENNGOAI_GIAMSATKIEMTRA]
    ADD CONSTRAINT [FK_DETAIBENNGOAI_GIAMSATKIEMTRA_DETAIBENNGOAI_NHANYEUCAU] FOREIGN KEY ([DeTaiBenNgoaiID]) REFERENCES [dbo].[DETAIBENNGOAI_NHANYEUCAU] ([DeTaiBenNgoaiID]);


GO
PRINT N'Creating [dbo].[FK_DETAIBENNGOAI_GIAMSATKIEMTRA_THANHVIEN_DETAIBENNGOAI_GIAMSATKIEMTRA]...';


GO
ALTER TABLE [dbo].[DETAIBENNGOAI_GIAMSATKIEMTRA_THANHVIEN]
    ADD CONSTRAINT [FK_DETAIBENNGOAI_GIAMSATKIEMTRA_THANHVIEN_DETAIBENNGOAI_GIAMSATKIEMTRA] FOREIGN KEY ([GiamSatKiemTraID]) REFERENCES [dbo].[DETAIBENNGOAI_GIAMSATKIEMTRA] ([GiamSatKiemTraID]);


GO
PRINT N'Creating [dbo].[FK_DETAIBENNGOAI_LAMGIAYGIOITHIEU_DETAIBENNGOAI_NHANYEUCAU]...';


GO
ALTER TABLE [dbo].[DETAIBENNGOAI_LAMGIAYGIOITHIEU]
    ADD CONSTRAINT [FK_DETAIBENNGOAI_LAMGIAYGIOITHIEU_DETAIBENNGOAI_NHANYEUCAU] FOREIGN KEY ([DeTaiBenNgoaiID]) REFERENCES [dbo].[DETAIBENNGOAI_NHANYEUCAU] ([DeTaiBenNgoaiID]);


GO
PRINT N'Creating [dbo].[FK_DETAIBENNGOAI_LAMGIAYGIOITHIEU_DANHMUC_KHOAPHONG]...';


GO
ALTER TABLE [dbo].[DETAIBENNGOAI_LAMGIAYGIOITHIEU]
    ADD CONSTRAINT [FK_DETAIBENNGOAI_LAMGIAYGIOITHIEU_DANHMUC_KHOAPHONG] FOREIGN KEY ([DMKhoaPhongID]) REFERENCES [dbo].[DANHMUC_KHOAPHONG] ([DMKhoaPhongID]);


GO
PRINT N'Creating [dbo].[FK_DETAIBENNGOAI_NGHIENCUUSINH_DETAIBENNGOAI_NHANYEUCAU]...';


GO
ALTER TABLE [dbo].[DETAIBENNGOAI_NGHIENCUUSINH]
    ADD CONSTRAINT [FK_DETAIBENNGOAI_NGHIENCUUSINH_DETAIBENNGOAI_NHANYEUCAU] FOREIGN KEY ([DeTaiBenNgoaiID]) REFERENCES [dbo].[DETAIBENNGOAI_NHANYEUCAU] ([DeTaiBenNgoaiID]);


GO
PRINT N'Creating [dbo].[FK_DETAIBENNGOAI_XETDUYET_HDDAODUC_DETAIBENNGOAI_NHANYEUCAU]...';


GO
ALTER TABLE [dbo].[DETAIBENNGOAI_XETDUYET_HDDAODUC]
    ADD CONSTRAINT [FK_DETAIBENNGOAI_XETDUYET_HDDAODUC_DETAIBENNGOAI_NHANYEUCAU] FOREIGN KEY ([DeTaiBenNgoaiID]) REFERENCES [dbo].[DETAIBENNGOAI_NHANYEUCAU] ([DeTaiBenNgoaiID]);


GO
PRINT N'Creating [dbo].[FK_DETAIBENNGOAI_XETDUYET_HDDAODUC_HOIDONG_YEUCAU_XETDUYET]...';


GO
ALTER TABLE [dbo].[DETAIBENNGOAI_XETDUYET_HDDAODUC]
    ADD CONSTRAINT [FK_DETAIBENNGOAI_XETDUYET_HDDAODUC_HOIDONG_YEUCAU_XETDUYET] FOREIGN KEY ([HoiDongID]) REFERENCES [dbo].[HOIDONG_YEUCAU_XETDUYET] ([HoiDongID]);


GO
PRINT N'Creating [dbo].[FK_DINHKEM_DINHKEMVANBAN_LoaiVanBanDinhKem]...';


GO
ALTER TABLE [dbo].[DINHKEM_DINHKEMVANBAN]
    ADD CONSTRAINT [FK_DINHKEM_DINHKEMVANBAN_LoaiVanBanDinhKem] FOREIGN KEY ([LoaiVanBanDinhKemID]) REFERENCES [dbo].[DANHMUC_LOAIVANBANDINHKEM] ([LoaiVanBanDinhKemID]);


GO
PRINT N'Creating [dbo].[FK_HOIDONG_CHONLUA_HoiDong_HoiDongID]...';


GO
ALTER TABLE [dbo].[HOIDONG_CHONLUA]
    ADD CONSTRAINT [FK_HOIDONG_CHONLUA_HoiDong_HoiDongID] FOREIGN KEY ([HoiDongID]) REFERENCES [dbo].[HOIDONG_YEUCAU_XETDUYET] ([HoiDongID]);


GO
PRINT N'Creating [dbo].[FK_HOIDONG_CHONLUA_THANHVIEN_HOIDONG_CHONLUA]...';


GO
ALTER TABLE [dbo].[HOIDONG_CHONLUA_THANHVIEN]
    ADD CONSTRAINT [FK_HOIDONG_CHONLUA_THANHVIEN_HOIDONG_CHONLUA] FOREIGN KEY ([ChonLuaID]) REFERENCES [dbo].[HOIDONG_CHONLUA] ([ChonLuaID]);


GO
PRINT N'Creating [dbo].[FK_HOIDONG_CHUANBI_CUOCHOP_HOIDONG_YEUCAU_XETDUYET]...';


GO
ALTER TABLE [dbo].[HOIDONG_CHUANBI_CUOCHOP]
    ADD CONSTRAINT [FK_HOIDONG_CHUANBI_CUOCHOP_HOIDONG_YEUCAU_XETDUYET] FOREIGN KEY ([HoiDongID]) REFERENCES [dbo].[HOIDONG_YEUCAU_XETDUYET] ([HoiDongID]);


GO
PRINT N'Creating [dbo].[FK_HOIDONG_CHUANBI_CUOCHOP_THANHVIEN_HOIDONG_CHUANBI_CUOCHOP]...';


GO
ALTER TABLE [dbo].[HOIDONG_CHUANBI_CUOCHOP_THANHVIEN]
    ADD CONSTRAINT [FK_HOIDONG_CHUANBI_CUOCHOP_THANHVIEN_HOIDONG_CHUANBI_CUOCHOP] FOREIGN KEY ([CuocHopID]) REFERENCES [dbo].[HOIDONG_CHUANBI_CUOCHOP] ([CuocHopID]);


GO
PRINT N'Creating [dbo].[FK_HOIDONG_CHUANBI_CUOCHOP_THANHVIEN_HOIDONG_CHONLUA_THANHVIEN]...';


GO
ALTER TABLE [dbo].[HOIDONG_CHUANBI_CUOCHOP_THANHVIEN]
    ADD CONSTRAINT [FK_HOIDONG_CHUANBI_CUOCHOP_THANHVIEN_HOIDONG_CHONLUA_THANHVIEN] FOREIGN KEY ([ThanhVienHDID]) REFERENCES [dbo].[HOIDONG_CHONLUA_THANHVIEN] ([ThanhVienHDID]);


GO
PRINT N'Creating [dbo].[FK_HOIDONG_GHINHAN_KETQUA_HOIDONG_YEUCAU_XETDUYET]...';


GO
ALTER TABLE [dbo].[HOIDONG_GHINHAN_KETQUA]
    ADD CONSTRAINT [FK_HOIDONG_GHINHAN_KETQUA_HOIDONG_YEUCAU_XETDUYET] FOREIGN KEY ([HoiDongID]) REFERENCES [dbo].[HOIDONG_YEUCAU_XETDUYET] ([HoiDongID]);


GO
PRINT N'Creating [dbo].[FK_HOIDONG_GHINHAN_KETQUA_THANVIEN_HOIDONG_CHUANBI_CUOCHOP_THANHVIEN]...';


GO
ALTER TABLE [dbo].[HOIDONG_GHINHAN_KETQUA_THANVIEN]
    ADD CONSTRAINT [FK_HOIDONG_GHINHAN_KETQUA_THANVIEN_HOIDONG_CHUANBI_CUOCHOP_THANHVIEN] FOREIGN KEY ([ThanhVienCuocHopID]) REFERENCES [dbo].[HOIDONG_CHUANBI_CUOCHOP_THANHVIEN] ([ThanhVienCuocHopID]);


GO
PRINT N'Creating [dbo].[FK_HOIDONG_NHIEMKY_CHITIET_HOIDONG_NHIEMKY]...';


GO
ALTER TABLE [dbo].[HOIDONG_NHIEMKY_CHITIET]
    ADD CONSTRAINT [FK_HOIDONG_NHIEMKY_CHITIET_HOIDONG_NHIEMKY] FOREIGN KEY ([HDNhiemKyID]) REFERENCES [dbo].[HOIDONG_NHIEMKY] ([HDNhiemKyID]);


GO
PRINT N'Creating [dbo].[FK_HOIDONG_NHIEMKY_CHITIET_DANHMUC_HOIDONG_NHIEMKY_THANHVIEN]...';


GO
ALTER TABLE [dbo].[HOIDONG_NHIEMKY_CHITIET]
    ADD CONSTRAINT [FK_HOIDONG_NHIEMKY_CHITIET_DANHMUC_HOIDONG_NHIEMKY_THANHVIEN] FOREIGN KEY ([ThanhVienNhiemKyID]) REFERENCES [dbo].[DANHMUC_HOIDONG_NHIEMKY_THANHVIEN] ([ThanhVienNhiemKyID]);


GO
PRINT N'Creating [dbo].[FK_HOIDONG_YEUCAU_XETDUYET_DMLoaiHoSoID]...';


GO
ALTER TABLE [dbo].[HOIDONG_YEUCAU_XETDUYET]
    ADD CONSTRAINT [FK_HOIDONG_YEUCAU_XETDUYET_DMLoaiHoSoID] FOREIGN KEY ([DMLoaiHoSoID]) REFERENCES [dbo].[DANHMUC_LOAIHOSO] ([DMLoaiHoSoID]);


GO
PRINT N'Creating [dbo].[FK_HOIDONG_YEUCAU_XETDUYET_DANHMUC_KHOAPHONG]...';


GO
ALTER TABLE [dbo].[HOIDONG_YEUCAU_XETDUYET]
    ADD CONSTRAINT [FK_HOIDONG_YEUCAU_XETDUYET_DANHMUC_KHOAPHONG] FOREIGN KEY ([DMKhoaPhongID]) REFERENCES [dbo].[DANHMUC_KHOAPHONG] ([DMKhoaPhongID]);


GO
PRINT N'Creating [dbo].[FK_CHOINGHI_DANGKY_DANHMUC_KHOAPHONG]...';


GO
ALTER TABLE [dbo].[HOINGHI_DANGKY]
    ADD CONSTRAINT [FK_CHOINGHI_DANGKY_DANHMUC_KHOAPHONG] FOREIGN KEY ([DMKhoaPhongID]) REFERENCES [dbo].[DANHMUC_KHOAPHONG] ([DMKhoaPhongID]);


GO
PRINT N'Creating [dbo].[FK_HOINGHI_DANGKY_DANHMUC_KHOI]...';


GO
ALTER TABLE [dbo].[HOINGHI_DANGKY]
    ADD CONSTRAINT [FK_HOINGHI_DANGKY_DANHMUC_KHOI] FOREIGN KEY ([DMKhoiID]) REFERENCES [dbo].[DANHMUC_KHOI] ([DMKhoiID]);


GO
PRINT N'Creating [dbo].[FK_HOINGHI_DANGKY_CHOINGHI_DANGKY]...';


GO
ALTER TABLE [dbo].[HOINGHI_DANGKY]
    ADD CONSTRAINT [FK_HOINGHI_DANGKY_CHOINGHI_DANGKY] FOREIGN KEY ([HoiNghiID]) REFERENCES [dbo].[HOINGHI_DANGKY] ([DangKyHoiNghiID]);


GO
PRINT N'Creating [dbo].[FK_HOINGHI_DUYEBAIDANGKY_HOINGHI_DANGKY]...';


GO
ALTER TABLE [dbo].[HOINGHI_DUYEBAIDANGKY]
    ADD CONSTRAINT [FK_HOINGHI_DUYEBAIDANGKY_HOINGHI_DANGKY] FOREIGN KEY ([HoiNghiID]) REFERENCES [dbo].[HOINGHI_TOCHUCMODOT] ([HoiNghiID]);


GO
PRINT N'Creating [dbo].[FK_HOINGHI_GHINHANKETQUA_HOINGHI_DANGKY]...';


GO
ALTER TABLE [dbo].[HOINGHI_GHINHANKETQUA]
    ADD CONSTRAINT [FK_HOINGHI_GHINHANKETQUA_HOINGHI_DANGKY] FOREIGN KEY ([HoiNghiID]) REFERENCES [dbo].[HOINGHI_TOCHUCMODOT] ([HoiNghiID]);


GO
PRINT N'Creating [dbo].[FK_HOINGHI_GUIBAIDANGKY_DANHMUC_KHOAPHONG]...';


GO
ALTER TABLE [dbo].[HOINGHI_GUIBAIDANGKY]
    ADD CONSTRAINT [FK_HOINGHI_GUIBAIDANGKY_DANHMUC_KHOAPHONG] FOREIGN KEY ([DMKhoaPhongID]) REFERENCES [dbo].[DANHMUC_KHOAPHONG] ([DMKhoaPhongID]);


GO
PRINT N'Creating [dbo].[FK_HOINGHI_LAPCHUONGTRINH_HOINGHI_DANGKY]...';


GO
ALTER TABLE [dbo].[HOINGHI_LAPCHUONGTRINH]
    ADD CONSTRAINT [FK_HOINGHI_LAPCHUONGTRINH_HOINGHI_DANGKY] FOREIGN KEY ([HoiNghiID]) REFERENCES [dbo].[HOINGHI_TOCHUCMODOT] ([HoiNghiID]);


GO
PRINT N'Creating [dbo].[FK_HOINGHI_LAPCHUONGTRINH_CHITIET_HOINGHI_LAPCHUONGTRINH]...';


GO
ALTER TABLE [dbo].[HOINGHI_LAPCHUONGTRINH_CHITIET]
    ADD CONSTRAINT [FK_HOINGHI_LAPCHUONGTRINH_CHITIET_HOINGHI_LAPCHUONGTRINH] FOREIGN KEY ([LapChuongTrinhID]) REFERENCES [dbo].[HOINGHI_LAPCHUONGTRINH] ([LapChuongTrinhID]);


GO
PRINT N'Creating [dbo].[FK_HOINGHI_LAPCHUONGTRINH_CHITIET_DANHMUC_KHOI]...';


GO
ALTER TABLE [dbo].[HOINGHI_LAPCHUONGTRINH_CHITIET]
    ADD CONSTRAINT [FK_HOINGHI_LAPCHUONGTRINH_CHITIET_DANHMUC_KHOI] FOREIGN KEY ([DMKhoiID]) REFERENCES [dbo].[DANHMUC_KHOI] ([DMKhoiID]);


GO
PRINT N'Creating [dbo].[FK_NGHIEMTHU_BOSUNGSUADOI_DeTaiID]...';


GO
ALTER TABLE [dbo].[NGHIEMTHU_BOSUNGSUADOI]
    ADD CONSTRAINT [FK_NGHIEMTHU_BOSUNGSUADOI_DeTaiID] FOREIGN KEY ([DeTaiID]) REFERENCES [dbo].[DANGKYDETAI] ([DeTaiID]);


GO
PRINT N'Creating [dbo].[FK_NGHIEMTHU_DENGHICAPCOSO_DeTaiID]...';


GO
ALTER TABLE [dbo].[NGHIEMTHU_DENGHICAPCOSO]
    ADD CONSTRAINT [FK_NGHIEMTHU_DENGHICAPCOSO_DeTaiID] FOREIGN KEY ([DeTaiID]) REFERENCES [dbo].[DANGKYDETAI] ([DeTaiID]);


GO
PRINT N'Creating [dbo].[FK_NGHIEMTHU_DENGHICAPQUANLY_DeTaiID]...';


GO
ALTER TABLE [dbo].[NGHIEMTHU_DENGHICAPQUANLY]
    ADD CONSTRAINT [FK_NGHIEMTHU_DENGHICAPQUANLY_DeTaiID] FOREIGN KEY ([DeTaiID]) REFERENCES [dbo].[DANGKYDETAI] ([DeTaiID]);


GO
PRINT N'Creating [dbo].[FK_NGHIEMTHU_NGHIEMTHUDETAICAPCOSO_DeTaiID]...';


GO
ALTER TABLE [dbo].[NGHIEMTHU_NGHIEMTHUDETAICAPCOSO]
    ADD CONSTRAINT [FK_NGHIEMTHU_NGHIEMTHUDETAICAPCOSO_DeTaiID] FOREIGN KEY ([DeTaiID]) REFERENCES [dbo].[DANGKYDETAI] ([DeTaiID]);


GO
PRINT N'Creating [dbo].[FK_NGHIEMTHU_NGHIEMTHUDETAICAPCOSO_HoiDongID]...';


GO
ALTER TABLE [dbo].[NGHIEMTHU_NGHIEMTHUDETAICAPCOSO]
    ADD CONSTRAINT [FK_NGHIEMTHU_NGHIEMTHUDETAICAPCOSO_HoiDongID] FOREIGN KEY ([HoiDongID]) REFERENCES [dbo].[HOIDONG_YEUCAU_XETDUYET] ([HoiDongID]);


GO
PRINT N'Creating [dbo].[FK_NGHIEMTHU_NGHIEMTHUDETAICAPQUANLY_DeTaiID]...';


GO
ALTER TABLE [dbo].[NGHIEMTHU_NGHIEMTHUDETAICAPQUANLY]
    ADD CONSTRAINT [FK_NGHIEMTHU_NGHIEMTHUDETAICAPQUANLY_DeTaiID] FOREIGN KEY ([DeTaiID]) REFERENCES [dbo].[DANGKYDETAI] ([DeTaiID]);


GO
PRINT N'Creating [dbo].[FK_RoleRight_FunctionCode]...';


GO
ALTER TABLE [dbo].[RoleRight]
    ADD CONSTRAINT [FK_RoleRight_FunctionCode] FOREIGN KEY ([FunctionCode]) REFERENCES [dbo].[Function] ([FunctionCode]);


GO
PRINT N'Creating [dbo].[FK_THUCHIENDETAI_BAOCAODINHKY_DeTaiID]...';


GO
ALTER TABLE [dbo].[THUCHIENDETAI_BAOCAODINHKY]
    ADD CONSTRAINT [FK_THUCHIENDETAI_BAOCAODINHKY_DeTaiID] FOREIGN KEY ([DeTaiID]) REFERENCES [dbo].[DANGKYDETAI] ([DeTaiID]);


GO
PRINT N'Creating [dbo].[THUCHIENDETAI_BAOCAODINHKY_CHITIET_BaoCaoDinhKyID]...';


GO
ALTER TABLE [dbo].[THUCHIENDETAI_BAOCAODINHKY_CHITIET]
    ADD CONSTRAINT [THUCHIENDETAI_BAOCAODINHKY_CHITIET_BaoCaoDinhKyID] FOREIGN KEY ([BaoCaoDinhKyID]) REFERENCES [dbo].[THUCHIENDETAI_BAOCAODINHKY] ([BaoCaoDinhKyID]);


GO
PRINT N'Creating [dbo].[FK_THUCHIENDETAI_DENGHIDIEUCHINHNOIDUNG_DeTaiID]...';


GO
ALTER TABLE [dbo].[THUCHIENDETAI_DENGHIDIEUCHINHNOIDUNG]
    ADD CONSTRAINT [FK_THUCHIENDETAI_DENGHIDIEUCHINHNOIDUNG_DeTaiID] FOREIGN KEY ([DeTaiID]) REFERENCES [dbo].[DANGKYDETAI] ([DeTaiID]);


GO
PRINT N'Creating [dbo].[FK_THUCHIENDETAI_DENGHIDIEUCHINHNOIDUNG_CHITIET_DeNghiDieuChinhNoiDungID]...';


GO
ALTER TABLE [dbo].[THUCHIENDETAI_DENGHIDIEUCHINHNOIDUNG_CHITIET]
    ADD CONSTRAINT [FK_THUCHIENDETAI_DENGHIDIEUCHINHNOIDUNG_CHITIET_DeNghiDieuChinhNoiDungID] FOREIGN KEY ([DeNghiDieuChinhNoiDungID]) REFERENCES [dbo].[THUCHIENDETAI_DENGHIDIEUCHINHNOIDUNG] ([DeNghiDieuChinhNoiDungID]);


GO
PRINT N'Creating [dbo].[FK_THUCHIENDETAI_DENGHIGIAHAN_DeTaiID]...';


GO
ALTER TABLE [dbo].[THUCHIENDETAI_DENGHIGIAHAN]
    ADD CONSTRAINT [FK_THUCHIENDETAI_DENGHIGIAHAN_DeTaiID] FOREIGN KEY ([DeTaiID]) REFERENCES [dbo].[DANGKYDETAI] ([DeTaiID]);


GO
PRINT N'Creating [dbo].[FK_THUCHIENDETAI_DENGHIGIAHAN_CHITIET_DeNghiGiaHanID]...';


GO
ALTER TABLE [dbo].[THUCHIENDETAI_DENGHIGIAHAN_CHITIET]
    ADD CONSTRAINT [FK_THUCHIENDETAI_DENGHIGIAHAN_CHITIET_DeNghiGiaHanID] FOREIGN KEY ([DeNghiGiaHanID]) REFERENCES [dbo].[THUCHIENDETAI_DENGHIGIAHAN] ([DeNghiGiaHanID]);


GO
PRINT N'Creating [dbo].[FK_THUCHIENDETAI_KIEMTRAGIAMSAT_DeTaiID]...';


GO
ALTER TABLE [dbo].[THUCHIENDETAI_KIEMTRAGIAMSAT]
    ADD CONSTRAINT [FK_THUCHIENDETAI_KIEMTRAGIAMSAT_DeTaiID] FOREIGN KEY ([DeTaiID]) REFERENCES [dbo].[DANGKYDETAI] ([DeTaiID]);


GO
PRINT N'Creating [dbo].[FK_THUCHIENDETAI_KIEMTRAGIAMSAT_CHITIET_KiemTraGiamSatID]...';


GO
ALTER TABLE [dbo].[THUCHIENDETAI_KIEMTRAGIAMSAT_CHITIET]
    ADD CONSTRAINT [FK_THUCHIENDETAI_KIEMTRAGIAMSAT_CHITIET_KiemTraGiamSatID] FOREIGN KEY ([KiemTraGiamSatID]) REFERENCES [dbo].[THUCHIENDETAI_KIEMTRAGIAMSAT] ([KiemTraGiamSatID]);


GO
PRINT N'Creating [dbo].[FK_THUCHIENDETAI_KIEMTRAGIAMSAT_CHITIET_HoiDongID]...';


GO
ALTER TABLE [dbo].[THUCHIENDETAI_KIEMTRAGIAMSAT_CHITIET]
    ADD CONSTRAINT [FK_THUCHIENDETAI_KIEMTRAGIAMSAT_CHITIET_HoiDongID] FOREIGN KEY ([HoiDongID]) REFERENCES [dbo].[HOIDONG_YEUCAU_XETDUYET] ([HoiDongID]);


GO
PRINT N'Creating [dbo].[FK_THUCHIENDETAI_TOCHUCHOINGHIHOITHAO_DeTaiID]...';


GO
ALTER TABLE [dbo].[THUCHIENDETAI_TOCHUCHOINGHIHOITHAO]
    ADD CONSTRAINT [FK_THUCHIENDETAI_TOCHUCHOINGHIHOITHAO_DeTaiID] FOREIGN KEY ([DeTaiID]) REFERENCES [dbo].[DANGKYDETAI] ([DeTaiID]);


GO
PRINT N'Creating [dbo].[FK_THUCHIENDETAI_TOCHUCHOINGHIHOITHAO_CHITIET_ToChucHoiNghiHoiThaoID]...';


GO
ALTER TABLE [dbo].[THUCHIENDETAI_TOCHUCHOINGHIHOITHAO_CHITIET]
    ADD CONSTRAINT [FK_THUCHIENDETAI_TOCHUCHOINGHIHOITHAO_CHITIET_ToChucHoiNghiHoiThaoID] FOREIGN KEY ([ToChucHoiNghiHoiThaoID]) REFERENCES [dbo].[THUCHIENDETAI_TOCHUCHOINGHIHOITHAO] ([ToChucHoiNghiHoiThaoID]);


GO
PRINT N'Creating [dbo].[FK_THUCHIENDETAI_TOCHUCHOINGHIHOITHAO_CHITIET_HoiNghiHoiThaoID]...';


GO
ALTER TABLE [dbo].[THUCHIENDETAI_TOCHUCHOINGHIHOITHAO_CHITIET]
    ADD CONSTRAINT [FK_THUCHIENDETAI_TOCHUCHOINGHIHOITHAO_CHITIET_HoiNghiHoiThaoID] FOREIGN KEY ([HoiNghiHoiThaoID]) REFERENCES [dbo].[HOINGHI_TOCHUCMODOT] ([HoiNghiID]);


GO
PRINT N'Creating [dbo].[FK_THUCHIENDETAI_XETDUYETHOIDONGKHKT_DeTaiID]...';


GO
ALTER TABLE [dbo].[THUCHIENDETAI_XETDUYETHOIDONGKHKT]
    ADD CONSTRAINT [FK_THUCHIENDETAI_XETDUYETHOIDONGKHKT_DeTaiID] FOREIGN KEY ([DeTaiID]) REFERENCES [dbo].[DANGKYDETAI] ([DeTaiID]);


GO
PRINT N'Creating [dbo].[FK_THUCHIENDETAI_XETDUYETHOIDONGKHKT_CHITIET_XetDuyetHoiDongKHKTID]...';


GO
ALTER TABLE [dbo].[THUCHIENDETAI_XETDUYETHOIDONGKHKT_CHITIET]
    ADD CONSTRAINT [FK_THUCHIENDETAI_XETDUYETHOIDONGKHKT_CHITIET_XetDuyetHoiDongKHKTID] FOREIGN KEY ([XetDuyetHoiDongKHKTID]) REFERENCES [dbo].[THUCHIENDETAI_XETDUYETHOIDONGKHKT] ([XetDuyetHoiDongKHKTID]);


GO
PRINT N'Creating [dbo].[FK_THUCHIENDETAI_XETDUYETHOIDONGKHKT_CHITIET_HoiDongID]...';


GO
ALTER TABLE [dbo].[THUCHIENDETAI_XETDUYETHOIDONGKHKT_CHITIET]
    ADD CONSTRAINT [FK_THUCHIENDETAI_XETDUYETHOIDONGKHKT_CHITIET_HoiDongID] FOREIGN KEY ([HoiDongID]) REFERENCES [dbo].[HOIDONG_YEUCAU_XETDUYET] ([HoiDongID]);


GO
PRINT N'Creating [dbo].[fk_RoleId]...';


GO
ALTER TABLE [dbo].[webpages_UsersInRoles]
    ADD CONSTRAINT [fk_RoleId] FOREIGN KEY ([RoleId]) REFERENCES [dbo].[webpages_Roles] ([RoleId]);


GO
PRINT N'Creating [dbo].[fk_UserId]...';


GO
ALTER TABLE [dbo].[webpages_UsersInRoles]
    ADD CONSTRAINT [fk_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[UserProfile] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_XETDUYETDETAI_BOSUNGSUADOI_DeTaiID]...';


GO
ALTER TABLE [dbo].[XETDUYETDETAI_BOSUNGSUADOI]
    ADD CONSTRAINT [FK_XETDUYETDETAI_BOSUNGSUADOI_DeTaiID] FOREIGN KEY ([DeTaiID]) REFERENCES [dbo].[DANGKYDETAI] ([DeTaiID]);


GO
PRINT N'Creating [dbo].[FK_XETDUYETDETAI_DANGKYCAPQUANLY_DeTaiID]...';


GO
ALTER TABLE [dbo].[XETDUYETDETAI_DANGKYCAPQUANLY]
    ADD CONSTRAINT [FK_XETDUYETDETAI_DANGKYCAPQUANLY_DeTaiID] FOREIGN KEY ([DeTaiID]) REFERENCES [dbo].[DANGKYDETAI] ([DeTaiID]);


GO
PRINT N'Creating [dbo].[FK_XETDUYETDETAI_GHINHANKETQUA_DeTaiID]...';


GO
ALTER TABLE [dbo].[XETDUYETDETAI_GHINHANKETQUA]
    ADD CONSTRAINT [FK_XETDUYETDETAI_GHINHANKETQUA_DeTaiID] FOREIGN KEY ([DeTaiID]) REFERENCES [dbo].[DANGKYDETAI] ([DeTaiID]);


GO
PRINT N'Creating [dbo].[FK_XETDUYETDETAI_HOIDONGDAODUC_DeTaiID]...';


GO
ALTER TABLE [dbo].[XETDUYETDETAI_HOIDONGDAODUC]
    ADD CONSTRAINT [FK_XETDUYETDETAI_HOIDONGDAODUC_DeTaiID] FOREIGN KEY ([DeTaiID]) REFERENCES [dbo].[DANGKYDETAI] ([DeTaiID]);


GO
PRINT N'Creating [dbo].[FK_XETDUYETDETAI_HOIDONGDAODUC_HoiDongID]...';


GO
ALTER TABLE [dbo].[XETDUYETDETAI_HOIDONGDAODUC]
    ADD CONSTRAINT [FK_XETDUYETDETAI_HOIDONGDAODUC_HoiDongID] FOREIGN KEY ([HoiDongID]) REFERENCES [dbo].[HOIDONG_YEUCAU_XETDUYET] ([HoiDongID]);


GO
PRINT N'Creating [dbo].[FK_XETDUYETDETAI_TUYENCHONCAPQUANLY_DeTaiID]...';


GO
ALTER TABLE [dbo].[XETDUYETDETAI_TUYENCHONCAPQUANLY]
    ADD CONSTRAINT [FK_XETDUYETDETAI_TUYENCHONCAPQUANLY_DeTaiID] FOREIGN KEY ([DeTaiID]) REFERENCES [dbo].[DANGKYDETAI] ([DeTaiID]);


GO
PRINT N'Creating [dbo].[FK_XETDUYETDETAI_YEUCAUXETDUYET_DeTaiID]...';


GO
ALTER TABLE [dbo].[XETDUYETDETAI_YEUCAUXETDUYET]
    ADD CONSTRAINT [FK_XETDUYETDETAI_YEUCAUXETDUYET_DeTaiID] FOREIGN KEY ([DeTaiID]) REFERENCES [dbo].[DANGKYDETAI] ([DeTaiID]);


GO
PRINT N'Creating [dbo].[fn_SpitString]...';


GO
CREATE FUNCTION [dbo].[fn_SpitString]
(
	@Text       VARCHAR(MAX),
	@Separator  VARCHAR(MAX)
)
RETURNS @tableOut TABLE(VALUE VARCHAR(MAX))
AS
BEGIN
	DECLARE @value  VARCHAR(MAX),
	        @Pos    INT
	
	SET @Text = LTRIM(RTRIM(@Text)) + @Separator
	SET @Pos = CHARINDEX(@Separator, @Text, LEN(@Separator))
	
	IF REPLACE(@Text, @Separator, '') <> ''
	BEGIN
	    WHILE @Pos > 0
	    BEGIN
	        SET @value = LTRIM(RTRIM(LEFT(@Text, @Pos - 1)))
	        IF @value <> ''
	        BEGIN
	            INSERT INTO @tableOut(VALUE) VALUES(@value)
	        END
	        
	        SET @Text = RIGHT(@Text, LEN(@Text) -(@Pos + LEN(@Separator) - 1))
	        SET @Pos = CHARINDEX(@Separator, @Text, LEN(@Separator))
	    END
	END
	
	RETURN;
END
GO
PRINT N'Creating [dbo].[fpt_spDeTai_CacKhoanChi]...';


GO
--------VI(Phu luc)
CREATE PROC dbo.fpt_spDeTai_CacKhoanChi
	@DetaiId INT
	,@Loai INT
AS
SELECT ROW_NUMBER() OVER(ORDER BY ChiTietKinhPhiID) STT,B.TenNoiDungKinhPhi,C.TenDonViDo,A.* FROM(
		SELECT * FROM DETAI_CHITIETKINHPHI NOLOCK WHERE DeTaiID=@DetaiId AND Loai=@Loai) AS A
		left JOIN(SELECT * FROM DM_NOIDUNGKINHPHI NOLOCK)AS B ON B.NoiDungKinhPhiID=A.NoiDungKinhPhiID
		left JOIN(SELECT * FROM DM_DONVIDO NOLOCK) AS C ON C.DMDonViDoID=A.DMDonViDoID
		ORDER BY ChiTietKinhPhiID
GO
PRINT N'Creating [dbo].[fpt_spDeTai_CanBoThucHien]...';


GO
---Đội ngũ cán bộ thực hiện đề tài
CREATE PROC dbo.fpt_spDeTai_CanBoThucHien
	@DetaiId INT
AS
SELECT ROW_NUMBER() OVER(ORDER BY CanBoThucHienID) STT,* FROM DETAI_CANBOTHUCHIEN NOLOCK WHERE DeTaiID=@DetaiId ORDER BY CanBoThucHienID
GO
PRINT N'Creating [dbo].[fpt_spDeTai_HoatDongPhoiHop]...';


GO
-------Hoạt động của các tổ chức phối hợp tham gia thực hiện đề tài
CREATE PROC dbo.fpt_spDeTai_HoatDongPhoiHop
	@DetaiId INT
AS
SELECT ROW_NUMBER() OVER(ORDER BY HoatDongPhoiHopID) STT,* FROM DETAI_HOATDONGPHOIHOP NOLOCK WHERE DeTaiID=@DetaiId ORDER BY HoatDongPhoiHopID
GO
PRINT N'Creating [dbo].[fpt_spDeTai_HopTacQuocTe]...';


GO
-----Hop tac quoc te
CREATE PROC dbo.fpt_spDeTai_HopTacQuocTe
	@DetaiId INT
AS
SELECT B.TenTinhTrangHopTacQuocTe,TenDoiTac,NoiDungHopTac FROM (SELECT * FROM DETAI_HOPTACQUOCTE NOLOCK WHERE DeTaiID=@DetaiId)AS A
INNER JOIN(SELECT * FROM DM_TINHTRANGHOPTACQUOCTE NOLOCK)AS B ON B.DMTinhTrangHopTacQuocTeID=A.DMTinhTrangHopTacQuocTeID
ORDER BY TenDoiTac,TenTinhTrangHopTacQuocTe
GO
PRINT N'Creating [dbo].[fpt_spDetai_KetQuaDuKien]...';


GO
---kET QUA DE TAI
CREATE PROCEDURE [dbo].[fpt_spDetai_KetQuaDuKien]
	@DetaiId INT
AS
SELECT TenKetQuaDuKien FROM (SELECT * FROM DETAI_KETQUADUKIEN NOLOCK) AS A
INNER JOIN(SELECT * FROM DM_KETQUADUKIEN NOLOCK) AS B ON B.DMKetQuaDuKienID=A.DMKetQuaDuKienID
ORDER BY TenKetQuaDuKien
GO
PRINT N'Creating [dbo].[fpt_spDeTai_KinhPhiThucHien]...';


GO
---Kinh phí thực hiện đề tài phân theo các khoản chi
CREATE PROC dbo.fpt_spDeTai_KinhPhiThucHien
	@DetaiId INT
AS
SELECT ROW_NUMBER() OVER(ORDER BY KinhPhiThucHienID) STT,* FROM DETAI_KINHPHITHUCHIEN NOLOCK WHERE DeTaiID=@DetaiId ORDER BY KinhPhiThucHienID
GO
PRINT N'Creating [dbo].[fpt_spDetai_TienDoThucHien]...';


GO
------------Tiến độ thực hiện
CREATE PROC dbo.fpt_spDetai_TienDoThucHien
	@DetaiId INT
AS
	SELECT  ROW_NUMBER() OVER(ORDER BY TienDoThucHienID) STT,*,CONVERT(nvarchar(50),ThoiGian,103) pThoiGian
	 FROM DETAI_TIENDOTHUCHIEN NOLOCK WHERE DeTaiID=@DetaiId ORDER BY TienDoThucHienID
GO
PRINT N'Creating [dbo].[fpt_spDetai_YeuCauKhoaHoc]...';


GO
---Yêu cầu khoa học đối với sản phẩm tạo ra (dạng kết quả II, III)
CREATE PROC dbo.fpt_spDetai_YeuCauKhoaHoc
	@DetaiId INT
AS
SELECT ROW_NUMBER() OVER(ORDER BY YeuCauKhoaHocID) STT,* FROM DETAI_YEUCAUKHOAHOC NOLOCK WHERE DeTaiID=@DetaiId ORDER BY YeuCauKhoaHocID
GO
PRINT N'Creating [dbo].[fpt_spDetai_YeuCauKyThuat]...';


GO
--------------Yêu cầu kỹ thuật, chỉ tiêu chất lượng đối với sản phẩm tạo ra (dạng kết quả I)
CREATE PROC dbo.fpt_spDetai_YeuCauKyThuat
	@DetaiId INT
AS
SELECT ROW_NUMBER() OVER(ORDER BY YeuCauKyThuatId) STT,* FROM DETAI_YEUCAUKYTHUAT NOLOCK WHERE DeTaiID=@DetaiId ORDER BY YeuCauKyThuatID
GO
PRINT N'Creating [dbo].[fpt_spPrint_DeTai_I]...';


GO
CREATE PROCEDURE [dbo].[fpt_spPrint_DeTai_I]
		@DetaiId INT
AS
---I
SELECT top 1 A.*,UPPER(N'THUYẾT MINH ĐỀ TÀI: '+A.TenDeTai) u_TenDeTai
 ,B.TenCapQuanLy,C.TenChucDanhKhoaHoc,D.TenHocHamHocVi,CONVERT(nvarchar(50),ThucHienTuNgay,103) pThucHienTuNgay
,CONVERT(nvarchar(50),ThucHienDenNgay,103) pThucHienDenNgay
,a1.*,a2.*,a3.*,a4.*,a5.*
,Case 
	when((KinhPhi_K1+KinhPhi_K2+KinhPhi_K3+KinhPhi_K4+KinhPhi_K5)=0) then '0%'
	else Cast(Round(KinhPhi_K1/(KinhPhi_K1+KinhPhi_K2+KinhPhi_K3+KinhPhi_K4+KinhPhi_K5)*100,2) as Varchar(20))+'%'
end TyLe_K1
,Case when((KinhPhi_K1+KinhPhi_K2+KinhPhi_K3+KinhPhi_K4+KinhPhi_K5)=0) then '0%' 
      else Cast(Round(KinhPhi_K2/(KinhPhi_K1+KinhPhi_K2+KinhPhi_K3+KinhPhi_K4+KinhPhi_K5)*100,2)as Varchar(20))+'%'
 end TyLe_K2
,Case when((KinhPhi_K1+KinhPhi_K2+KinhPhi_K3+KinhPhi_K4+KinhPhi_K5)=0) then '0%' else Cast(Round(KinhPhi_K3/(KinhPhi_K1+KinhPhi_K2+KinhPhi_K3+KinhPhi_K4+KinhPhi_K5)*100,2)as Varchar(20))+'%' end TyLe_K3
,Case when((KinhPhi_K1+KinhPhi_K2+KinhPhi_K3+KinhPhi_K4+KinhPhi_K5)=0) then '0%' else Cast(Round(KinhPhi_K4/(KinhPhi_K1+KinhPhi_K2+KinhPhi_K3+KinhPhi_K4+KinhPhi_K5)*100,2) as Varchar(20))+'%'end TyLe_K4
,Case when((KinhPhi_K1+KinhPhi_K2+KinhPhi_K3+KinhPhi_K4+KinhPhi_K5)=0) then '0%' else Cast(Round(KinhPhi_K5/(KinhPhi_K1+KinhPhi_K2+KinhPhi_K3+KinhPhi_K4+KinhPhi_K5)*100,2)as Varchar(20))+'%' end TyLe_K5
,NguonNSNN_K1+NguonNSNN_K2+NguonNSNN_K3+NguonNSNN_K4+NguonNSNN_K5 TongNguonNSNN
,NguonTuCo_K1+NguonTuCo_K2+NguonTuCo_K3+NguonTuCo_K4+NguonTuCo_K5 TongNguonTuCo
,NguonKhac_K1+NguonKhac_K2+NguonKhac_K3+NguonKhac_K4+NguonKhac_K5 TongNguonKhac
,KinhPhi_K1+KinhPhi_K2+KinhPhi_K3+KinhPhi_K4+KinhPhi_K5 TongKinhPhi
,AB.TenTinhTrangDeTai
 FROM
(SELECT * FROM DETAI NOLOCK WHERE DeTaiID=@DetaiId) AS A
LEFT JOIN(SELECT * FROM DM_CAPQUANLY NOLOCK)AS B ON B.DMCapQuanLyID=A.DMCapQuanLyID
LEFT JOIN(SELECT * FROM DM_CHUCDANHKHOAHOC NOLOCK)AS C ON C.DMChucDanhKhoaHocID=A.CNDT_DMChucDanhKhoaHocID
LEFT JOIN(SELECT * FROM DM_HOCHAMHOCVI NOLOCK) AS D ON D.DMHocHamHocViID=A.CNDT_DMHocHamHocViID
left join(select * from DM_TINHTRANGDETAI nolock) as AB on AB.DMTinhTrangDeTaiId=A.DMTinhTrangDeTaiId

--
left join(
 select sum(Isnull(KinhPhi,0)) KinhPhi_K1,sum(Isnull(NguonNSNN,0))  NguonNSNN_K1,sum(Isnull(NguonTuCo,0))  NguonTuCo_K1,sum(Isnull(NguonKhac,0))  NguonKhac_K1,DeTaiID DeTaiID_K1
 from DETAI_CHITIETKINHPHI nolock where DeTaiID=@DetaiId and Loai=1 
 group by DeTaiID
 ) as a1 on a1.DeTaiID_K1=A.DeTaiID
 --
left join(
 select sum(Isnull(ThanhTien,0)) KinhPhi_K2,sum(Isnull(NguonNSNN,0))  NguonNSNN_K2,sum(Isnull(NguonTuCo,0))  NguonTuCo_K2,sum(Isnull(NguonKhac,0))  NguonKhac_K2,DeTaiID DeTaiID_K2
 from DETAI_CHITIETKINHPHI nolock where DeTaiID=@DetaiId and Loai=2 
 group by DeTaiID
 ) as a2 on a2.DeTaiID_K2=A.DeTaiID
 --
 left join(
 select sum(Isnull(ThanhTien,0)) KinhPhi_K3,sum(Isnull(NguonNSNN,0))  NguonNSNN_K3,sum(Isnull(NguonTuCo,0))  NguonTuCo_K3,sum(Isnull(NguonKhac,0))  NguonKhac_K3,DeTaiID DeTaiID_K3
 from DETAI_CHITIETKINHPHI nolock where DeTaiID=@DetaiId and Loai=3 
 group by DeTaiID
 ) as a3 on a3.DeTaiID_K3=A.DeTaiID
 --
 left join(
 select sum(Isnull(KinhPhi,0)) KinhPhi_K4,sum(Isnull(NguonNSNN,0))  NguonNSNN_K4,sum(Isnull(NguonTuCo,0))  NguonTuCo_K4,sum(Isnull(NguonKhac,0))  NguonKhac_K4,DeTaiID DeTaiID_K4
 from DETAI_CHITIETKINHPHI nolock where DeTaiID=@DetaiId and Loai=4 
 group by DeTaiID
 ) as a4 on a4.DeTaiID_K4=A.DeTaiID
 --
 left join(
 select sum(Isnull(KinhPhi,0)) KinhPhi_K5,sum(Isnull(NguonNSNN,0))  NguonNSNN_K5,sum(Isnull(NguonTuCo,0))  NguonTuCo_K5,sum(Isnull(NguonKhac,0))  NguonKhac_K5,DeTaiID DeTaiID_K5
 from DETAI_CHITIETKINHPHI nolock where DeTaiID=@DetaiId and Loai=5 
 group by DeTaiID
 ) as a5 on a5.DeTaiID_K5=A.DeTaiID
GO
PRINT N'Creating [dbo].[getListFunction]...';


GO
CREATE PROCEDURE getListFunction
	@functionType INT
AS
BEGIN

	SELECT * 
	FROM [Function] f
	WHERE (f.FunctionType = @functionType OR @functionType = 0) 
		   AND f.FunctionLink IN ('GioiThieu') 
	ORDER BY f.[Description] asc	

END
GO
PRINT N'Creating [dbo].[proc_BangKiemLuaChonQuyTrinh_FullTextIndexSearch]...';


GO

CREATE PROCEDURE [dbo].[proc_BangKiemLuaChonQuyTrinh_FullTextIndexSearch]
	@LoaiBangKiem int,
	@SoBangKiem nvarchar(1000),
	@TenDeTai nvarchar(1000),
	@ChuNhiemDeTai nvarchar(1000),
	@UserId int
AS
BEGIN
	SET NOCOUNT ON;

	--xét duyệt tất cả
	IF @LoaiBangKiem = 0
	BEGIN
		IF @TenDeTai IS NOT NULL
			SELECT 
				XDRG.XDRG_XetDuyetRutGonID as XetDuyetID,
				DT.ThucHienTuNgay,
				DT.ThucHienDenNgay,
				DT.TenDeTai,
				XDRG.XDRG_SoBangKiem as SoBangKiem,
				1 as LoaiBangKiem,
				DT.CNDT_HoTen as ChuNhiemDeTai,
				DT.DeTaiID
			FROM DETAI DT INNER JOIN FREETEXTTABLE(DETAI,TenDeTai,@TenDeTai) AS FTS_DT ON DT.DeTaiID = FTS_DT.[KEY] 
			INNER JOIN XETDUYETRUTGON XDRG
			ON DT.DeTaiID = XDRG.XDRG_DeTaiID
			--WHERE FREETEXT(TenDeTai,@TenDeTai)
			AND (UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%'+UPPER(LTRIM(RTRIM(@ChuNhiemDeTai)))+'%' OR @ChuNhiemDeTai IS NULL)
			AND (UPPER(LTRIM(RTRIM(XDRG.XDRG_SoBangKiem))) LIKE '%'+UPPER(LTRIM(RTRIM(@SoBangKiem)))+'%' OR @SoBangKiem IS NULL)
			AND (DT.UserId = @UserId OR @UserId IS NULL)
			UNION
			SELECT 
				XDDD.XDDD_XetDuyetDayDuID as XetDuyetID,
				DT.ThucHienTuNgay,
				DT.ThucHienDenNgay,
				DT.TenDeTai,
				XDDD.XDDD_SoBangKiem as SoBangKiem,
				2 as LoaiBangKiem,
				DT.CNDT_HoTen as ChuNhiemDeTai,
				DT.DeTaiID
			FROM DETAI DT INNER JOIN FREETEXTTABLE(DETAI,TenDeTai,@TenDeTai) AS FTS_DT ON DT.DeTaiID = FTS_DT.[KEY] 
			INNER JOIN XETDUYETDAYDU XDDD
			ON DT.DeTaiID = XDDD.XDDD_DeTaiID
			--WHERE FREETEXT(TenDeTai,@TenDeTai)
			AND (UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%'+UPPER(LTRIM(RTRIM(@ChuNhiemDeTai)))+'%' OR @ChuNhiemDeTai IS NULL)
			AND (UPPER(LTRIM(RTRIM(XDDD.XDDD_SoBangKiem))) LIKE '%'+UPPER(LTRIM(RTRIM(@SoBangKiem)))+'%' OR @SoBangKiem IS NULL)
			AND (DT.UserId = @UserId OR @UserId IS NULL)
		ELSE
			SELECT 
				XDRG.XDRG_XetDuyetRutGonID as XetDuyetID,
				DT.ThucHienTuNgay,
				DT.ThucHienDenNgay,
				DT.TenDeTai,
				XDRG.XDRG_SoBangKiem as SoBangKiem,
				1 as LoaiBangKiem,
				DT.CNDT_HoTen as ChuNhiemDeTai,
				DT.DeTaiID
			FROM XETDUYETRUTGON XDRG
			INNER JOIN DETAI AS DT
			ON DT.DeTaiID = XDRG.XDRG_DeTaiID
			WHERE
			(UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%'+UPPER(LTRIM(RTRIM(@ChuNhiemDeTai)))+'%' OR @ChuNhiemDeTai IS NULL)
			AND (UPPER(LTRIM(RTRIM(XDRG.XDRG_SoBangKiem))) LIKE '%'+UPPER(LTRIM(RTRIM(@SoBangKiem)))+'%' OR @SoBangKiem IS NULL)
			AND (DT.UserId = @UserId OR @UserId IS NULL)
			UNION
			SELECT 
				XDDD.XDDD_XetDuyetDayDuID as XetDuyetID,
				DT.ThucHienTuNgay,
				DT.ThucHienDenNgay,
				DT.TenDeTai,
				XDDD.XDDD_SoBangKiem as SoBangKiem,
				2 as LoaiBangKiem,
				DT.CNDT_HoTen as ChuNhiemDeTai,
				DT.DeTaiID
			FROM XETDUYETDAYDU XDDD
			INNER JOIN DETAI AS DT
			ON DT.DeTaiID = XDDD_DeTaiID
			WHERE
			(UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%'+UPPER(LTRIM(RTRIM(@ChuNhiemDeTai)))+'%' OR @ChuNhiemDeTai IS NULL)
			AND (UPPER(LTRIM(RTRIM(XDDD.XDDD_SoBangKiem))) LIKE '%'+UPPER(LTRIM(RTRIM(@SoBangKiem)))+'%' OR @SoBangKiem IS NULL)
			AND (DT.UserId = @UserId OR @UserId IS NULL)
	END
	--xét duyệt rút gọn
	IF @LoaiBangKiem = 1
	BEGIN
		IF @TenDeTai IS NOT NULL
			SELECT 
				XDRG.XDRG_XetDuyetRutGonID as XetDuyetID,
				DT.ThucHienTuNgay,
				DT.ThucHienDenNgay,
				DT.TenDeTai,
				XDRG.XDRG_SoBangKiem as SoBangKiem,
				1 as LoaiBangKiem,
				DT.CNDT_HoTen as ChuNhiemDeTai,
				DT.DeTaiID
			FROM DETAI DT INNER JOIN FREETEXTTABLE(DETAI,TenDeTai,@TenDeTai) AS FTS_DT ON DT.DeTaiID = FTS_DT.[KEY] 
			INNER JOIN XETDUYETRUTGON XDRG
			ON DT.DeTaiID = XDRG.XDRG_DeTaiID
			--WHERE FREETEXT(TenDeTai,@TenDeTai)
			AND (UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%'+UPPER(LTRIM(RTRIM(@ChuNhiemDeTai)))+'%' OR @ChuNhiemDeTai IS NULL)
			AND (UPPER(LTRIM(RTRIM(XDRG.XDRG_SoBangKiem))) LIKE '%'+UPPER(LTRIM(RTRIM(@SoBangKiem)))+'%' OR @SoBangKiem IS NULL)
			AND (DT.UserId = @UserId OR @UserId IS NULL)
		ELSE
			SELECT 
				XDRG.XDRG_XetDuyetRutGonID as XetDuyetID,
				DT.ThucHienTuNgay,
				DT.ThucHienDenNgay,
				DT.TenDeTai,
				XDRG.XDRG_SoBangKiem as SoBangKiem,
				2 as LoaiBangKiem,
				DT.CNDT_HoTen as ChuNhiemDeTai,
				DT.DeTaiID
			FROM XETDUYETRUTGON XDRG
			INNER JOIN DETAI AS DT
			ON DT.DeTaiID = XDRG.XDRG_DeTaiID
			WHERE
			(UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%'+UPPER(LTRIM(RTRIM(@ChuNhiemDeTai)))+'%' OR @ChuNhiemDeTai IS NULL)
			AND (UPPER(LTRIM(RTRIM(XDRG.XDRG_SoBangKiem))) LIKE '%'+UPPER(LTRIM(RTRIM(@SoBangKiem)))+'%' OR @SoBangKiem IS NULL)
			AND (DT.UserId = @UserId OR @UserId IS NULL)
	END

	--xét duyệt đầy đủ
	IF @LoaiBangKiem =2
	BEGIN
		IF @TenDeTai IS NOT NULL
			SELECT 
				XDDD.XDDD_XetDuyetDayDuID as XetDuyetID,
				DT.ThucHienTuNgay,
				DT.ThucHienDenNgay,
				DT.TenDeTai,
				XDDD.XDDD_SoBangKiem as SoBangKiem,
				1 as LoaiBangKiem,
				DT.CNDT_HoTen as ChuNhiemDeTai,
				DT.DeTaiID
			FROM DETAI DT INNER JOIN FREETEXTTABLE(DETAI,TenDeTai,@TenDeTai) AS FTS_DT ON DT.DeTaiID = FTS_DT.[KEY] 
			INNER JOIN XETDUYETDAYDU XDDD
			ON DT.DeTaiID = XDDD.XDDD_DeTaiID
			--WHERE FREETEXT(TenDeTai,@TenDeTai)
			AND (UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%'+UPPER(LTRIM(RTRIM(@ChuNhiemDeTai)))+'%' OR @ChuNhiemDeTai IS NULL)
			AND (UPPER(LTRIM(RTRIM(XDDD.XDDD_SoBangKiem))) LIKE '%'+UPPER(LTRIM(RTRIM(@SoBangKiem)))+'%' OR @SoBangKiem IS NULL)
			AND (DT.UserId = @UserId OR @UserId IS NULL)
		ELSE
			SELECT 
				XDDD.XDDD_XetDuyetDayDuID as XetDuyetID,
				DT.ThucHienTuNgay,
				DT.ThucHienDenNgay,
				DT.TenDeTai,
				XDDD.XDDD_SoBangKiem as SoBangKiem,
				2 as LoaiBangKiem,
				DT.CNDT_HoTen as ChuNhiemDeTai,
				DT.DeTaiID
			FROM XETDUYETDAYDU XDDD
			INNER JOIN DETAI AS DT
			ON DT.DeTaiID = XDDD_DeTaiID
			WHERE
			(UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%'+UPPER(LTRIM(RTRIM(@ChuNhiemDeTai)))+'%' OR @ChuNhiemDeTai IS NULL)
			AND (UPPER(LTRIM(RTRIM(XDDD.XDDD_SoBangKiem))) LIKE '%'+UPPER(LTRIM(RTRIM(@SoBangKiem)))+'%' OR @SoBangKiem IS NULL)
			AND (DT.UserId = @UserId OR @UserId IS NULL)
	END
END
GO
PRINT N'Creating [dbo].[proc_BanNhanXetKetQuaNghienCuuDeTai_FullTextIndexSearch]...';


GO
CREATE PROCEDURE [dbo].[proc_BanNhanXetKetQuaNghienCuuDeTai_FullTextIndexSearch]
	@TenDeTai NVARCHAR(1000),
	@ChuNhiemDeTai NVARCHAR(1000),
	@SoQuyetDinh NVARCHAR(1000),
	@HoTen NVARCHAR(1000),
	@UserId int
AS
BEGIN
	SET NOCOUNT ON;

	IF @TenDeTai IS NOT NULL
		SELECT	DS.HoTen,
				DS.DanhSachHoiDongID,
				KQ.KetQuaNghienCuuID,
				HDNT.HoiDongNghiemThuID,
				DT.DeTaiID,
				DT.TenDeTai,
				DT.CNDT_HoTen AS ChuNhiemDeTai,
				DT.ThucHienTuNgay,
				DT.ThucHienDenNgay,
				HDNT.SoQuyetDinh		
		FROM DETAI DT INNER JOIN FREETEXTTABLE(DETAI,TenDeTai,@TenDeTai) AS FTS_DT ON DT.DeTaiID = FTS_DT.[KEY]
		INNER JOIN HOIDONGNGHIEMTHU HDNT ON HDNT.HDNT_DeTaiID = DT.DeTaiID
		INNER JOIN DANHSACHHOIDONG DS ON DS.HoiDongNghiemThuID = HDNT.HoiDongNghiemThuID
		INNER JOIN KETQUANGHIENCUU KQ ON KQ.KQNC_DanhSachHoiDongID = DS.DanhSachHoiDongID
		AND (UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%'+UPPER(LTRIM(RTRIM(@ChuNhiemDeTai)))+'%'  OR @ChuNhiemDeTai IS NULL)
		AND (UPPER(LTRIM(RTRIM(HDNT.SoQuyetDinh))) LIKE '%'+UPPER(LTRIM(RTRIM(@SoQuyetDinh)))+'%'  OR @SoQuyetDinh IS NULL)
		AND (UPPER(LTRIM(RTRIM(DS.HoTen))) LIKE '%'+UPPER(LTRIM(RTRIM(@HoTen)))+'%'  OR @HoTen IS NULL)
		AND (DT.UserId = @UserId OR @UserId IS NULL)
	ELSE
		SELECT	DS.HoTen,
				DS.DanhSachHoiDongID,
				KQ.KetQuaNghienCuuID,
				HDNT.HoiDongNghiemThuID,
				DT.DeTaiID,
				DT.TenDeTai,
				DT.CNDT_HoTen AS ChuNhiemDeTai,
				DT.ThucHienTuNgay,
				DT.ThucHienDenNgay,
				HDNT.SoQuyetDinh
		FROM DANHSACHHOIDONG DS,KETQUANGHIENCUU KQ ,DETAI DT,HOIDONGNGHIEMTHU HDNT
		WHERE DS.HoiDongNghiemThuID = HDNT.HoiDongNghiemThuID 
		AND KQ.KQNC_DanhSachHoiDongID = DS.DanhSachHoiDongID
		AND DT.DeTaiID = HDNT.HDNT_DeTaiID
		AND (UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%'+UPPER(LTRIM(RTRIM(@ChuNhiemDeTai)))+'%'  OR @ChuNhiemDeTai IS NULL)
		AND (UPPER(LTRIM(RTRIM(HDNT.SoQuyetDinh))) LIKE '%'+UPPER(LTRIM(RTRIM(@SoQuyetDinh)))+'%'  OR @SoQuyetDinh IS NULL)
		AND (UPPER(LTRIM(RTRIM(DS.HoTen))) LIKE '%'+UPPER(LTRIM(RTRIM(@HoTen)))+'%'  OR @HoTen IS NULL)
		AND (DT.UserId = @UserId OR @UserId IS NULL)
END
GO
PRINT N'Creating [dbo].[proc_BaoCaoDinhKy_FullTextIndexSearch]...';


GO
CREATE PROCEDURE [dbo].[proc_BaoCaoDinhKy_FullTextIndexSearch]
	@BaoCaoTuNgay datetime,
	@BaoCaoDenNgay datetime,
	@Ky int,
	@TenDeTai nvarchar(1000),
	@ChuNhiemDeTai nvarchar(1000),
	@UserId int
AS
BEGIN
	
	IF @TenDeTai IS NOT NULL
	BEGIN
		SELECT BaoCaoDinhKyID,NgayBaoCao,KyBaoCao,TenDeTai,CNDT_HoTen AS ChuNhiemDeTai,ThucHienTuNgay,ThucHienDenNgay,BCDK_DeTaiID
		FROM DETAI DT INNER JOIN FREETEXTTABLE(DETAI,TenDeTai,@TenDeTai) AS FTS_DT ON DT.DeTaiID = FTS_DT.[KEY]
		INNER JOIN BAOCAODINHKY BC ON BC.BCDK_DeTaiID = DT.DeTaiID
		--WHERE FREETEXT(TenDeTai,@TenDeTai)
		AND (UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%'+UPPER(LTRIM(RTRIM(@ChuNhiemDeTai)))+'%' OR @ChuNhiemDeTai IS NULL)
		AND (CONVERT(DATE,BC.NgayBaoCao,105) >= CONVERT(DATE,@BaoCaoTuNgay,105) OR @BaoCaoTuNgay IS NULL)
		AND (CONVERT(DATE,BC.NgayBaoCao,105) <= CONVERT(DATE,@BaoCaoDenNgay,105) OR @BaoCaoDenNgay IS NULL)
		AND (KyBaoCao = @Ky OR @Ky IS NULL)
		AND (DT.UserId = @UserId OR @UserId IS NULL)
	END
	ELSE
	BEGIN
		
		SELECT BaoCaoDinhKyID,NgayBaoCao,KyBaoCao,TenDeTai,CNDT_HoTen AS ChuNhiemDeTai,ThucHienTuNgay,ThucHienDenNgay,BCDK_DeTaiID
		FROM BAOCAODINHKY BC INNER JOIN DETAI DT
		ON DT.DeTaiID = BC.BCDK_DeTaiID
		WHERE 
		(UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%'+UPPER(LTRIM(RTRIM(@ChuNhiemDeTai)))+'%' OR @ChuNhiemDeTai IS NULL)
		AND (CONVERT(DATE,BC.NgayBaoCao,105) >= CONVERT(DATE,@BaoCaoTuNgay,105) OR @BaoCaoTuNgay IS NULL)
		AND (CONVERT(DATE,BC.NgayBaoCao,105) <= CONVERT(DATE,@BaoCaoDenNgay,105) OR @BaoCaoDenNgay IS NULL)
		AND (KyBaoCao = @Ky OR @Ky IS NULL)
		AND (DT.UserId = @UserId OR @UserId IS NULL)
	END

END
GO
PRINT N'Creating [dbo].[proc_BaoCaoKetQuaThucHien_FullTextIndexSearch]...';


GO
CREATE PROCEDURE [dbo].[proc_BaoCaoKetQuaThucHien_FullTextIndexSearch]
	@TenDeTai nvarchar(1000),
	@MaSoDeTai nvarchar(1000),
	@CNDT_HoTen nvarchar(1000),
	@CQCTDT_TenToChucKHCN nvarchar(1000),
	@ThucHienTuNgay datetime,
	@ThucHienDenNgay datetime,
	@KinhPhiNhoNhat money,
	@KinhPhiLonNhat money,
	@UserId int
AS
BEGIN

SET NOCOUNT ON;
IF @TenDeTai IS NOT NULL
	BEGIN
	SELECT TenDeTai,CNDT_HoTen,CQCTDT_TenToChucKHCN,ThucHienTuNgay,ThucHienDenNgay,DMTinhTrangDeTaiID,BC.SoHopDong,BC.BaoCaoKetQuaID
	FROM DETAI DT INNER JOIN FREETEXTTABLE(DETAI,TenDeTai,@TenDeTai) AS FTS_DT ON DT.DeTaiID = FTS_DT.[KEY]
	INNER JOIN BAOCAOKETQUA BC ON BC.BCKQ_DeTaiID = DT.DeTaiID
	--WHERE FREETEXT(TenDeTai,@TenDeTai)
		AND (UPPER(LTRIM(RTRIM(DT.MaSoDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@MaSoDeTai)))+'%' OR @MaSoDeTai IS NULL)  
		AND (UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%' + UPPER(LTRIM(RTRIM(@CNDT_HoTen))) + '%' OR @CNDT_HoTen IS NULL)
		AND (UPPER(LTRIM(RTRIM(DT.CQCTDT_TenToChucKHCN))) LIKE '%' +UPPER(LTRIM(RTRIM(@CQCTDT_TenToChucKHCN)))+ '%' OR @CQCTDT_TenToChucKHCN IS NULL)
		AND (DT.KinhPhi >= @KinhPhiNhoNhat OR @KinhPhiNhoNhat IS NULL)
		AND (DT.KinhPhi <= @KinhPhiLonNhat OR @KinhPhiLonNhat IS NULL)
		AND (CONVERT(DATE,DT.ThucHienTuNgay,105) >= CONVERT(DATE,@ThucHienTuNgay,105) OR @ThucHienTuNgay IS NULL )
		AND (CONVERT(DATE,DT.ThucHienDenNgay,105) <= CONVERT(DATE,@ThucHienDenNgay,105) OR @ThucHienDenNgay IS NULL  )
		AND (DT.UserId = @UserId OR @UserId IS NULL)
	END
ELSE
	BEGIN
	SELECT TenDeTai,CNDT_HoTen,CQCTDT_TenToChucKHCN,ThucHienTuNgay,ThucHienDenNgay,DMTinhTrangDeTaiID,BC.SoHopDong,BC.BaoCaoKetQuaID
	FROM DETAI DT INNER JOIN BAOCAOKETQUA BC ON DT.DeTaiID = BC.BCKQ_DeTaiID
	WHERE 	
		(UPPER(LTRIM(RTRIM(DT.MaSoDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@MaSoDeTai)))+'%' OR @MaSoDeTai IS NULL)  
		AND (UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%' + UPPER(LTRIM(RTRIM(@CNDT_HoTen))) + '%' OR @CNDT_HoTen IS NULL)
		AND (UPPER(LTRIM(RTRIM(DT.CQCTDT_TenToChucKHCN))) LIKE '%' +UPPER(LTRIM(RTRIM(@CQCTDT_TenToChucKHCN)))+ '%' OR @CQCTDT_TenToChucKHCN IS NULL)
		AND (DT.KinhPhi >= @KinhPhiNhoNhat OR @KinhPhiNhoNhat IS NULL)
		AND (DT.KinhPhi <= @KinhPhiLonNhat OR @KinhPhiLonNhat IS NULL)
		AND (CONVERT(DATE,DT.ThucHienTuNgay,105) >= CONVERT(DATE,@ThucHienTuNgay,105) OR @ThucHienTuNgay IS NULL )
		AND (CONVERT(DATE,DT.ThucHienDenNgay,105) <= CONVERT(DATE,@ThucHienDenNgay,105) OR @ThucHienDenNgay IS NULL  )
		AND (DT.UserId = @UserId OR @UserId IS NULL)
	END
END
GO
PRINT N'Creating [dbo].[proc_DanhSachHoiDongLuaChon]...';


GO
CREATE PROCEDURE [dbo].[proc_DanhSachHoiDongLuaChon]
	@LoaiHoiDong VARCHAR(50)
AS
	SELECT
	 ChonLuaID,A.HoiDongID,LoaiHoiDong,NgayThanhLap,MaHoiDong,DoiTuongXetDuyet
	 ,DMKhoaPhongID,DMLoaiHoSoID
	 FROM(SELECT * FROM HOIDONG_CHONLUA NOLOCK) AS A
	INNER JOIN(SELECT * FROM HOIDONG_YEUCAU_XETDUYET NOLOCK) AS B ON B.HoiDongID=A.HoiDongID
	INNER JOIN(SELECT * FROM HOIDONG_CHUANBI_CUOCHOP NOLOCK)AS C ON C.HoiDongID=A.HoiDongID 
	WHERE  LoaiHoiDong LIKE '%'
	ORDER BY MaHoiDong,NgayThanhLap
GO
PRINT N'Creating [dbo].[proc_DanhSachLoaiHoiDongNhiemKy]...';


GO
CREATE PROC proc_DanhSachLoaiHoiDongNhiemKy
AS
SELECT HDNhiemKyID,MaHoiDong
	,CONVERT(nvarchar,NgayThanhLap,103) NgayThanhLap
	,LoaiHoiDong
	,CONVERT(nvarchar,NhiemKy_Tu,103) NhiemKy_Tu
	,CONVERT(nvarchar,NhiemKy_Den,103) NhiemKy_Den
	,CASE WHEN(LoaiHoiDong=10) THEN N'Hội đồng Đạo đức nghiên cứu Y sinh học'
	WHEN(LoaiHoiDong=20) THEN N'Hội đồng khoa học kỹ thuật'
	WHEN(LoaiHoiDong=30) THEN N'Hội đồng chuyên môn'
	END LoaiHoiDong_text
 FROM HOIDONG_NHIEMKY ORDER BY LoaiHoiDong,NgayThanhLap
GO
PRINT N'Creating [dbo].[proc_DanhSachNhanVien_CuocHop]...';


GO
CREATE PROC proc_DanhSachNhanVien_CuocHop
		@CuocHopID INT
	AS
	SELECT B.*,CuocHopID,ThanhVienCuocHopID FROM(SELECT * FROM HOIDONG_CHUANBI_CUOCHOP_THANHVIEN NOLOCK WHERE CuocHopID=@CuocHopID)AS A
	INNER JOIN(SELECT * FROM HOIDONG_CHONLUA_THANHVIEN NOLOCK) AS B ON B.ThanhVienHDID=A.ThanhVienHDID
	ORDER BY MaThanhVien,TenThanhVien
GO
PRINT N'Creating [dbo].[proc_DanhSachNhanVien_GhiNhanKetQua]...';


GO
	CREATE PROC proc_DanhSachNhanVien_GhiNhanKetQua
		@GhiNhanID INT
	AS
	SELECT * FROM(SELECT * FROM HOIDONG_GHINHAN_KETQUA_THANVIEN NOLOCK)AS A
	INNER JOIN(SELECT * FROM HOIDONG_CHUANBI_CUOCHOP_THANHVIEN NOLOCK) AS B ON B.ThanhVienCuocHopID=A.ThanhVienCuocHopID
	INNER JOIN(SELECT * FROM HOIDONG_CHONLUA_THANHVIEN NOLOCK) AS C ON C.ThanhVienHDID=B.ThanhVienHDID
	ORDER BY MaThanhVien,TenThanhVien
GO
PRINT N'Creating [dbo].[proc_DanhSachThanVienCuocHop_HoiDongID]...';


GO
CREATE PROC proc_DanhSachThanVienCuocHop_HoiDongID
@HoiDongID INT
AS
   SELECT DISTINCT B.*,C.* FROM(SELECT * FROM HOIDONG_CHONLUA NOLOCK WHERE HoiDongID=@HoiDongID) AS A
	INNER JOIN(SELECT * FROM HOIDONG_CHONLUA_THANHVIEN NOLOCK) AS B ON B.ChonLuaID=A.ChonLuaID
	INNER JOIN(SELECT * FROM HOIDONG_CHUANBI_CUOCHOP_THANHVIEN NOLOCK) AS C ON C.ThanhVienHDID=B.ThanhVienHDID
   ORDER BY MaThanhVien,TenThanhVien
GO
PRINT N'Creating [dbo].[proc_DanhSachThanVienHoiDongChonLua]...';


GO
	CREATE PROC proc_DanhSachThanVienHoiDongChonLua
		@HoiDongID INT
	AS
	SELECT B.* FROM(SELECT * FROM HOIDONG_CHONLUA NOLOCK WHERE HoiDongID=@HoiDongID) AS A
	INNER JOIN(SELECT * FROM HOIDONG_CHONLUA_THANHVIEN NOLOCK) AS B ON B.ChonLuaID=A.ChonLuaID
   ORDER BY MaThanhVien,TenThanhVien
GO
PRINT N'Creating [dbo].[proc_DeTai_FullTextIndexSearch]...';


GO
CREATE PROCEDURE [dbo].[proc_DeTai_FullTextIndexSearch]
	@TenDeTai nvarchar(1000),
	@MaSoDeTai nvarchar(1000),
	@CNDT_HoTen nvarchar(1000),
	@CQCTDT_TenToChucKHCN nvarchar(1000),
	@ThucHienTuNgay datetime,
	@ThucHienDenNgay datetime,
	@KinhPhiNhoNhat money,
	@KinhPhiLonNhat money,
	@UserId int
AS
BEGIN

SET NOCOUNT ON;
IF @TenDeTai IS NOT NULL
	BEGIN
	SELECT DT.*
	FROM DETAI DT 
		INNER JOIN
		FREETEXTTABLE(DETAI,TenDeTai,@TenDeTai) AS FTS_DT
		ON DT.DeTaiID = FTS_DT.[KEY]
		AND (UPPER(LTRIM(RTRIM(DT.MaSoDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@MaSoDeTai)))+'%' OR @MaSoDeTai IS NULL)  
		AND (UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%' + UPPER(LTRIM(RTRIM(@CNDT_HoTen))) + '%' OR @CNDT_HoTen IS NULL)
		AND (UPPER(LTRIM(RTRIM(DT.CQCTDT_TenToChucKHCN))) LIKE '%' +UPPER(LTRIM(RTRIM(@CQCTDT_TenToChucKHCN)))+ '%' OR @CQCTDT_TenToChucKHCN IS NULL)
		AND (DT.KinhPhi >= @KinhPhiNhoNhat OR @KinhPhiNhoNhat IS NULL)
		AND (DT.KinhPhi <= @KinhPhiLonNhat OR @KinhPhiLonNhat IS NULL)
		AND (CONVERT(DATE,DT.ThucHienTuNgay,105) >= CONVERT(DATE,@ThucHienTuNgay,105) OR @ThucHienTuNgay IS NULL )
		AND (CONVERT(DATE,DT.ThucHienDenNgay,105) <= CONVERT(DATE,@ThucHienDenNgay,105) OR @ThucHienDenNgay IS NULL  )
		AND (DT.UserId = @UserId OR  @UserId IS NULL)
	END
ELSE
	BEGIN
	SELECT DT.*
	FROM DETAI DT 
	WHERE 	
		(UPPER(LTRIM(RTRIM(DT.MaSoDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@MaSoDeTai)))+'%' OR @MaSoDeTai IS NULL)  
		AND (UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%' + UPPER(LTRIM(RTRIM(@CNDT_HoTen))) + '%' OR @CNDT_HoTen IS NULL)
		AND (UPPER(LTRIM(RTRIM(DT.CQCTDT_TenToChucKHCN))) LIKE '%' +UPPER(LTRIM(RTRIM(@CQCTDT_TenToChucKHCN)))+ '%' OR @CQCTDT_TenToChucKHCN IS NULL)
		AND (DT.KinhPhi >= @KinhPhiNhoNhat OR @KinhPhiNhoNhat IS NULL)
		AND (DT.KinhPhi <= @KinhPhiLonNhat OR @KinhPhiLonNhat IS NULL)
		AND (CONVERT(DATE,DT.ThucHienTuNgay,105) >= CONVERT(DATE,@ThucHienTuNgay,105) OR @ThucHienTuNgay IS NULL)
		AND (CONVERT(DATE,DT.ThucHienDenNgay,105) <= CONVERT(DATE,@ThucHienDenNgay,105) OR @ThucHienDenNgay IS NULL )
		AND (DT.UserId = @UserId OR @UserId IS NULL)
	END
END
GO
PRINT N'Creating [dbo].[proc_DiemDanhGia_FullTextIndexSearch]...';


GO
CREATE PROCEDURE [dbo].[proc_DiemDanhGia_FullTextIndexSearch]
	@TenDeTai nvarchar(1000),
	@ChuNhiemDeTai nvarchar(1000),
	@SoPhieu nvarchar(1000),
	@DanhGiaTuNgay date,
	@DanhGiaDenNgay date,
	@UserId int
AS
BEGIN
	SET NOCOUNT ON;

	IF @TenDeTai IS NOT NULL
		SELECT 
			DDG.DiemDanhGiaID,
			DDG.SoPhieu,
			DT.TenDeTai,
			DT.CNDT_HoTen AS ChuNhiemDeTai,
			DDG.NgayDanhGia,
			DT.ThucHienTuNgay,
			DT.ThucHienDenNgay
		FROM DETAI DT INNER JOIN FREETEXTTABLE(DETAI,TenDeTai,@TenDeTai) AS FTS_DT ON DT.DeTaiID = FTS_DT.[KEY]
		INNER JOIN  DIEMDANHGIA DDG ON DDG.DDG_DeTaiID = DT.DeTaiID
		--WHERE FREETEXT(TenDeTai,@TenDeTai)
		AND (UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%' +UPPER(LTRIM(RTRIM(@ChuNhiemDeTai)))+ '%' OR @ChuNhiemDeTai IS NULL)
		AND (CONVERT(DATE,DDG.NgayDanhGia,105) >= CONVERT(DATE,@DanhGiaTuNgay,105) OR @DanhGiaTuNgay IS NULL)
		AND (CONVERT(DATE,DDG.NgayDanhGia,105) <= CONVERT(DATE,@DanhGiaDenNgay,105) OR @DanhGiaDenNgay IS NULL)
		AND (UPPER(LTRIM(RTRIM(DDG.SoPhieu))) LIKE '%' +UPPER(LTRIM(RTRIM(@SoPhieu))) + '%' OR @SoPhieu IS NULL)
		AND (DT.UserId = @UserId OR @UserId IS NULL)
	ELSE
		SELECT 
				DDG.DiemDanhGiaID,
				DDG.SoPhieu,
				DT.TenDeTai,
				DT.CNDT_HoTen AS ChuNhiemDeTai,
				DDG.NgayDanhGia,
				DT.ThucHienTuNgay,
				DT.ThucHienDenNgay
			FROM DIEMDANHGIA DDG
			INNER JOIN DETAI DT ON DDG.DDG_DeTaiID = DT.DeTaiID
			WHERE 
			(UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%' +UPPER(LTRIM(RTRIM(@ChuNhiemDeTai)))+ '%' OR @ChuNhiemDeTai IS NULL)
			AND (CONVERT(DATE,DDG.NgayDanhGia,105) >= CONVERT(DATE,@DanhGiaTuNgay,105) OR @DanhGiaTuNgay IS NULL)
			AND (CONVERT(DATE,DDG.NgayDanhGia,105) <= CONVERT(DATE,@DanhGiaDenNgay,105) OR @DanhGiaDenNgay IS NULL)
			AND (UPPER(LTRIM(RTRIM(DDG.SoPhieu))) LIKE '%' +UPPER(LTRIM(RTRIM(@SoPhieu))) + '%' OR @SoPhieu IS NULL)
			AND (DT.UserId = @UserId OR @UserId IS NULL)
END
GO
PRINT N'Creating [dbo].[proc_GiaHanThucHienDeTai_FullTextIndexSearch]...';


GO
CREATE PROCEDURE [dbo].[proc_GiaHanThucHienDeTai_FullTextIndexSearch]
	 @GiaHanTuNgay datetime,
	 @GiaHanDenNgay datetime,
	 @TrangThai int,
	 @TenDeTai nvarchar(1000),
	 @ChuNhiemDeTai nvarchar(1000),
	 @UserId int
AS 
BEGIN

	SET NOCOUNT ON;

	IF @TrangThai  = 0 OR @TrangThai IS NULL
	BEGIN
		IF @TenDeTai IS NOT NULL		
			SELECT GiaHanThucHienDeTaiID,GHDT_DeTaiID,GiaHanDenNgay AS NgayGiaHan,LyDo,DaDuyet as TrangThai,DT.TenDeTai,DT.CNDT_HoTen AS ChuNhiemDeTai,ThucHienTuNgay,ThucHienDenNgay
			FROM DETAI DT INNER JOIN FREETEXTTABLE(DETAI,TenDeTai,@TenDeTai) AS FTS_DT ON DT.DeTaiID = FTS_DT.[KEY]
			INNER JOIN GIAHANTHUCHIENDETAI GHDT ON GHDT.GHDT_DeTaiID = DT.DeTaiID
			--WHERE FREETEXT(TenDeTai,@TenDeTai)
			AND (CONVERT(DATE,GHDT.GiaHanDenNgay,105) >= CONVERT(DATE,@GiaHanTuNgay,105) OR @GiaHanTuNgay IS NULL)
			AND (CONVERT(DATE,GHDT.GiaHanDenNgay,105) <= CONVERT(DATE,@GiaHanDenNgay,105) OR @GiaHanDenNgay IS NULL)
			AND (UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%'+UPPER(LTRIM(RTRIM(@ChuNhiemDeTai)))+'%' OR @ChuNhiemDeTai IS NULL)
			AND (DT.UserId = @UserId OR @UserId IS NULL)
		ELSE
			SELECT GiaHanThucHienDeTaiID,GHDT_DeTaiID,GiaHanDenNgay AS NgayGiaHan,LyDo,DaDuyet as TrangThai,DT.TenDeTai,DT.CNDT_HoTen AS ChuNhiemDeTai,ThucHienTuNgay,ThucHienDenNgay
			FROM GIAHANTHUCHIENDETAI GHDT INNER JOIN DETAI DT
			ON DT.DeTaiID = GHDT.GHDT_DeTaiID
			WHERE 
			(CONVERT(DATE,GHDT.GiaHanDenNgay,105) >= CONVERT(DATE,@GiaHanTuNgay,105) OR @GiaHanTuNgay IS NULL)
			AND (CONVERT(DATE,GHDT.GiaHanDenNgay,105) <= CONVERT(DATE,@GiaHanDenNgay,105) OR @GiaHanDenNgay IS NULL)
			AND (UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%'+UPPER(LTRIM(RTRIM(@ChuNhiemDeTai)))+'%' OR @ChuNhiemDeTai IS NULL)
			AND (DT.UserId = @UserId OR @UserId IS NULL)
	END	

	--=============================================================================

	IF @TrangThai  = 1
	BEGIN
		IF @TenDeTai IS NOT NULL		
			SELECT GiaHanThucHienDeTaiID,GHDT_DeTaiID,GiaHanDenNgay AS NgayGiaHan,LyDo,DaDuyet as TrangThai,DT.TenDeTai,DT.CNDT_HoTen AS ChuNhiemDeTai,ThucHienTuNgay,ThucHienDenNgay
			FROM DETAI DT INNER JOIN FREETEXTTABLE(DETAI,TenDeTai,@TenDeTai) AS FTS_DT ON DT.DeTaiID = FTS_DT.[KEY]
			INNER JOIN GIAHANTHUCHIENDETAI GHDT ON GHDT.GHDT_DeTaiID = DT.DeTaiID
			--WHERE FREETEXT(TenDeTai,@TenDeTai)
			AND (CONVERT(DATE,GHDT.GiaHanDenNgay,105) >= CONVERT(DATE,@GiaHanTuNgay,105) OR @GiaHanTuNgay IS NULL)
			AND (CONVERT(DATE,GHDT.GiaHanDenNgay,105) <= CONVERT(DATE,@GiaHanDenNgay,105) OR @GiaHanDenNgay IS NULL)
			AND (UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%'+UPPER(LTRIM(RTRIM(@ChuNhiemDeTai)))+'%' OR @ChuNhiemDeTai IS NULL)
			AND (GHDT.DaDuyet = 0)
			AND (DT.UserId = @UserId OR @UserId IS NULL)
		ELSE
			SELECT GiaHanThucHienDeTaiID,GHDT_DeTaiID,GiaHanDenNgay AS NgayGiaHan,LyDo,DaDuyet as TrangThai,DT.TenDeTai,DT.CNDT_HoTen AS ChuNhiemDeTai,ThucHienTuNgay,ThucHienDenNgay
			FROM GIAHANTHUCHIENDETAI GHDT INNER JOIN DETAI DT
			ON DT.DeTaiID = GHDT.GHDT_DeTaiID
			WHERE 
			(CONVERT(DATE,GHDT.GiaHanDenNgay,105) >= CONVERT(DATE,@GiaHanTuNgay,105) OR @GiaHanTuNgay IS NULL)
			AND (CONVERT(DATE,GHDT.GiaHanDenNgay,105) <= CONVERT(DATE,@GiaHanDenNgay,105) OR @GiaHanDenNgay IS NULL)
			AND (UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%'+UPPER(LTRIM(RTRIM(@ChuNhiemDeTai)))+'%' OR @ChuNhiemDeTai IS NULL)
			AND (GHDT.DaDuyet = 0)
			AND (DT.UserId = @UserId OR @UserId IS NULL)
	END	

	--=============================================================================

	IF @TrangThai  = 2
	BEGIN
		IF @TenDeTai IS NOT NULL		
			SELECT GiaHanThucHienDeTaiID,GHDT_DeTaiID,GiaHanDenNgay AS NgayGiaHan,LyDo,DaDuyet as TrangThai,DT.TenDeTai,DT.CNDT_HoTen AS ChuNhiemDeTai,ThucHienTuNgay,ThucHienDenNgay
			FROM DETAI DT INNER JOIN FREETEXTTABLE(DETAI,TenDeTai,@TenDeTai) AS FTS_DT ON DT.DeTaiID = FTS_DT.[KEY]
			INNER JOIN GIAHANTHUCHIENDETAI GHDT ON GHDT.GHDT_DeTaiID = DT.DeTaiID
			--WHERE FREETEXT(TenDeTai,@TenDeTai)
			AND (CONVERT(DATE,GHDT.GiaHanDenNgay,105) >= CONVERT(DATE,@GiaHanTuNgay,105) OR @GiaHanTuNgay IS NULL)
			AND (CONVERT(DATE,GHDT.GiaHanDenNgay,105) <= CONVERT(DATE,@GiaHanDenNgay,105) OR @GiaHanDenNgay IS NULL)
			AND (UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%'+UPPER(LTRIM(RTRIM(@ChuNhiemDeTai)))+'%' OR @ChuNhiemDeTai IS NULL)
			AND (GHDT.DaDuyet = 1)
			AND (DT.UserId = @UserId OR @UserId IS NULL)
		ELSE
			SELECT GiaHanThucHienDeTaiID,GHDT_DeTaiID,GiaHanDenNgay AS NgayGiaHan,LyDo,DaDuyet as TrangThai,DT.TenDeTai,DT.CNDT_HoTen AS ChuNhiemDeTai,ThucHienTuNgay,ThucHienDenNgay
			FROM GIAHANTHUCHIENDETAI GHDT INNER JOIN DETAI DT
			ON DT.DeTaiID = GHDT.GHDT_DeTaiID
			WHERE 
			(CONVERT(DATE,GHDT.GiaHanDenNgay,105) >= CONVERT(DATE,@GiaHanTuNgay,105) OR @GiaHanTuNgay IS NULL)
			AND (CONVERT(DATE,GHDT.GiaHanDenNgay,105) <= CONVERT(DATE,@GiaHanDenNgay,105) OR @GiaHanDenNgay IS NULL)
			AND (UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%'+UPPER(LTRIM(RTRIM(@ChuNhiemDeTai)))+'%' OR @ChuNhiemDeTai IS NULL)
			AND (GHDT.DaDuyet = 1)
			AND (DT.UserId = @UserId OR @UserId IS NULL)
	END	

END
GO
PRINT N'Creating [dbo].[proc_HoiDongNghiemThu_FullTextIndexSearch]...';


GO
CREATE PROCEDURE [dbo].[proc_HoiDongNghiemThu_FullTextIndexSearch]
	@SoQuyetDinh NVARCHAR(1000),
	@QuyetDinhTuNgay datetime,
	@QuyetDinhDenNgay datetime,
	@HoTen nvarchar(1000),
	@UserId int
AS
BEGIN
	SET NOCOUNT ON;

	IF @HoTen IS NOT NULL
		BEGIN 
			
			SELECT DISTINCT(HD.HoiDongNghiemThuID),HD.NgayQuyetDinh,HD.SoQuyetDinh,HD.TrichYeu,HD.GhiChu,HD.DMDonViBanHanhID,HD.HDNT_DeTaiID
			FROM DANHSACHHOIDONG DSHD INNER JOIN FREETEXTTABLE(DANHSACHHOIDONG,HoTen,@HoTen) AS FTS_DS
			ON DSHD.DanhSachHoiDongID = FTS_DS.[KEY]
			RIGHT JOIN HOIDONGNGHIEMTHU HD ON HD.HoiDongNghiemThuID = DSHD.HoiDongNghiemThuID
			INNER JOIN DETAI DT ON DT.DeTaiID = HD.HDNT_DeTaiID
			--WHERE FREETEXT(HoTen,@HoTen)
			AND (CONVERT(DATE,NgayQuyetDinh,105) >= CONVERT(DATE,@QuyetDinhTuNgay,105)  OR @QuyetDinhTuNgay IS NULL) 
			AND (CONVERT(DATE,NgayQuyetDinh,105) <= CONVERT(DATE,@QuyetDinhDenNgay,105)  OR @QuyetDinhDenNgay IS NULL)
			AND (UPPER(LTRIM(RTRIM(SoQuyetDinh))) LIKE '%' +UPPER(LTRIM(RTRIM(@SoQuyetDinh)))+ '%' OR @SoQuyetDinh IS NULL)
			AND (DT.UserId = @UserId OR @UserId IS NULL)
		END
	ELSE
		BEGIN
			SELECT DISTINCT(HD.HoiDongNghiemThuID),HD.NgayQuyetDinh,HD.SoQuyetDinh,HD.TrichYeu,HD.GhiChu,HD.DMDonViBanHanhID,HD.HDNT_DeTaiID
			FROM HOIDONGNGHIEMTHU HD 		
			LEFT JOIN DANHSACHHOIDONG AS DSHD
			ON HD.HoiDongNghiemThuID = DSHD.HoiDongNghiemThuID
			INNER JOIN DETAI DT ON DT.DeTaiID = HD.HDNT_DeTaiID
			WHERE 
			(CONVERT(DATE,NgayQuyetDinh,105) >= CONVERT(DATE,@QuyetDinhTuNgay,105)  OR @QuyetDinhTuNgay IS NULL) 
			AND (CONVERT(DATE,NgayQuyetDinh,105) <= CONVERT(DATE,@QuyetDinhDenNgay,105)  OR @QuyetDinhDenNgay IS NULL)
			AND (UPPER(LTRIM(RTRIM(SoQuyetDinh))) LIKE '%' +UPPER(LTRIM(RTRIM(@SoQuyetDinh)))+ '%' OR @SoQuyetDinh IS NULL)
			AND (DT.UserId = @UserId OR @UserId IS NULL)
		END	
END
GO
PRINT N'Creating [dbo].[proc_HoiDongNghienCuu_FullTextIndexSearch]...';


GO
CREATE PROCEDURE [dbo].[proc_HoiDongNghienCuu_FullTextIndexSearch]
	@SoQuyetDinh NVARCHAR(1000),
	@QuyetDinhTuNgay datetime,
	@QuyetDinhDenNgay datetime,
	@HoTen nvarchar(1000),
	@UserId int
AS
BEGIN
	SET NOCOUNT ON;

	IF @HoTen IS NOT NULL
		BEGIN 
			
			SELECT DISTINCT(HD.HoiDongNghienCuuID),HD.NgayQuyetDinh,HD.SoQuyetDinh,HD.TrichYeu,HD.GhiChu,HD.DMDonViBanHanhID,HD.HDNC_DeTaiID
			FROM DANHSACHHOIDONGNGHIENCUU DSHDNC INNER JOIN FREETEXTTABLE(DANHSACHHOIDONGNGHIENCUU,HoTen,@HoTen) AS FTS_DS
			ON DSHDNC.DanhSachHoiDongNghienCuuID = FTS_DS.[KEY]
			RIGHT JOIN HOIDONGNGHIENCUU HD ON HD.HoiDongNghienCuuID = DSHDNC.HoiDongNghienCuuID
			INNER JOIN DETAI DT ON DT.DeTaiID = HD.HDNC_DeTaiID
			--WHERE FREETEXT(HoTen,@HoTen)
			AND (CONVERT(DATE,NgayQuyetDinh,105) >= CONVERT(DATE,@QuyetDinhTuNgay,105)  OR @QuyetDinhTuNgay IS NULL) 
			AND (CONVERT(DATE,NgayQuyetDinh,105) <= CONVERT(DATE,@QuyetDinhDenNgay,105)  OR @QuyetDinhDenNgay IS NULL)
			AND (UPPER(LTRIM(RTRIM(SoQuyetDinh))) LIKE '%' +UPPER(LTRIM(RTRIM(@SoQuyetDinh)))+ '%' OR @SoQuyetDinh IS NULL)
			AND (@UserId = DT.UserId OR @UserId IS NULL)
		END
	ELSE
		BEGIN
			SELECT DISTINCT(HD.HoiDongNghienCuuID),HD.NgayQuyetDinh,HD.SoQuyetDinh,HD.TrichYeu,HD.GhiChu,HD.DMDonViBanHanhID,HD.HDNC_DeTaiID
			FROM HOIDONGNGHIENCUU HD 				
			LEFT JOIN DANHSACHHOIDONGNGHIENCUU AS DSHDNC
			ON HD.HoiDongNghienCuuID = DSHDNC.HoiDongNghienCuuID
			INNER JOIN DETAI DT 
			ON DT.DeTaiID = HD.HDNC_DeTaiID
			WHERE 
			(CONVERT(DATE,NgayQuyetDinh,105) >= CONVERT(DATE,@QuyetDinhTuNgay,105)  OR @QuyetDinhTuNgay IS NULL) 
			AND (CONVERT(DATE,NgayQuyetDinh,105) <= CONVERT(DATE,@QuyetDinhDenNgay,105)  OR @QuyetDinhDenNgay IS NULL)
			AND (UPPER(LTRIM(RTRIM(SoQuyetDinh))) LIKE '%' +UPPER(LTRIM(RTRIM(@SoQuyetDinh)))+ '%' OR @SoQuyetDinh IS NULL)
			AND (@UserId = DT.UserId OR @UserId IS NULL)
		END	
END
GO
PRINT N'Creating [dbo].[proc_HopDongKhoaHocCongNghe_FullTextIndexSearch]...';


GO
CREATE PROCEDURE [dbo].[proc_HopDongKhoaHocCongNghe_FullTextIndexSearch]
	@SoHopDong nvarchar(1000),
	@TrangThai int,
	@BenA nvarchar(1000),
	@BenB nvarchar(1000),
	@TenDeTai nvarchar(1000),
	@ChuNhiemDeTai nvarchar(1000),
	@BatDauTuNgay date,
	@BatDauDenNgay date,
	@KetThucTuNgay date,
	@KetThucDenNgay date,
	@UserId int
AS
BEGIN
	SET NOCOUNT ON;

	IF @TrangThai = 1 OR @TrangThai IS NULL
	BEGIN 
		IF @TenDeTai IS NOT NULL
			SELECT
				HD.HopDongID,
				HD.SoHopDong,
				HD.NgayKy,
				HD.NgayBatDau,
				HD.NgayKetThuc,
				HD.BenA_TenCoQuan AS BenDatHang,
				HD.BenB_TenCoQuan AS BenNhanDatHang,
				DT.TenDeTai,
				DT.CNDT_HoTen as ChuNhiemDeTai,
				DT.DeTaiID
			FROM DETAI DT INNER JOIN FREETEXTTABLE(DETAI,TenDeTai,@TenDeTai) as FTS_DT ON DT.DeTaiID = FTS_DT.[KEY]
			INNER JOIN HOPDONG HD ON HD.HD_DeTaiID = DT.DeTaiID
			--WHERE FREETEXT(TenDeTai,@TenDeTai)
			AND (UPPER(LTRIM(RTRIM(HD.BenA_TenCoQuan))) LIKE '%'+UPPER(LTRIM(RTRIM(@BENA)))+'%'  OR @BenA IS NULL)
			AND (UPPER(LTRIM(RTRIM(HD.BenB_TenCoQuan))) LIKE '%'+UPPER(LTRIM(RTRIM(@BenB)))+'%'  OR @BenB IS NULL)		
			AND (UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%'+UPPER(LTRIM(RTRIM(@ChuNhiemDeTai)))+'%'  OR @ChuNhiemDeTai IS NULL)
			AND (CONVERT(DATE,@BatDauTuNgay,105) <= CONVERT(DATE,HD.NgayBatDau,105) OR @BatDauTuNgay IS NULL)
			AND (CONVERT(DATE,@BatDauDenNgay,105) >= CONVERT(DATE,HD.NgayBatDau,105) OR @BatDauDenNgay IS NULL)
			AND (CONVERT(DATE,@KetThucTuNgay,105) <= CONVERT(DATE,HD.NgayKetThuc,105) OR @KetThucTuNgay IS NULL)
			AND (CONVERT(DATE,@KetThucDenNgay,105) >= CONVERT(DATE,HD.NgayKetThuc,105) OR @KetThucDenNgay IS NULL)
			AND (DT.UserId = @UserId OR @UserId IS NULL)
		ELSE

			SELECT
				HD.HopDongID,
				HD.SoHopDong,
				HD.NgayKy,
				HD.NgayBatDau,
				HD.NgayKetThuc,
				HD.BenA_TenCoQuan AS BenDatHang,
				HD.BenB_TenCoQuan AS BenNhanDatHang,
				DT.TenDeTai,
				DT.CNDT_HoTen as ChuNhiemDeTai,
				DT.DeTaiID
			FROM HOPDONG HD INNER JOIN  DETAI DT ON HD.HD_DeTaiID = DT.DeTaiID
			WHERE 
			(UPPER(LTRIM(RTRIM(HD.BenA_TenCoQuan))) LIKE '%'+UPPER(LTRIM(RTRIM(@BENA)))+'%'  OR @BenA IS NULL)
			AND (UPPER(LTRIM(RTRIM(HD.BenB_TenCoQuan))) LIKE '%'+UPPER(LTRIM(RTRIM(@BenB)))+'%'  OR @BenB IS NULL)		
			AND (UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%'+UPPER(LTRIM(RTRIM(@ChuNhiemDeTai)))+'%'  OR @ChuNhiemDeTai IS NULL)
			AND (CONVERT(DATE,@BatDauTuNgay,105) <= CONVERT(DATE,HD.NgayBatDau,105) OR @BatDauTuNgay IS NULL)
			AND (CONVERT(DATE,@BatDauDenNgay,105) >= CONVERT(DATE,HD.NgayBatDau,105) OR @BatDauDenNgay IS NULL)
			AND (CONVERT(DATE,@KetThucTuNgay,105) <= CONVERT(DATE,HD.NgayKetThuc,105) OR @KetThucTuNgay IS NULL)
			AND (CONVERT(DATE,@KetThucDenNgay,105) >= CONVERT(DATE,HD.NgayKetThuc,105) OR @KetThucDenNgay IS NULL)
			AND (DT.UserId = @UserId OR @UserId IS NULL)
	END
	--------------------------------------------------------------
	IF @TrangThai = 2
	BEGIN 
		IF @TenDeTai IS NOT NULL
			SELECT
				HD.HopDongID,
				HD.SoHopDong,
				HD.NgayKy,
				HD.NgayBatDau,
				HD.NgayKetThuc,
				HD.BenA_TenCoQuan AS BenDatHang,
				HD.BenB_TenCoQuan AS BenNhanDatHang,
				DT.TenDeTai,
				DT.CNDT_HoTen as ChuNhiemDeTai,
				DT.DeTaiID
			FROM DETAI DT INNER JOIN FREETEXTTABLE(DETAI,TenDeTai,@TenDeTai) as FTS_DT ON DT.DeTaiID = FTS_DT.[KEY]
			INNER JOIN HOPDONG HD ON HD.HD_DeTaiID = DT.DeTaiID
			--WHERE FREETEXT(TenDeTai,@TenDeTai)
			AND (UPPER(LTRIM(RTRIM(HD.BenA_TenCoQuan))) LIKE '%'+UPPER(LTRIM(RTRIM(@BENA)))+'%'  OR @BenA IS NULL)
			AND (UPPER(LTRIM(RTRIM(HD.BenB_TenCoQuan))) LIKE '%'+UPPER(LTRIM(RTRIM(@BenB)))+'%'  OR @BenB IS NULL)		
			AND (UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%'+UPPER(LTRIM(RTRIM(@ChuNhiemDeTai)))+'%'  OR @ChuNhiemDeTai IS NULL)
			AND (CONVERT(DATE,@BatDauTuNgay,105) <= CONVERT(DATE,HD.NgayBatDau,105) OR @BatDauTuNgay IS NULL)
			AND (CONVERT(DATE,@BatDauDenNgay,105) >= CONVERT(DATE,HD.NgayBatDau,105) OR @BatDauDenNgay IS NULL)
			AND (CONVERT(DATE,@KetThucTuNgay,105) <= CONVERT(DATE,HD.NgayKetThuc,105) OR @KetThucTuNgay IS NULL)
			AND (CONVERT(DATE,@KetThucDenNgay,105) >= CONVERT(DATE,HD.NgayKetThuc,105) OR @KetThucDenNgay IS NULL)
			AND (CONVERT(DATE,HD.NgayKetThuc,105) > CONVERT(DATE,GETDATE(),105))
			AND (DT.UserId = @UserId OR @UserId IS NULL)
		ELSE

			SELECT
				HD.HopDongID,
				HD.SoHopDong,
				HD.NgayKy,
				HD.NgayBatDau,
				HD.NgayKetThuc,
				HD.BenA_TenCoQuan AS BenDatHang,
				HD.BenB_TenCoQuan AS BenNhanDatHang,
				DT.TenDeTai,
				DT.CNDT_HoTen as ChuNhiemDeTai,
				DT.DeTaiID
			FROM HOPDONG HD INNER JOIN  DETAI DT ON HD.HD_DeTaiID = DT.DeTaiID
			WHERE 
			(UPPER(LTRIM(RTRIM(HD.BenA_TenCoQuan))) LIKE '%'+UPPER(LTRIM(RTRIM(@BENA)))+'%'  OR @BenA IS NULL)
			AND (UPPER(LTRIM(RTRIM(HD.BenB_TenCoQuan))) LIKE '%'+UPPER(LTRIM(RTRIM(@BenB)))+'%'  OR @BenB IS NULL)		
			AND (UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%'+UPPER(LTRIM(RTRIM(@ChuNhiemDeTai)))+'%'  OR @ChuNhiemDeTai IS NULL)
			AND (CONVERT(DATE,@BatDauTuNgay,105) <= CONVERT(DATE,HD.NgayBatDau,105) OR @BatDauTuNgay IS NULL)
			AND (CONVERT(DATE,@BatDauDenNgay,105) >= CONVERT(DATE,HD.NgayBatDau,105) OR @BatDauDenNgay IS NULL)
			AND (CONVERT(DATE,@KetThucTuNgay,105) <= CONVERT(DATE,HD.NgayKetThuc,105) OR @KetThucTuNgay IS NULL)
			AND (CONVERT(DATE,@KetThucDenNgay,105) >= CONVERT(DATE,HD.NgayKetThuc,105) OR @KetThucDenNgay IS NULL)
			AND (CONVERT(DATE,HD.NgayKetThuc,105) > CONVERT(DATE,GETDATE(),105))
			AND (DT.UserId = @UserId OR @UserId IS NULL)
	END
	--------------------------------------------------------------
	IF @TrangThai = 3
	BEGIN 
		IF @TenDeTai IS NOT NULL
			SELECT
				HD.HopDongID,
				HD.SoHopDong,
				HD.NgayKy,
				HD.NgayBatDau,
				HD.NgayKetThuc,
				HD.BenA_TenCoQuan AS BenDatHang,
				HD.BenB_TenCoQuan AS BenNhanDatHang,
				DT.TenDeTai,
				DT.CNDT_HoTen as ChuNhiemDeTai,
				DT.DeTaiID
			FROM DETAI DT INNER JOIN FREETEXTTABLE(DETAI,TenDeTai,@TenDeTai) as FTS_DT ON DT.DeTaiID = FTS_DT.[KEY]
			INNER JOIN HOPDONG HD ON HD.HD_DeTaiID = DT.DeTaiID
			--WHERE FREETEXT(TenDeTai,@TenDeTai)
			AND (UPPER(LTRIM(RTRIM(HD.BenA_TenCoQuan))) LIKE '%'+UPPER(LTRIM(RTRIM(@BENA)))+'%'  OR @BenA IS NULL)
			AND (UPPER(LTRIM(RTRIM(HD.BenB_TenCoQuan))) LIKE '%'+UPPER(LTRIM(RTRIM(@BenB)))+'%'  OR @BenB IS NULL)		
			AND (UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%'+UPPER(LTRIM(RTRIM(@ChuNhiemDeTai)))+'%'  OR @ChuNhiemDeTai IS NULL)
			AND (CONVERT(DATE,@BatDauTuNgay,105) <= CONVERT(DATE,HD.NgayBatDau,105) OR @BatDauTuNgay IS NULL)
			AND (CONVERT(DATE,@BatDauDenNgay,105) >= CONVERT(DATE,HD.NgayBatDau,105) OR @BatDauDenNgay IS NULL)
			AND (CONVERT(DATE,@KetThucTuNgay,105) <= CONVERT(DATE,HD.NgayKetThuc,105) OR @KetThucTuNgay IS NULL)
			AND (CONVERT(DATE,@KetThucDenNgay,105) >= CONVERT(DATE,HD.NgayKetThuc,105) OR @KetThucDenNgay IS NULL)
			AND (CONVERT(DATE,HD.NgayKetThuc,105) < CONVERT(DATE,GETDATE(),105))
			AND (DT.UserId = @UserId OR @UserId IS NULL)
		ELSE

			SELECT
				HD.HopDongID,
				HD.SoHopDong,
				HD.NgayKy,
				HD.NgayBatDau,
				HD.NgayKetThuc,
				HD.BenA_TenCoQuan AS BenDatHang,
				HD.BenB_TenCoQuan AS BenNhanDatHang,
				DT.TenDeTai,
				DT.CNDT_HoTen as ChuNhiemDeTai,
				DT.DeTaiID
			FROM HOPDONG HD INNER JOIN  DETAI DT ON HD.HD_DeTaiID = DT.DeTaiID
			WHERE 
			(UPPER(LTRIM(RTRIM(HD.BenA_TenCoQuan))) LIKE '%'+UPPER(LTRIM(RTRIM(@BENA)))+'%'  OR @BenA IS NULL)
			AND (UPPER(LTRIM(RTRIM(HD.BenB_TenCoQuan))) LIKE '%'+UPPER(LTRIM(RTRIM(@BenB)))+'%'  OR @BenB IS NULL)		
			AND (UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%'+UPPER(LTRIM(RTRIM(@ChuNhiemDeTai)))+'%'  OR @ChuNhiemDeTai IS NULL)
			AND (CONVERT(DATE,@BatDauTuNgay,105) <= CONVERT(DATE,HD.NgayBatDau,105) OR @BatDauTuNgay IS NULL)
			AND (CONVERT(DATE,@BatDauDenNgay,105) >= CONVERT(DATE,HD.NgayBatDau,105) OR @BatDauDenNgay IS NULL)
			AND (CONVERT(DATE,@KetThucTuNgay,105) <= CONVERT(DATE,HD.NgayKetThuc,105) OR @KetThucTuNgay IS NULL)
			AND (CONVERT(DATE,@KetThucDenNgay,105) >= CONVERT(DATE,HD.NgayKetThuc,105) OR @KetThucDenNgay IS NULL)
			AND (CONVERT(DATE,HD.NgayKetThuc,105) < CONVERT(DATE,GETDATE(),105))
			AND (DT.UserId = @UserId OR @UserId IS NULL)
	END
END
GO
PRINT N'Creating [dbo].[proc_Import_DanhMucCanBoThucHien]...';


GO
CREATE PROCEDURE [dbo].[proc_Import_DanhMucCanBoThucHien]
	@AllowAdd bit,
	@AllowUpdate bit,
	@MaCanBoThucHien nvarchar(1000),
	@HoTen nvarchar(1000),
	@DiaChiCoQuan nvarchar(1000),
	@DiaChiNhaRieng nvarchar(1000),
	@DienThoai nvarchar(1000),
	@Email nvarchar(1000),
	@Fax nvarchar(1000),
	@HocHamHocViID int,
	@ChucDanhKhoaHocID int,
	@ChucVuID int,
	@KhoaPhongID int	
AS
BEGIN
declare @ResultString nvarchar(1000)
	IF EXISTS (SELECT MaCanBoThucHien FROM DANHMUC_CANBOTHUCHIEN NOLOCK WHERE MaCanBoThucHien = @MaCanBoThucHien) 
	BEGIN
		IF (@AllowUpdate = 1)
		BEGIN
				update DANHMUC_CANBOTHUCHIEN 
				set 
					HoTen = @HoTen,
					DiaChiCoQuan = @DiaChiCoQuan,
					DiaChiNhaRieng = @DiaChiNhaRieng,
					DienThoai = @DienThoai,
					Email = @Email,
					Fax = @Fax,
					HocHamHocViID = @HocHamHocViID,
					ChucDanhKhoaHocID = @ChucDanhKhoaHocID,
					ChucVuID = @ChucVuID,
					KhoaPhongID = @KhoaPhongID 
					where MaCanBoThucHien = @MaCanBoThucHien

				set @ResultString='UpdateOK'
				select @ResultString
				return
		END
		ELSE
		BEGIN
				set @ResultString=N'Không được cập nhật'
				select @ResultString
				return
		END
	END
	ELSE
	BEGIN
		if (@AllowAdd = 1)
		BEGIN
				insert into DANHMUC_CANBOTHUCHIEN(MaCanBoThucHien,HoTen,DiaChiCoQuan,DiaChiNhaRieng,DienThoai,Email,Fax,HocHamHocViID,ChucDanhKhoaHocID,ChucVuID,KhoaPhongID) values(@MaCanBoThucHien,@HoTen,@DiaChiCoQuan,@DiaChiNhaRieng,@DienThoai,@Email,@Fax,@HocHamHocViID,@ChucDanhKhoaHocID,@ChucVuID,@KhoaPhongID)
				set @ResultString='AddOK'
				select @ResultString
				return
		END
		ELSE
		BEGIN
			set @ResultString=N'Không được thêm mới'
			select @ResultString
			return
		END
	END
END
GO
PRINT N'Creating [dbo].[proc_Import_DanhMucChucDanhKhoaHoc]...';


GO
CREATE PROCEDURE [dbo].[proc_Import_DanhMucChucDanhKhoaHoc]
	@AllowAdd bit ,
	@AllowUpdate bit,
	@MaChucDanhKhoaHoc nvarchar(1000) ,
	@TenChucDanhKhoaHoc nvarchar(1000) ,
	@Active bit
as
BEGIN
declare @ResultString nvarchar(1000)
	IF EXISTS (SELECT MaChucDanhKhoaHoc FROM DANHMUC_CHUCDANHKHOAHOC NOLOCK WHERE MaChucDanhKhoaHoc = @MaChucDanhKhoaHoc) 
	BEGIN
		IF (@AllowUpdate = 1)
		BEGIN
			update DANHMUC_CHUCDANHKHOAHOC set TenChucDanhKhoaHoc = @TenChucDanhKhoaHoc,Active = @Active where MaChucDanhKhoaHoc = @MaChucDanhKhoaHoc
					set @ResultString='UpdateOK'
					select @ResultString
					return		
		END
		ELSE
		BEGIN
				set @ResultString=N'Không được cập nhật'
				select @ResultString
				return
		END
	END
	ELSE
	BEGIN
		if (@AllowAdd = 1)
		BEGIN
			insert into DANHMUC_CHUCDANHKHOAHOC(MaChucDanhKhoaHoc,TenChucDanhKhoaHoc,Active) values(@MaChucDanhKhoaHoc,@TenChucDanhKhoaHoc,@Active)
			set @ResultString='AddOK'
			select @ResultString
			return		
		END
		ELSE
		BEGIN
			set @ResultString=N'Không được thêm mới'
			select @ResultString
			return
		END
	END
	
END
GO
PRINT N'Creating [dbo].[proc_Import_DanhMucChucVu]...';


GO
CREATE PROCEDURE [dbo].[proc_Import_DanhMucChucVu]
	@AllowAdd bit ,
	@AllowUpdate bit,
	@MaChucVu nvarchar(1000) ,
	@TenChucVu nvarchar(1000) ,
	@Active bit
as
BEGIN
declare @ResultString nvarchar(1000)
	IF EXISTS (SELECT MaChucVu FROM DANHMUC_CHUCVU NOLOCK WHERE MaChucVu = @MaChucVu) 
	BEGIN
		IF (@AllowUpdate = 1)
		BEGIN

			update DANHMUC_CHUCVU set TenChucVu = @TenChucVu,Active = @Active where MaChucVu = @MaChucVu
					set @ResultString='UpdateOK'
					select @ResultString
					return			
		END
		ELSE
		BEGIN
				set @ResultString=N'Không được cập nhật'
				select @ResultString
				return
		END
	END
	ELSE
	BEGIN
		if (@AllowAdd = 1)
		BEGIN
			insert into DANHMUC_CHUCVU(MaChucVu,TenChucVu,Active) values(@MaChucVu,@TenChucVu,@Active)
			set @ResultString='AddOK'
			select @ResultString
			return		
		END
		ELSE
		BEGIN
			set @ResultString=N'Không được thêm mới'
			select @ResultString
			return
		END
	END
	
END
GO
PRINT N'Creating [dbo].[proc_Import_DanhMucHocHamHocVi]...';


GO
CREATE PROCEDURE [dbo].[proc_Import_DanhMucHocHamHocVi]
	@AllowAdd bit ,
	@AllowUpdate bit,
	@MaHocHamHocVi nvarchar(1000) ,
	@TenHocHamHocVi nvarchar(1000) ,
	@Active bit
as
BEGIN
declare @ResultString nvarchar(1000)
	IF EXISTS (SELECT MaHocHamHocVi FROM DANHMUC_HOCHAMHOCVI NOLOCK WHERE MaHocHamHocVi = @MaHocHamHocVi) 
	BEGIN
		IF (@AllowUpdate = 1)
		BEGIN
			update DANHMUC_HOCHAMHOCVI set TenHocHamHocVi = @TenHocHamHocVi,Active = @Active where MaHocHamHocVi = @MaHocHamHocVi
					set @ResultString='UpdateOK'
					select @ResultString
					return			
		END
		ELSE
		BEGIN
				set @ResultString=N'Không được cập nhật'
				select @ResultString
				return
		END
	END
	ELSE
	BEGIN
		if (@AllowAdd = 1)
		BEGIN
			insert into DANHMUC_HOCHAMHOCVI(MaHocHamHocVi,TenHocHamHocVi,Active) values(@MaHocHamHocVi,@TenHocHamHocVi,@Active)
			set @ResultString='AddOK'
			select @ResultString
			return		
		END
		ELSE
		BEGIN
			set @ResultString=N'Không được thêm mới'
			select @ResultString
			return
		END
	END
	
END
GO
PRINT N'Creating [dbo].[proc_Import_DanhMucKhoaPhong]...';


GO
CREATE PROCEDURE [dbo].[proc_Import_DanhMucKhoaPhong]
	@AllowAdd bit ,
	@AllowUpdate bit,
	@MaKhoaPhong nvarchar(1000) ,
	@TenKhoaPhong nvarchar(1000) ,
	@Active bit
as
BEGIN
declare @ResultString nvarchar(1000)
	IF EXISTS (SELECT MaKhoaPhong FROM DANHMUC_KHOAPHONG NOLOCK WHERE MaKhoaPhong = @MaKhoaPhong) 
	BEGIN
		IF (@AllowUpdate = 1)
		BEGIN
			update DANHMUC_KHOAPHONG set TenKhoaPhong = @TenKhoaPhong,Active = @Active where MaKhoaPhong = @MaKhoaPhong
					set @ResultString='UpdateOK'
					select @ResultString
					return			
		END
		ELSE
		BEGIN
				set @ResultString=N'Không được cập nhật'
				select @ResultString
				return
		END
	END
	ELSE
	BEGIN
		if (@AllowAdd = 1)
		BEGIN
			insert into DANHMUC_KHOAPHONG(MaKhoaPhong,TenKhoaPhong,Active) values(@MaKhoaPhong,@TenKhoaPhong,@Active)
			set @ResultString='AddOK'
			select @ResultString
			return			
		END
		ELSE
		BEGIN
			set @ResultString=N'Không được thêm mới'
			select @ResultString
			return
		END
	END
	
END
GO
PRINT N'Creating [dbo].[proc_Import_DanhMucKhoi]...';


GO
CREATE PROCEDURE [dbo].[proc_Import_DanhMucKhoi]
	@AllowAdd bit ,
	@AllowUpdate bit,
	@MaKhoi nvarchar(1000) ,
	@TenKhoi nvarchar(1000) ,
	@Active bit
as
BEGIN
declare @ResultString nvarchar(1000)
	IF EXISTS (SELECT MaKhoi FROM DANHMUC_KHOI NOLOCK WHERE MaKhoi = @MaKhoi) 
	BEGIN
		IF (@AllowUpdate = 1)
		BEGIN
			update DANHMUC_KHOI set TenKhoi = @TenKhoi,Active = @Active where MaKhoi = @MaKhoi
					set @ResultString='UpdateOK'
					select @ResultString
					return			
		END
		ELSE
		BEGIN
				set @ResultString=N'Không được cập nhật'
				select @ResultString
				return
		END
	END
	ELSE
	BEGIN
		if (@AllowAdd = 1)
		BEGIN		  
			insert into DANHMUC_KHOI(MaKhoi,TenKhoi,Active) values(@MaKhoi,@TenKhoi,@Active)
			set @ResultString='AddOK'
			select @ResultString
			return			
		END
		ELSE
		BEGIN
			set @ResultString=N'Không được thêm mới'
			select @ResultString
			return
		END
	END
	
END
GO
PRINT N'Creating [dbo].[proc_Import_DanhMucLoaiHoSo]...';


GO
CREATE PROCEDURE [dbo].[proc_Import_DanhMucLoaiHoSo]
	@AllowAdd bit ,
	@AllowUpdate bit,
	@MaLoaiHoSo nvarchar(1000) ,
	@TenLoaiHoSo nvarchar(1000) ,
	@Active bit
as
BEGIN
declare @ResultString nvarchar(1000)
	IF EXISTS (SELECT MaLoaiHoSo FROM DANHMUC_LOAIHOSO NOLOCK WHERE MaLoaiHoSo = @MaLoaiHoSo) 
	BEGIN
		IF (@AllowUpdate = 1)
		BEGIN			
		update DANHMUC_LOAIHOSO set TenLoaiHoSo = @TenLoaiHoSo,Active = @Active where MaLoaiHoSo = @MaLoaiHoSo
				set @ResultString='UpdateOK'
				select @ResultString
				return			
		END
		ELSE
		BEGIN
				set @ResultString=N'Không được cập nhật'
				select @ResultString
				return
		END
	END
	ELSE
	BEGIN
		if (@AllowAdd = 1)
		BEGIN
			insert into DANHMUC_LOAIHOSO(MaLoaiHoSo,TenLoaiHoSo,Active) values(@MaLoaiHoSo,@TenLoaiHoSo,@Active)
			set @ResultString='AddOK'
			select @ResultString
			return			
		END
		ELSE
		BEGIN
			set @ResultString=N'Không được thêm mới'
			select @ResultString
			return
		END
	END
	
END
GO
PRINT N'Creating [dbo].[proc_Import_DanhMucLoaiVanBanDinhKem]...';


GO
CREATE PROCEDURE [dbo].[proc_Import_DanhMucLoaiVanBanDinhKem]
	@AllowAdd bit ,
	@AllowUpdate bit,
	@MaVanBanDinhKem nvarchar(1000) ,
	@TenVanBanDinhKem nvarchar(1000) ,
	@LoaiQuyTrinh INT,
	@Form INT,
	@Active bit
AS
BEGIN
declare @ResultString nvarchar(1000)
	IF EXISTS (SELECT MaVanBanDinhKem FROM DANHMUC_LOAIVANBANDINHKEM NOLOCK WHERE MaVanBanDinhKem = @MaVanBanDinhKem) 
	BEGIN
		IF (@AllowUpdate = 1)
		BEGIN
		update DANHMUC_LOAIVANBANDINHKEM set TenVanBanDinhKem = @TenVanBanDinhKem,Form = @Form,LoaiQuyTrinh = @LoaiQuyTrinh,Active = @Active where MaVanBanDinhKem = @MaVanBanDinhKem
				set @ResultString='UpdateOK'
				select @ResultString
				return			
		END
		ELSE
		BEGIN
				set @ResultString=N'Không được cập nhật'
				select @ResultString
				return
		END
	END
	ELSE
	BEGIN
		if (@AllowAdd = 1)
		BEGIN
			insert into DANHMUC_LOAIVANBANDINHKEM(MaVanBanDinhKem,TenVanBanDinhKem,LoaiQuyTrinh,Form,Active) values(@MaVanBanDinhKem,@TenVanBanDinhKem,@LoaiQuyTrinh,@Form,@Active)
			set @ResultString='AddOK'
			select @ResultString
			return			
		END
		ELSE
		BEGIN
			set @ResultString=N'Không được thêm mới'
			select @ResultString
			return
		END
	END
END
GO
PRINT N'Creating [dbo].[proc_Import_DanhMucNguonKinhPhi]...';


GO
CREATE PROCEDURE [dbo].[proc_Import_DanhMucNguonKinhPhi]
	@AllowAdd bit ,
	@AllowUpdate bit,
	@MaNguonKinhPhi nvarchar(1000) ,
	@TenNguonKinhPhi nvarchar(1000) ,
	@Active bit
as
BEGIN
declare @ResultString nvarchar(1000)
	IF EXISTS (SELECT MaNguonKinhPhi FROM DANHMUC_NGUONKINHPHI NOLOCK WHERE MaNguonKinhPhi = @MaNguonKinhPhi) 
	BEGIN
		IF (@AllowUpdate = 1)
		BEGIN
		update DANHMUC_NGUONKINHPHI set TenNguonKinhPhi = @TenNguonKinhPhi,Active = @Active where MaNguonKinhPhi = @MaNguonKinhPhi
				set @ResultString='UpdateOK'
				select @ResultString
				return			
		END
		ELSE
		BEGIN
				set @ResultString=N'Không được cập nhật'
				select @ResultString
				return
		END
	END
	ELSE
	BEGIN
		if (@AllowAdd = 1)
		BEGIN		  
			insert into DANHMUC_NGUONKINHPHI(MaNguonKinhPhi,TenNguonKinhPhi,Active) values(@MaNguonKinhPhi,@TenNguonKinhPhi,@Active)
			set @ResultString='AddOK'
			select @ResultString
			return			
		END
		ELSE
		BEGIN
			set @ResultString=N'Không được thêm mới'
			select @ResultString
			return
		END
	END
	
END
GO
PRINT N'Creating [dbo].[proc_Import_DanhMucThanhVienHoiDongNhiemKy]...';


GO
CREATE PROCEDURE [dbo].[proc_Import_DanhMucThanhVienHoiDongNhiemKy]
	@AllowAdd bit,
	@AllowUpdate bit,
	@MaThanhVien nvarchar(1000),
	@TenThanhVien nvarchar(1000),
	@ThongTinLienLac nvarchar(1000),
	@ChucVuID int,
	@NoiCongTac nvarchar(1000),
	@NhiemVuTrongHD nvarchar(1000),
	@Active bit
	
AS
BEGIN
declare @ResultString nvarchar(1000)
	IF EXISTS (SELECT MaThanhVien FROM DANHMUC_HOIDONG_NHIEMKY_THANHVIEN NOLOCK WHERE MaThanhVien = @MaThanhVien) 
	BEGIN
		IF (@AllowUpdate = 1)
		BEGIN
				update DANHMUC_HOIDONG_NHIEMKY_THANHVIEN 
				set 
					TenThanhVien = @TenThanhVien,
					ThongTinLienLac = @ThongTinLienLac,
					ChucVuID = @ChucVuID,
					NoiCongTac = @NoiCongTac,
					NhiemVuTrongHD = @NhiemVuTrongHD,
					Active = @Active 
					where MaThanhVien = @MaThanhVien

				set @ResultString='UpdateOK'
				select @ResultString
				return
		END
		ELSE
		BEGIN
				set @ResultString=N'Không được cập nhật'
				select @ResultString
				return
		END
	END
	ELSE
	BEGIN
		if (@AllowAdd = 1)
		BEGIN
				insert into DANHMUC_HOIDONG_NHIEMKY_THANHVIEN(MaThanhVien,TenThanhVien,ThongTinLienLac,ChucVuID,NoiCongTac,NhiemVuTrongHD,Active) values(@MaThanhVien,@TenThanhVien,@ThongTinLienLac,@ChucVuID,@NoiCongTac,@NhiemVuTrongHD,@Active)
				set @ResultString='AddOK'
				select @ResultString
				return
		END
		ELSE
		BEGIN
			set @ResultString=N'Không được thêm mới'
			select @ResultString
			return
		END
	END
END
GO
PRINT N'Creating [dbo].[proc_Import_DanhMucTinhTrangDeTai]...';


GO
CREATE PROCEDURE [dbo].[proc_Import_DanhMucTinhTrangDeTai]
	@AllowAdd bit ,
	@AllowUpdate bit,
	@MaTinhTrangDeTai nvarchar(1000) ,
	@TenTinhTrangDeTai nvarchar(1000) ,
	@Active bit
as
BEGIN
declare @ResultString nvarchar(1000)
	IF EXISTS (SELECT MaTinhTrangDeTai FROM DANHMUC_TINHTRANGDETAI NOLOCK WHERE MaTinhTrangDeTai = @MaTinhTrangDeTai) 
	BEGIN
		IF (@AllowUpdate = 1)
		BEGIN
			update DANHMUC_TINHTRANGDETAI set TenTinhTrangDeTai = @TenTinhTrangDeTai,Active = @Active where MaTinhTrangDeTai = @MaTinhTrangDeTai
					set @ResultString='UpdateOK'
					select @ResultString
					return
		END
		ELSE
		BEGIN
				set @ResultString=N'Không được cập nhật'
				select @ResultString
				return
		END
	END
	ELSE
	BEGIN
		if (@AllowAdd = 1)
		BEGIN
			insert into DANHMUC_TINHTRANGDETAI(MaTinhTrangDeTai,TenTinhTrangDeTai,Active) values(@MaTinhTrangDeTai,@TenTinhTrangDeTai,@Active)
			set @ResultString='AddOK'
			select @ResultString
			return			
		END
		ELSE
		BEGIN
			set @ResultString=N'Không được thêm mới'
			select @ResultString
			return
		END
	END
	
END
GO
PRINT N'Creating [dbo].[proc_ImportDDM_TINHTRANGHOPTACQUOCTE]...';


GO
----Import danh muc DM_TINHTRANGHOPTACQUOCTE
CREATE PROC proc_ImportDDM_TINHTRANGHOPTACQUOCTE
    @AllowAdd bit ,
	@AllowUpdate bit,
	@MaTinhTrangHopTacQuocTe nvarchar(1000) ,
	@TenTinhTrangHopTacQuocTe nvarchar(1000) ,
	@Active bit
as
BEGIN
declare @ResultString nvarchar(1000)
	IF EXISTS (SELECT MaTinhTrangHopTacQuocTe FROM DM_TINHTRANGHOPTACQUOCTE NOLOCK WHERE MaTinhTrangHopTacQuocTe = @MaTinhTrangHopTacQuocTe) 
	BEGIN
		IF (@AllowUpdate = 1)
		BEGIN
			 IF NOT EXISTS (SELECT MaTinhTrangHopTacQuocTe FROM DM_TINHTRANGHOPTACQUOCTE WHERE TenTinhTrangHopTacQuocTe=@TenTinhTrangHopTacQuocTe AND MaTinhTrangHopTacQuocTe<>@MaTinhTrangHopTacQuocTe)
			 BEGIN
				update DM_TINHTRANGHOPTACQUOCTE set MaTinhTrangHopTacQuocTe = @MaTinhTrangHopTacQuocTe,TenTinhTrangHopTacQuocTe = @TenTinhTrangHopTacQuocTe,Active = @Active where MaTinhTrangHopTacQuocTe = @MaTinhTrangHopTacQuocTe
						set @ResultString='UpdateOK'
						select @ResultString
						return
			END
			ELSE
			BEGIN
				set @ResultString=N'TenTinhTrangHopTacQuocTe đã tồn tại'
				select @ResultString
				return
			END
		END
		ELSE
		BEGIN
				set @ResultString=N'Không được cập nhật'
				select @ResultString
				return
		END
	END
	ELSE
	BEGIN
		if (@AllowAdd = 1)
		BEGIN
		    IF NOT EXISTS (SELECT MaTinhTrangHopTacQuocTe FROM DM_TINHTRANGHOPTACQUOCTE WHERE TenTinhTrangHopTacQuocTe=@TenTinhTrangHopTacQuocTe)
			 BEGIN
					insert into DM_TINHTRANGHOPTACQUOCTE(MaTinhTrangHopTacQuocTe,TenTinhTrangHopTacQuocTe,Active) values(@MaTinhTrangHopTacQuocTe,@TenTinhTrangHopTacQuocTe,@Active)
					set @ResultString='AddOK'
					select @ResultString
					return
			END
		ELSE
		BEGIN
				set @ResultString=N'TenTinhTrangHopTacQuocTe đã tồn tại'
				select @ResultString
				return
		END
		END
		ELSE
		BEGIN
			set @ResultString=N'Không được thêm mới'
			select @ResultString
			return
		END
	END
	
END
GO
PRINT N'Creating [dbo].[proc_ImportDM_CapQuanLy]...';


GO
----Import danh muc cap quan ly
CREATE PROC proc_ImportDM_CapQuanLy
    @AllowAdd bit ,
	@AllowUpdate bit,
	@MaCapQuanLy nvarchar(1000) ,
	@TenCapQuanLy nvarchar(1000) ,
	@Active bit
as
BEGIN
declare @ResultString nvarchar(1000)
	IF EXISTS (SELECT MaCapQuanLy FROM DM_CAPQUANLY NOLOCK WHERE MaCapQuanLy = @MaCapQuanLy) 
	BEGIN
		IF (@AllowUpdate = 1)
		BEGIN
			 IF NOT EXISTS (SELECT MaCapQuanLy FROM DM_CAPQUANLY WHERE TenCapQuanLy=@TenCapQuanLy AND MaCapQuanLy<>@MaCapQuanLy)
			 BEGIN
				update DM_CAPQUANLY set MaCapQuanLy = @MaCapQuanLy,TenCapQuanLy = @TenCapQuanLy,Active = @Active where MaCapQuanLy = @MaCapQuanLy
						set @ResultString='UpdateOK'
						select @ResultString
						return
			END
			ELSE
			BEGIN
				set @ResultString=N'Tên đã tồn tại'
				select @ResultString
				return
			END
		END
		ELSE
		BEGIN
				set @ResultString=N'Không được cập nhật'
				select @ResultString
				return
		END
	END
	ELSE
	BEGIN
		if (@AllowAdd = 1)
		BEGIN
		    IF NOT EXISTS (SELECT MaCapQuanLy FROM DM_CAPQUANLY WHERE TenCapQuanLy=@TenCapQuanLy )
			 BEGIN
					insert into DM_CAPQUANLY(MaCapQuanLy,TenCapQuanLy,Active) values(@MaCapQuanLy,@TenCapQuanLy,@Active)
					set @ResultString='AddOK'
					select @ResultString
					return
			END
		ELSE
		BEGIN
				set @ResultString=N'Tên đã tồn tại'
				select @ResultString
				return
		END
		END
		ELSE
		BEGIN
			set @ResultString=N'Không được thêm mới'
			select @ResultString
			return
		END
	END
	
END
GO
PRINT N'Creating [dbo].[proc_ImportDM_CHUCDANHKHOAHOC]...';


GO
----Import danh muc DM_CHUCDANHKHOAHOC
CREATE PROC proc_ImportDM_CHUCDANHKHOAHOC
    @AllowAdd bit ,
	@AllowUpdate bit,
	@MaKetQuaDuKien nvarchar(1000) ,
	@TenKetQuaDuKien nvarchar(1000) ,
	@Active bit,
	@Loai NVARCHAR(4)
as
BEGIN
	declare @ResultString nvarchar(1000)
	IF(ISNUMERIC(@loai)=0)
	BEGIN
		set @ResultString=N'Loai phải là số'
		select @ResultString
		return
	END
	--------------
	IF EXISTS (SELECT MaKetQuaDuKien FROM DM_KETQUADUKIEN NOLOCK WHERE MaKetQuaDuKien = @MaKetQuaDuKien) 
	BEGIN
		IF (@AllowUpdate = 1)
		BEGIN
			 IF NOT EXISTS (SELECT MaKetQuaDuKien FROM DM_KETQUADUKIEN WHERE TenKetQuaDuKien=@TenKetQuaDuKien AND MaKetQuaDuKien<>@MaKetQuaDuKien)
			 BEGIN
				update DM_KETQUADUKIEN set MaKetQuaDuKien = @MaKetQuaDuKien,TenKetQuaDuKien = @TenKetQuaDuKien,Active = @Active,Loai=@Loai where MaKetQuaDuKien = @MaKetQuaDuKien
						set @ResultString='UpdateOK'
						select @ResultString
						return
			END
			ELSE
			BEGIN
				set @ResultString=N'TenKetQuaDuKien đã tồn tại'
				select @ResultString
				return
			END
		END
		ELSE
		BEGIN
				set @ResultString=N'Không được cập nhật'
				select @ResultString
				return
		END
	END
	ELSE
	BEGIN
		if (@AllowAdd = 1)
		BEGIN
		    IF NOT EXISTS (SELECT MaKetQuaDuKien FROM DM_KETQUADUKIEN WHERE TenKetQuaDuKien=@TenKetQuaDuKien)
			 BEGIN
					insert into DM_KETQUADUKIEN(MaKetQuaDuKien,TenKetQuaDuKien,Active,Loai) values(@MaKetQuaDuKien,@TenKetQuaDuKien,@Active,@Loai)
					set @ResultString='AddOK'
					select @ResultString
					return
			END
		ELSE
		BEGIN
				set @ResultString=N'TenKetQuaDuKien đã tồn tại'
				select @ResultString
				return
		END
		END
		ELSE
		BEGIN
			set @ResultString=N'Không được thêm mới'
			select @ResultString
			return
		END
	END
	
END
GO
PRINT N'Creating [dbo].[proc_ImportDM_DIEUKIEN]...';


GO
----Import danh muc DM_DIEUKIEN
CREATE PROC proc_ImportDM_DIEUKIEN
    @AllowAdd bit ,
	@AllowUpdate bit,
	@MaDieuKien nvarchar(1000) ,
	@TenDieuKien nvarchar(1000) ,
	@Active bit
as
BEGIN
declare @ResultString nvarchar(1000)
	IF EXISTS (SELECT MaDieuKien FROM DM_DIEUKIEN NOLOCK WHERE MaDieuKien = @MaDieuKien) 
	BEGIN
		IF (@AllowUpdate = 1)
		BEGIN
			 IF NOT EXISTS (SELECT MaDieuKien FROM DM_DIEUKIEN WHERE TenDieuKien=@TenDieuKien AND MaDieuKien<>@MaDieuKien)
			 BEGIN
				update DM_DIEUKIEN set MaDieuKien = @MaDieuKien,TenDieuKien = @TenDieuKien,Active = @Active where MaDieuKien = @MaDieuKien
						set @ResultString='UpdateOK'
						select @ResultString
						return
			END
			ELSE
			BEGIN
				set @ResultString=N'TenDieuKien đã tồn tại'
				select @ResultString
				return
			END
		END
		ELSE
		BEGIN
				set @ResultString=N'Không được cập nhật'
				select @ResultString
				return
		END
	END
	ELSE
	BEGIN
		if (@AllowAdd = 1)
		BEGIN
		    IF NOT EXISTS (SELECT MaDieuKien FROM DM_DIEUKIEN WHERE TenDieuKien=@TenDieuKien )
			 BEGIN
					insert into DM_DIEUKIEN(MaDieuKien,TenDieuKien,Active) values(@MaDieuKien,@TenDieuKien,@Active)
					set @ResultString='AddOK'
					select @ResultString
					return
			END
		ELSE
		BEGIN
				set @ResultString=N'TenDieuKien đã tồn tại'
				select @ResultString
				return
		END
		END
		ELSE
		BEGIN
			set @ResultString=N'Không được thêm mới'
			select @ResultString
			return
		END
	END
	
END
GO
PRINT N'Creating [dbo].[proc_ImportDM_DONVIBANHANH]...';


GO
----Import danh muc DM_DONVIBANHANH
CREATE PROC proc_ImportDM_DONVIBANHANH
    @AllowAdd bit ,
	@AllowUpdate bit,
	@MaDonViBanHanh nvarchar(1000) ,
	@TenDonViBanHanh nvarchar(1000) ,
	@Active bit
as
BEGIN
declare @ResultString nvarchar(1000)
	IF EXISTS (SELECT MaDonViBanHanh FROM DM_DONVIBANHANH NOLOCK WHERE MaDonViBanHanh = @MaDonViBanHanh) 
	BEGIN
		IF (@AllowUpdate = 1)
		BEGIN
			 IF NOT EXISTS (SELECT MaDonViBanHanh FROM DM_DONVIBANHANH WHERE TenDonViBanHanh=@TenDonViBanHanh AND MaDonViBanHanh<>@MaDonViBanHanh)
			 BEGIN
				update DM_DONVIBANHANH set MaDonViBanHanh = @MaDonViBanHanh,TenDonViBanHanh = @TenDonViBanHanh,Active = @Active where MaDonViBanHanh = @MaDonViBanHanh
						set @ResultString='UpdateOK'
						select @ResultString
						return
			END
			ELSE
			BEGIN
				set @ResultString=N'TenDonViBanHanh đã tồn tại'
				select @ResultString
				return
			END
		END
		ELSE
		BEGIN
				set @ResultString=N'Không được cập nhật'
				select @ResultString
				return
		END
	END
	ELSE
	BEGIN
		if (@AllowAdd = 1)
		BEGIN
		    IF NOT EXISTS (SELECT MaDonViBanHanh FROM DM_DONVIBANHANH WHERE TenDonViBanHanh=@TenDonViBanHanh )
			 BEGIN
					insert into DM_DONVIBANHANH(MaDonViBanHanh,TenDonViBanHanh,Active) values(@MaDonViBanHanh,@TenDonViBanHanh,@Active)
					set @ResultString='AddOK'
					select @ResultString
					return
			END
		ELSE
		BEGIN
				set @ResultString=N'TenDonViBanHanh đã tồn tại'
				select @ResultString
				return
		END
		END
		ELSE
		BEGIN
			set @ResultString=N'Không được thêm mới'
			select @ResultString
			return
		END
	END
	
END
GO
PRINT N'Creating [dbo].[proc_ImportDM_DONVIDO]...';


GO
----Import danh muc DM_DONVIDO
CREATE PROC proc_ImportDM_DONVIDO
    @AllowAdd bit ,
	@AllowUpdate bit,
	@MaDonViDo nvarchar(1000) ,
	@TenDonViDo nvarchar(1000) ,
	@Active bit
as
BEGIN
declare @ResultString nvarchar(1000)
	IF EXISTS (SELECT MaDonViDo FROM DM_DONVIDO NOLOCK WHERE MaDonViDo = @MaDonViDo) 
	BEGIN
		IF (@AllowUpdate = 1)
		BEGIN
			 IF NOT EXISTS (SELECT MaDonViDo FROM DM_DONVIDO WHERE TenDonViDo=@TenDonViDo AND MaDonViDo<>@MaDonViDo)
			 BEGIN
				update DM_DONVIDO set MaDonViDo = @MaDonViDo,TenDonViDo = @TenDonViDo,Active = @Active where MaDonViDo = @MaDonViDo
						set @ResultString='UpdateOK'
						select @ResultString
						return
			END
			ELSE
			BEGIN
				set @ResultString=N'TenDonViDo đã tồn tại'
				select @ResultString
				return
			END
		END
		ELSE
		BEGIN
				set @ResultString=N'Không được cập nhật'
				select @ResultString
				return
		END
	END
	ELSE
	BEGIN
		if (@AllowAdd = 1)
		BEGIN
		    IF NOT EXISTS (SELECT MaDonViDo FROM DM_DONVIDO WHERE TenDonViDo=@TenDonViDo )
			 BEGIN
					insert into DM_DONVIDO(MaDonViDo,TenDonViDo,Active) values(@MaDonViDo,@TenDonViDo,@Active)
					set @ResultString='AddOK'
					select @ResultString
					return
			END
		ELSE
		BEGIN
				set @ResultString=N'TenDonViDo đã tồn tại'
				select @ResultString
				return
		END
		END
		ELSE
		BEGIN
			set @ResultString=N'Không được thêm mới'
			select @ResultString
			return
		END
	END
	
END
GO
PRINT N'Creating [dbo].[proc_ImportDM_HOCHAMHOCVI]...';


GO
----Import danh muc DM_HOCHAMHOCVI
CREATE PROC proc_ImportDM_HOCHAMHOCVI
    @AllowAdd bit ,
	@AllowUpdate bit,
	@MaHocHamHocVi nvarchar(1000) ,
	@TenHocHamHocVi nvarchar(1000) ,
	@Active bit
as
BEGIN
declare @ResultString nvarchar(1000)
	IF EXISTS (SELECT MaHocHamHocVi FROM DM_HOCHAMHOCVI NOLOCK WHERE MaHocHamHocVi = @MaHocHamHocVi) 
	BEGIN
		IF (@AllowUpdate = 1)
		BEGIN
			 IF NOT EXISTS (SELECT MaHocHamHocVi FROM DM_HOCHAMHOCVI WHERE TenHocHamHocVi=@TenHocHamHocVi AND MaHocHamHocVi<>@MaHocHamHocVi)
			 BEGIN
				update DM_HOCHAMHOCVI set MaHocHamHocVi = @MaHocHamHocVi,TenHocHamHocVi = @TenHocHamHocVi,Active = @Active where MaHocHamHocVi = @MaHocHamHocVi
						set @ResultString='UpdateOK'
						select @ResultString
						return
			END
			ELSE
			BEGIN
				set @ResultString=N'TenHocHamHocVi đã tồn tại'
				select @ResultString
				return
			END
		END
		ELSE
		BEGIN
				set @ResultString=N'Không được cập nhật'
				select @ResultString
				return
		END
	END
	ELSE
	BEGIN
		if (@AllowAdd = 1)
		BEGIN
		    IF NOT EXISTS (SELECT MaHocHamHocVi FROM DM_HOCHAMHOCVI WHERE TenHocHamHocVi=@TenHocHamHocVi)
			 BEGIN
					insert into DM_HOCHAMHOCVI(MaHocHamHocVi,TenHocHamHocVi,Active) values(@MaHocHamHocVi,@TenHocHamHocVi,@Active)
					set @ResultString='AddOK'
					select @ResultString
					return
			END
		ELSE
		BEGIN
				set @ResultString=N'TenHocHamHocVi đã tồn tại'
				select @ResultString
				return
		END
		END
		ELSE
		BEGIN
			set @ResultString=N'Không được thêm mới'
			select @ResultString
			return
		END
	END
	
END
GO
PRINT N'Creating [dbo].[proc_ImportDM_KETQUADUKIEN]...';


GO
----Import danh muc DM_KETQUADUKIEN
CREATE PROC proc_ImportDM_KETQUADUKIEN
   @AllowAdd bit ,
	@AllowUpdate bit,
	@MaKetQuaDuKien nvarchar(1000) ,
	@TenKetQuaDuKien nvarchar(1000) ,
	@Active bit,
	@Loai NVARCHAR(4)
as
BEGIN
	declare @ResultString nvarchar(1000)
	IF(ISNUMERIC(@Loai + '.0e0')=0 OR (ISNUMERIC(@Loai + '.0e0')=1 AND CAST(@Loai AS INT)>3))
	BEGIN
		set @ResultString=N'Loai phải là số nguyên từ 1 đến 3'
		select @ResultString
		return
	END
	
	--------------
	IF EXISTS (SELECT MaKetQuaDuKien FROM DM_KETQUADUKIEN NOLOCK WHERE MaKetQuaDuKien = @MaKetQuaDuKien) 
	BEGIN
		IF (@AllowUpdate = 1)
		BEGIN
			 IF NOT EXISTS (SELECT MaKetQuaDuKien FROM DM_KETQUADUKIEN WHERE TenKetQuaDuKien=@TenKetQuaDuKien AND MaKetQuaDuKien<>@MaKetQuaDuKien)
			 BEGIN
				update DM_KETQUADUKIEN set MaKetQuaDuKien = @MaKetQuaDuKien,TenKetQuaDuKien = @TenKetQuaDuKien,Active = @Active,Loai=@Loai where MaKetQuaDuKien = @MaKetQuaDuKien
						set @ResultString='UpdateOK'
						select @ResultString
						return
			END
			ELSE
			BEGIN
				set @ResultString=N'TenKetQuaDuKien đã tồn tại'
				select @ResultString
				return
			END
		END
		ELSE
		BEGIN
				set @ResultString=N'Không được cập nhật'
				select @ResultString
				return
		END
	END
	ELSE
	BEGIN
		if (@AllowAdd = 1)
		BEGIN
		    IF NOT EXISTS (SELECT MaKetQuaDuKien FROM DM_KETQUADUKIEN WHERE TenKetQuaDuKien=@TenKetQuaDuKien)
			 BEGIN
					insert into DM_KETQUADUKIEN(MaKetQuaDuKien,TenKetQuaDuKien,Active,Loai) values(@MaKetQuaDuKien,@TenKetQuaDuKien,@Active,@Loai)
					set @ResultString='AddOK'
					select @ResultString
					return
			END
		ELSE
		BEGIN
				set @ResultString=N'TenKetQuaDuKien đã tồn tại'
				select @ResultString
				return
		END
		END
		ELSE
		BEGIN
			set @ResultString=N'Không được thêm mới'
			select @ResultString
			return
		END
	END
	
END
GO
PRINT N'Creating [dbo].[proc_ImportDM_NOIDUNGKINHPHI]...';


GO
----Import danh muc DM_NOIDUNGKINHPHI
CREATE PROC proc_ImportDM_NOIDUNGKINHPHI
    @AllowAdd bit ,
	@AllowUpdate bit,
	@MaNoiDungKinhPhi nvarchar(1000) ,
	@TenNoiDungKinhPhi nvarchar(1000) ,
	@Active bit
as
BEGIN
declare @ResultString nvarchar(1000)
	IF EXISTS (SELECT MaNoiDungKinhPhi FROM DM_NOIDUNGKINHPHI NOLOCK WHERE MaNoiDungKinhPhi = @MaNoiDungKinhPhi) 
	BEGIN
		IF (@AllowUpdate = 1)
		BEGIN
			 IF NOT EXISTS (SELECT MaNoiDungKinhPhi FROM DM_NOIDUNGKINHPHI WHERE TenNoiDungKinhPhi=@TenNoiDungKinhPhi AND MaNoiDungKinhPhi<>@MaNoiDungKinhPhi)
			 BEGIN
				update DM_NOIDUNGKINHPHI set MaNoiDungKinhPhi = @MaNoiDungKinhPhi,TenNoiDungKinhPhi = @TenNoiDungKinhPhi,Active = @Active where MaNoiDungKinhPhi = @MaNoiDungKinhPhi
						set @ResultString='UpdateOK'
						select @ResultString
						return
			END
			ELSE
			BEGIN
				set @ResultString=N'TenNoiDungKinhPhi đã tồn tại'
				select @ResultString
				return
			END
		END
		ELSE
		BEGIN
				set @ResultString=N'Không được cập nhật'
				select @ResultString
				return
		END
	END
	ELSE
	BEGIN
		if (@AllowAdd = 1)
		BEGIN
		    IF NOT EXISTS (SELECT MaNoiDungKinhPhi FROM DM_NOIDUNGKINHPHI WHERE TenNoiDungKinhPhi=@TenNoiDungKinhPhi)
			 BEGIN
					insert into DM_NOIDUNGKINHPHI(MaNoiDungKinhPhi,TenNoiDungKinhPhi,Active) values(@MaNoiDungKinhPhi,@TenNoiDungKinhPhi,@Active)
					set @ResultString='AddOK'
					select @ResultString
					return
			END
		ELSE
		BEGIN
				set @ResultString=N'TenNoiDungKinhPhi đã tồn tại'
				select @ResultString
				return
		END
		END
		ELSE
		BEGIN
			set @ResultString=N'Không được thêm mới'
			select @ResultString
			return
		END
	END
	
END
GO
PRINT N'Creating [dbo].[proc_ImportDM_TINHKHOAHOC]...';


GO
----Import danh muc DM_TINHKHOAHOC
CREATE PROC proc_ImportDM_TINHKHOAHOC
    @AllowAdd bit ,
	@AllowUpdate bit,
	@MaTinhKhoaHoc nvarchar(1000) ,
	@TenTinhKhoaHoc nvarchar(1000) ,
	@Active bit
as
BEGIN
declare @ResultString nvarchar(1000)
	IF EXISTS (SELECT MaTinhKhoaHoc FROM DM_TINHKHOAHOC NOLOCK WHERE MaTinhKhoaHoc = @MaTinhKhoaHoc) 
	BEGIN
		IF (@AllowUpdate = 1)
		BEGIN
			 IF NOT EXISTS (SELECT MaTinhKhoaHoc FROM DM_TINHKHOAHOC WHERE TenTinhKhoaHoc=@TenTinhKhoaHoc AND MaTinhKhoaHoc<>@MaTinhKhoaHoc)
			 BEGIN
				update DM_TINHKHOAHOC set MaTinhKhoaHoc = @MaTinhKhoaHoc,TenTinhKhoaHoc = @TenTinhKhoaHoc,Active = @Active where MaTinhKhoaHoc = @MaTinhKhoaHoc
						set @ResultString='UpdateOK'
						select @ResultString
						return
			END
			ELSE
			BEGIN
				set @ResultString=N'TenTinhKhoaHoc đã tồn tại'
				select @ResultString
				return
			END
		END
		ELSE
		BEGIN
				set @ResultString=N'Không được cập nhật'
				select @ResultString
				return
		END
	END
	ELSE
	BEGIN
		if (@AllowAdd = 1)
		BEGIN
		    IF NOT EXISTS (SELECT MaTinhKhoaHoc FROM DM_TINHKHOAHOC WHERE TenTinhKhoaHoc=@TenTinhKhoaHoc )
			 BEGIN
					insert into DM_TINHKHOAHOC(MaTinhKhoaHoc,TenTinhKhoaHoc,Active) values(@MaTinhKhoaHoc,@TenTinhKhoaHoc,@Active)
					set @ResultString='AddOK'
					select @ResultString
					return
			END
		ELSE
		BEGIN
				set @ResultString=N'TenTinhKhoaHoc đã tồn tại'
				select @ResultString
				return
		END
		END
		ELSE
		BEGIN
			set @ResultString=N'Không được thêm mới'
			select @ResultString
			return
		END
	END
	
END
GO
PRINT N'Creating [dbo].[proc_ImportDM_TINHTRANGDETAI]...';


GO
---Import danh muc DM_TINHTRANGDETAI
CREATE PROC proc_ImportDM_TINHTRANGDETAI
    @AllowAdd bit ,
	@AllowUpdate bit,
	@MaTinhTrangDeTai nvarchar(1000) ,
	@TenTinhTrangDeTai nvarchar(1000) ,
	@Active bit
as
BEGIN
declare @ResultString nvarchar(1000)
	IF EXISTS (SELECT MaTinhTrangDeTai FROM DM_TINHTRANGDETAI NOLOCK WHERE MaTinhTrangDeTai = @MaTinhTrangDeTai) 
	BEGIN
		IF (@AllowUpdate = 1)
		BEGIN
			 IF NOT EXISTS (SELECT MaTinhTrangDeTai FROM DM_TINHTRANGDETAI WHERE TenTinhTrangDeTai=@TenTinhTrangDeTai AND MaTinhTrangDeTai<>@MaTinhTrangDeTai)
			 BEGIN
				update DM_TINHTRANGDETAI set MaTinhTrangDeTai = @MaTinhTrangDeTai,TenTinhTrangDeTai = @TenTinhTrangDeTai,Active = @Active where MaTinhTrangDeTai = @MaTinhTrangDeTai
						set @ResultString='UpdateOK'
						select @ResultString
						return
			END
			ELSE
			BEGIN
				set @ResultString=N'TenTinhTrangDeTai đã tồn tại'
				select @ResultString
				return
			END
		END
		ELSE
		BEGIN
				set @ResultString=N'Không được cập nhật'
				select @ResultString
				return
		END
	END
	ELSE
	BEGIN
		if (@AllowAdd = 1)
		BEGIN
		    IF NOT EXISTS (SELECT MaTinhTrangDeTai FROM DM_TINHTRANGDETAI WHERE TenTinhTrangDeTai=@TenTinhTrangDeTai )
			 BEGIN
					insert into DM_TINHTRANGDETAI(MaTinhTrangDeTai,TenTinhTrangDeTai,Active) values(@MaTinhTrangDeTai,@TenTinhTrangDeTai,@Active)
					set @ResultString='AddOK'
					select @ResultString
					return
			END
		ELSE
		BEGIN
				set @ResultString=N'TenTinhTrangDeTai đã tồn tại'
				select @ResultString
				return
		END
		END
		ELSE
		BEGIN
			set @ResultString=N'Không được thêm mới'
			select @ResultString
			return
		END
	END
	
END
GO
PRINT N'Creating [dbo].[proc_ImportDMChucNang]...';


GO
CREATE PROCEDURE [dbo].[proc_ImportDMChucNang]
  @AllowAdd bit ,
  @AllowUpdate bit,
  @MaChucNang NVARCHAR(100),
  @LienKet NVARCHAR(50),
  @NhomChucNang NVARCHAR(20),
  @MoTa NVARCHAR(100)
AS 
--(ThongKe = 2,GiamDinh = 3,BaoCao = 4,DanhMuc = 5,QuanTri = 6,TienIch = 7)
BEGIN
	declare @ResultString nvarchar(1000)
	IF(@NhomChucNang not in('2','4','5','6','7'))
	BEGIN
		set @ResultString=N'NhomChucNang không đúng quy định số'
		select @ResultString
		return
	END
	IF EXISTS (SELECT FunctionCode FROM [Function] NOLOCK WHERE FunctionCode = @MaChucNang) 
	BEGIN
		IF (@AllowUpdate = 1)
		BEGIN
			update [Function] 
			set FunctionLink = @LienKet, FunctionGroup = @NhomChucNang, [Description] = @MoTa, [Operator] = 0  
			where FunctionCode = @MaChucNang
			set @ResultString = 'UpdateOK'
			select @ResultString
			return
		END
		ELSE
		BEGIN
			set @ResultString = N'Không được cập nhật'
			select @ResultString
			return
		END
	END
	ELSE
	BEGIN
		if (@AllowAdd = 1)
		BEGIN
			insert into [Function](FunctionCode, FunctionLink, FunctionGroup, [Description], [Operator]) values(@MaChucNang, @LienKet, @NhomChucNang, @MoTa, 0)
			set @ResultString = 'AddOK'
			select @ResultString
			return
		END
		ELSE
		BEGIN
			set @ResultString = N'Không được thêm mới'
			select @ResultString
			return
		END
	END
	
END
GO
PRINT N'Creating [dbo].[proc_PhieuDanhGiaKetQuaDeTai_FullTextIndexSearch]...';


GO
CREATE PROCEDURE [dbo].[proc_PhieuDanhGiaKetQuaDeTai_FullTextIndexSearch]
	@TenDeTai nvarchar(1000),
	@ChuNhiemDeTai nvarchar(1000),
	@HoTen nvarchar(1000),
	@XepLoai int,
	@UserId int
AS
BEGIN
	SET NOCOUNT ON;

	IF @TenDeTai IS NOT NULL
		IF @XepLoai = 0
			SELECT KQ.KetQuaDeTaiID,DT.TenDeTai,DT.CNDT_HoTen AS ChuNhiemDeTai,DT.ThucHienTuNgay,DT.ThucHienDenNgay,KQ.HoTenChuyenGia,KQ.XepLoai
			FROM  DETAI DT 	INNER JOIN FREETEXTTABLE(DETAI,TenDeTai,@TenDeTai) as FTS_DT ON DT.DeTaiID = FTS_DT.[KEY]	
			INNER JOIN KETQUADETAI KQ ON KQ.PDG_DeTaiID = DT.DeTaiID
			WHERE (UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%'+UPPER(LTRIM(RTRIM(@ChuNhiemDeTai)))+'%' OR @ChuNhiemDeTai IS NULL)
			AND (UPPER(LTRIM(RTRIM(KQ.HoTenChuyenGia))) LIKE '%'+UPPER(LTRIM(RTRIM(@HoTen)))+'%' OR @HoTen IS NULL)
			AND (DT.UserId = @UserId OR @UserId IS NULL)
		ELSE
			SELECT KQ.KetQuaDeTaiID,DT.TenDeTai,DT.CNDT_HoTen AS ChuNhiemDeTai,DT.ThucHienTuNgay,DT.ThucHienDenNgay,KQ.HoTenChuyenGia,KQ.XepLoai
			FROM  DETAI DT 	INNER JOIN FREETEXTTABLE(DETAI,TenDeTai,@TenDeTai) as FTS_DT ON DT.DeTaiID = FTS_DT.[KEY]	
			INNER JOIN KETQUADETAI KQ ON KQ.PDG_DeTaiID = DT.DeTaiID
			WHERE (UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%'+UPPER(LTRIM(RTRIM(@ChuNhiemDeTai)))+'%' OR @ChuNhiemDeTai IS NULL)
			AND (UPPER(LTRIM(RTRIM(KQ.HoTenChuyenGia))) LIKE '%'+UPPER(LTRIM(RTRIM(@HoTen)))+'%' OR @HoTen IS NULL)
			AND (KQ.XepLoai = @XepLoai OR @XepLoai IS NULL)
			AND (DT.UserId = @UserId OR @UserId IS NULL)
	ELSE
	BEGIN
		IF @XepLoai = 0
			SELECT KQ.KetQuaDeTaiID,DT.TenDeTai,DT.CNDT_HoTen AS ChuNhiemDeTai,DT.ThucHienTuNgay,DT.ThucHienDenNgay,KQ.HoTenChuyenGia,KQ.XepLoai
			FROM  DETAI DT 
			INNER JOIN KETQUADETAI KQ ON KQ.PDG_DeTaiID = DT.DeTaiID
			WHERE (UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%'+UPPER(LTRIM(RTRIM(@ChuNhiemDeTai)))+'%' OR @ChuNhiemDeTai IS NULL)
			AND (UPPER(LTRIM(RTRIM(KQ.HoTenChuyenGia))) LIKE '%'+UPPER(LTRIM(RTRIM(@HoTen)))+'%' OR @HoTen IS NULL)
			AND (DT.UserId = @UserId OR @UserId IS NULL)
		ELSE
			SELECT KQ.KetQuaDeTaiID,DT.TenDeTai,DT.CNDT_HoTen AS ChuNhiemDeTai,DT.ThucHienTuNgay,DT.ThucHienDenNgay,KQ.HoTenChuyenGia,KQ.XepLoai
			FROM  DETAI DT 
			INNER JOIN KETQUADETAI KQ ON KQ.PDG_DeTaiID = DT.DeTaiID
			WHERE (UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%'+UPPER(LTRIM(RTRIM(@ChuNhiemDeTai)))+'%' OR @ChuNhiemDeTai IS NULL)
			AND (UPPER(LTRIM(RTRIM(KQ.HoTenChuyenGia))) LIKE '%'+UPPER(LTRIM(RTRIM(@HoTen)))+'%' OR @HoTen IS NULL)
			AND (KQ.XepLoai = @XepLoai OR @XepLoai IS NULL)
			AND (DT.UserId = @UserId OR @UserId IS NULL)
	END

END
GO
PRINT N'Creating [dbo].[proc_Print_BanNhanXetKetQuaNghienCuu]...';


GO
CREATE PROCEDURE [dbo].[proc_Print_BanNhanXetKetQuaNghienCuu]
	@ID int
	--ID: KetQuaNghienCuuID
AS
BEGIN

	SET NOCOUNT ON;

	SELECT
		DT.TenDeTai,DT.MaSoDeTai,DT.CNDT_HoTen,CQL.TenCapQuanLy,
		DT.ThucHienTuNgay,DT.ThucHienDenNgay,DT.KinhPhi,
		HD.SoQuyetDinh,HD.NgayQuyetDinh,DVBH.TenDonViBanHanh,
		DS.HoTen,DS.HocHam,DS.HocVi,DS.ChuyenNganh,DS.DonVi,
		KQ.TC1,KQ.TC2,KQ.TC3,KQ.TC4,KQ.TC5,KQ.TC6,KQ.TC7,KQ.TC8,KQ.TC9,KQ.TC10,
		KQ.DanhGiaNhanXetChung,KQ.NoiDungThucHienKhongPhuHop,KQ.YKienHoiDong
	FROM
	(SELECT *
	FROM KETQUANGHIENCUU 
	WHERE KetQuaNghienCuuID = @ID) KQ
	INNER JOIN DETAI DT ON DT.DeTaiID = KQ.KQNC_DeTaiID
	INNER JOIN DM_CAPQUANLY CQL ON CQL.DMCapQuanLyID = DT.DMCapQuanLyID
	INNER JOIN DANHSACHHOIDONG DS ON DS.DanhSachHoiDongID = KQ.KQNC_DanhSachHoiDongID
	INNER JOIN HOIDONGNGHIEMTHU HD ON HD.HoiDongNghiemThuID = DS.HoiDongNghiemThuID
	INNER JOIN DM_DONVIBANHANH DVBH ON DVBH.DMDonViBanHanhID = HD.DMDonViBanHanhID
END
GO
PRINT N'Creating [dbo].[proc_Print_DiemDanhGiaXetDuyetDeTai]...';


GO
CREATE PROCEDURE [dbo].[proc_Print_DiemDanhGiaXetDuyetDeTai]
	@DiemDanhGiaID int
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		D.DiemDanhGiaID,
		D.DDG_DeTaiID,
		D.NgayDanhGia,
		D.SoPhieu,
		KienNghi = 
		CASE 
			WHEN D.KienNghiThucHien = 1 THEN N'Đề nghị thực hiện'
			WHEN D.KienNghiThucHien = 2 THEN N'Đề nghị thực hiện với điều chỉnh'
			WHEN D.KienNghiThucHien = 3 THEN N'Không thực hiện'
		END,
		D.NhanXet,
		D.DeNghiVoiDieuChinh,
		Khoan = 
		CASE
			WHEN D.LoaiKhoan = 1 THEN N'Khoán đến sản phẩm cuối cùng'
			WHEN D.LoaiKhoan = 2 THEN N'Khoán từng phần'
			WHEN D.LoaiKhoan != 1 OR d.LoaiKhoan != 2 THEN N''
		END,
		DT.TenDeTai,DT.MaSoDeTai,DT.CNDT_HoTen,DM.TenCapQuanLy,DT.ThucHienTuNgay,DT.ThucHienDenNgay,DT.KinhPhi
	FROM
	(SELECT DDG.DiemDanhGiaID,DDG.DDG_DeTaiID,DDG.NgayDanhGia,DDG.SoPhieu,DDG.KienNghiThucHien,DDG.NhanXet,DDG.DeNghiVoiDieuChinh,DDG.LoaiKhoan
	FROM DIEMDANHGIA DDG WHERE DDG.DiemDanhGiaID = @DiemDanhGiaID) D INNER JOIN DETAI DT ON DT.DeTaiID = D.DDG_DeTaiID
	INNER JOIN DM_CAPQUANLY DM ON DM.DMCapQuanLyID = DT.DMCapQuanLyID
END
GO
PRINT N'Creating [dbo].[proc_Print_HoiDongNghiemThu]...';


GO
CREATE PROCEDURE [dbo].[proc_Print_HoiDongNghiemThu]
	@ID int
	--ID: HOIDONGNGHIEMTHUID
AS
BEGIN
	SET NOCOUNT ON;

	SELECT
		HD.SoQuyetDinh,
		HD.NgayQuyetDinh,
		HD.TrichYeu,HD.GhiChu,DVBH.TenDonViBanHanh,
		DT.TenDeTai,DT.MaSoDeTai,DT.CNDT_HoTen,CQL.TenCapQuanLy,DT.ThucHienTuNgay,DT.ThucHienDenNgay,
		DT.KinhPhi
	FROM
	(
		SELECT *
		FROM HOIDONGNGHIEMTHU
		WHERE HoiDongNghiemThuID =@ID
	) HD
	INNER JOIN DETAI DT ON DT.DeTaiID = HD.HDNT_DeTaiID
	INNER JOIN DM_DONVIBANHANH DVBH ON DVBH.DMDonViBanHanhID = HD.DMDonViBanHanhID
	INNER JOIN DM_CAPQUANLY CQL ON CQL.DMCapQuanLyID = DT.DMCapQuanLyID
END
GO
PRINT N'Creating [dbo].[proc_Print_HoiDongNghiemThu_DanhSachHoiDong]...';


GO
CREATE PROCEDURE [dbo].[proc_Print_HoiDongNghiemThu_DanhSachHoiDong]
	@ID int
	--ID:HOIDONGNGHIEMTHUID
AS
BEGIN

	SET NOCOUNT ON;
	SELECT * FROM DANHSACHHOIDONG WHERE HoiDongNghiemThuID = @ID
END
GO
PRINT N'Creating [dbo].[proc_Print_HoiDongNghienCuu]...';


GO
CREATE PROCEDURE [dbo].[proc_Print_HoiDongNghienCuu]
	@HoiDongID int
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		HD.*,
		DVBH.TenDonViBanHanh,
		DT.TenDeTai,
		DT.MaSoDeTai,
		DT.CNDT_HoTen,
		DT.ThucHienTuNgay,
		DT.ThucHienDenNgay,
		DT.KinhPhi,
		CQL.TenCapQuanLy
		FROM 
		(SELECT HDNC.HoiDongNghienCuuID,HDNC.SoQuyetDinh,HDNC.TrichYeu,HDNC.NgayQuyetDinh,HDNC.GhiChu,HDNC.DMDonViBanHanhID,HDNC.HDNC_DeTaiID FROM HOIDONGNGHIENCUU HDNC WHERE HDNC.HoiDongNghienCuuID = @HoiDongID ) HD 
		INNER JOIN DM_DONVIBANHANH DVBH ON HD.DMDonViBanHanhID = DVBH.DMDonViBanHanhID
		 INNER JOIN DETAI DT ON HD.HDNC_DeTaiID = DT.DeTaiID
		 INNER JOIN DM_CAPQUANLY CQL ON DT.DMCapQuanLyID = CQL.DMCapQuanLyID
END
GO
PRINT N'Creating [dbo].[proc_Print_HoiDongNghienCuu_DanhSachHoiDong]...';


GO
CREATE PROCEDURE [dbo].[proc_Print_HoiDongNghienCuu_DanhSachHoiDong]
	@HoiDongID int
AS 
BEGIN
	SET NOCOUNT ON;

	SELECT DS.HoTen,DS.DonVi,DS.NhiemVu
	FROM DANHSACHHOIDONGNGHIENCUU DS
	WHERE DS.HoiDongNghienCuuID = @HoiDongID
END
GO
PRINT N'Creating [dbo].[proc_Print_HopDongKhoaHocCongNghe]...';


GO
CREATE PROCEDURE [dbo].[proc_Print_HopDongKhoaHocCongNghe]
	@HopDongID int
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
	TMP.*,
	DT.TenDeTai,
	DT.MaSoDeTai,
	DT.CNDT_HoTen,
	CQL.TenCapQuanLy,
	DT.ThucHienTuNgay,DT.ThucHienDenNgay,
	DT.KinhPhi,
	QD.SoQuyetDinh,
	QD.NgayQuyetDinh,
	DVBH.TenDonViBanHanh
	FROM
	(SELECT HD.*
	FROM HOPDONG HD WHERE HD.HopDongID = @HopDongID) TMP
	INNER JOIN DETAI DT ON DT.DeTaiID = TMP.HD_DeTaiID
	INNER JOIN QUYETDINHPHEDUYET QD ON DT.DeTaiID = QD.QDPD_DeTaiID
	INNER JOIN DM_DONVIBANHANH DVBH ON DVBH.DMDonViBanHanhID = QD.DonViBanHanhID
	INNER JOIN DM_CAPQUANLY CQL ON CQL.DMCapQuanLyID = DT.DMCapQuanLyID
END
GO
PRINT N'Creating [dbo].[proc_Print_PhieuDanhGiaKetQuaDeTai]...';


GO
CREATE PROCEDURE [dbo].[proc_Print_PhieuDanhGiaKetQuaDeTai]
	@ID int
	--ID:KetQuaDeTaiID
AS
BEGIN
	SET NOCOUNT ON;

	SELECT
		DG.KetQuaDeTaiID,
		DG.HoTenChuyenGia,
		DG.NgayNhanHoSo,
		DG.PDG_DeTaiID,DG.YKienDanhGia,
		XepLoai = 
		CASE 
			WHEN DG.XepLoai = 1 THEN N'Xuất sắc'
			WHEN DG.XepLoai = 2 THEN N'Khá'
			WHEN DG.XepLoai = 3 THEN N'Trung bình'
			WHEN DG.XepLoai = 4 THEN N'Không đạt'
		END,
		CQL.TenCapQuanLy,
		DT.TenDeTai,DT.MaSoDeTai,DT.CNDT_HoTen,DT.ThucHienTuNgay,DT.ThucHienDenNgay,DT.KinhPhi
	FROM 
	(SELECT KetQuaDeTaiID,HoTenChuyenGia,NgayNhanHoSo,XepLoai,YKienDanhGia,PDG_DeTaiID
	FROM KETQUADETAI
	WHERE KetQuaDeTaiID = @ID) DG 
	INNER JOIN DETAI DT ON DT.DeTaiID  = DG.PDG_DeTaiID
	INNER JOIN DM_CAPQUANLY CQL ON CQL.DMCapQuanLyID = DT.DMCapQuanLyID
END
GO
PRINT N'Creating [dbo].[proc_Print_PhieuDanhGiaKetQuaDeTai_BangDanhGia]...';


GO
CREATE PROCEDURE [dbo].[proc_Print_PhieuDanhGiaKetQuaDeTai_BangDanhGia]
	@ID int
AS
BEGIN
	SET NOCOUNT ON;

	SELECT *
	FROM BANGDANHGIA
	WHERE BANGDANHGIA.KetQuaDeTaiID = @ID

END
GO
PRINT N'Creating [dbo].[proc_Print_QuyetDinhPheDuyetDeTai]...';


GO
CREATE PROCEDURE [dbo].[proc_Print_QuyetDinhPheDuyetDeTai]
	@QuyetDinhID int

AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
	QDPD.*,
	DV.TenDonViBanHanh,
	CQL.TenCapQuanLy,
	DT.TenDeTai,
	DT.MaSoDeTai,
	DT.CNDT_HoTen,
	DT.ThucHienTuNgay,
	DT.ThucHienDenNgay,
	DT.KinhPhi
	FROM
	(SELECT QD.QuyetDinhPheDuyetID,QD.QDPD_DeTaiID,QD.SoQuyetDinh,QD.NgayQuyetDinh,QD.BienBanHop,QD.NguoiDeNghi,
	QD.TrichYeu,QD.GhiChu,QD.DonViBanHanhID
	FROM QUYETDINHPHEDUYET QD WHERE QD.QuyetDinhPheDuyetID = @QuyetDinhID) QDPD
	INNER JOIN DETAI DT ON DT.DeTaiID = QDPD.QDPD_DeTaiID
	INNER JOIN DM_CAPQUANLY CQL ON CQL.DMCapQuanLyID = DT.DMCapQuanLyID
	INNER JOIN DM_DONVIBANHANH  DV ON DV.DMDonViBanHanhID = QDPD.DonViBanHanhID
END
GO
PRINT N'Creating [dbo].[proc_Print_XetDuyetDayDu]...';


GO
CREATE PROCEDURE [dbo].[proc_Print_XetDuyetDayDu]
	@XDDDID int
AS
BEGIN
	SET NOCOUNT ON;
	
	SELECT 
	XDDD.XDDD_SoBangKiem,XDDD.XDDD_YKienHuongDan_NgayGhi,XDDD.XDDD_YKienTruongKhoa_NgayGhi,
	XDDD.XDDD_YKienHuongDan_NhanXet,XDDD.XDDD_YKienTruongKhoa_NhanXet,
	XDDD.XDDD_YKienTruongKhoa_DMTinhKhoaHocID,
	XDDD.XDDD_NhanXet,XDDD.XDDD_DeTaiID,
	XemXetTinhKhoaHoc = CASE 
	WHEN XDDD.XDDD_XemXetTinhKhoaHoc = 1 THEN N'Có'
	WHEN XDDD.XDDD_XemXetTinhKhoaHoc = 0 THEN N'Không' END,
	DT.TenDeTai,DT.MaSoDeTai,DT.CNDT_HoTen,CQL.TenCapQuanLy,DT.ThucHienTuNgay,DT.ThucHienDenNgay,DT.KinhPhi,TKH.TenTinhKhoaHoc
	FROM
	(SELECT XD.XDDD_SoBangKiem,XD.XDDD_YKienHuongDan_NgayGhi,XD.XDDD_YKienTruongKhoa_NgayGhi,
	XD.XDDD_YKienHuongDan_NhanXet,XD.XDDD_YKienTruongKhoa_NhanXet,
	XD.XDDD_YKienTruongKhoa_DMTinhKhoaHocID,XD.XDDD_XemXetTinhKhoaHoc,
	XD.XDDD_NhanXet,XD.XDDD_DeTaiID
	FROM XETDUYETDAYDU XD WHERE XD.XDDD_XetDuyetDayDuID = @XDDDID) XDDD
	INNER JOIN DETAI DT ON DT.DeTaiID = XDDD.XDDD_DeTaiID
	INNER JOIN DM_CAPQUANLY CQL ON CQL.DMCapQuanLyID = DT.DMCapQuanLyID
	INNER JOIN DM_TINHKHOAHOC TKH ON TKH.DMTinhKhoaHocID = XDDD.XDDD_YKienTruongKhoa_DMTinhKhoaHocID
END
GO
PRINT N'Creating [dbo].[proc_Print_XetDuyetRutGon]...';


GO
CREATE PROCEDURE [dbo].[proc_Print_XetDuyetRutGon]
	@XDRGID int
AS
BEGIN
	SET NOCOUNT ON;
	
	SELECT 
	XDRG.XDRG_SoBangKiem,XDRG.XDRG_NghienCuuSinh_NgayKhai,DK.TenDieuKien,
	XDRG.XDRG_YKienNguoiHuongDan_Ngay,DK1.TenDieuKien,
	XDRG.XDRG_YKienTruongKhoa_Ngay,DK2.TenDieuKien,
	XDRG.XDRG_YKienChuTichHoiDong_Ngay,DK3.TenDieuKien,
	XDRG.XDRG_YKienNhanXet,XDRG.XDRG_DeTaiID,
	DT.TenDeTai,DT.MaSoDeTai,DT.CNDT_HoTen,CQL.TenCapQuanLy,DT.ThucHienTuNgay,DT.ThucHienDenNgay,DT.KinhPhi
	FROM
	(SELECT XD.XDRG_SoBangKiem,XD.XDRG_NghienCuuSinh_NgayKhai,XD.XDRG_NghienCuuSinh_DMDieuKienID,
	XD.XDRG_YKienNguoiHuongDan_Ngay,XD.XDRG_YKienNguoiHuongDan_DMDieuKienID,
	XD.XDRG_YKienTruongKhoa_Ngay,XD.XDRG_YKienTruongKhoa_DMDieuKienID,
	XD.XDRG_YKienChuTichHoiDong_Ngay,XD.XDRG_YKienChuTichHoiDong_DMDieuKienID,
	XD.XDRG_YKienNhanXet,XD.XDRG_DeTaiID
	FROM XETDUYETRUTGON XD WHERE XD.XDRG_XetDuyetRutGonID = @XDRGID) XDRG
	INNER JOIN DETAI DT ON DT.DeTaiID = XDRG.XDRG_DeTaiID
	INNER JOIN DM_CAPQUANLY CQL ON CQL.DMCapQuanLyID = DT.DMCapQuanLyID
	INNER JOIN DM_DIEUKIEN DK ON DK.DMDieuKienID = XDRG.XDRG_NghienCuuSinh_DMDieuKienID
	INNER JOIN DM_DIEUKIEN DK1 ON DK1.DMDieuKienID = XDRG.XDRG_YKienNguoiHuongDan_DMDieuKienID
	INNER JOIN DM_DIEUKIEN DK2 ON DK2.DMDieuKienID = XDRG.XDRG_YKienTruongKhoa_DMDieuKienID
	INNER JOIN DM_DIEUKIEN DK3 ON DK3.DMDieuKienID = XDRG.XDRG_YKienChuTichHoiDong_DMDieuKienID
END
GO
PRINT N'Creating [dbo].[proc_PrintBang1_BCDK]...';


GO
--------BANG 1 BAO CAO DINH KY
CREATE PROC proc_PrintBang1_BCDK
	@IDBaoCaoDK INT
AS
SELECT A.*,B.TenDonViDo FROM(
	SELECT * FROM BANG1 NOLOCK WHERE BaoCaoDinhKyID=@IDBaoCaoDK
	) AS A
LEFT JOIN(SELECT * FROM DM_DONVIDO NOLOCK)AS B ON B.DMDonViDoID=A.DonViDoID
GO
PRINT N'Creating [dbo].[proc_PrintBang2_BCDK]...';


GO
--------BANG 2 BAO CAO DINH KY
CREATE PROC proc_PrintBang2_BCDK
	@IDBaoCaoDK INT
AS
SELECT A.*,B.TenDonViDo FROM(
	SELECT * FROM BANG2 NOLOCK WHERE BaoCaoDinhKyID=7
	) AS A
LEFT JOIN(SELECT * FROM DM_DONVIDO NOLOCK)AS B ON B.DMDonViDoID=A.DonViDoID
GO
PRINT N'Creating [dbo].[proc_PrintBang3_BCDK]...';


GO
--------BANG 3 BAO CAO DINH KY
CREATE PROC proc_PrintBang3_BCDK
	@IDBaoCaoDK INT
AS
SELECT A.*,B.TenDonViDo FROM(
	SELECT * FROM BANG3 NOLOCK WHERE BaoCaoDinhKyID=@IDBaoCaoDK
	) AS A
LEFT JOIN(SELECT * FROM DM_DONVIDO NOLOCK)AS B ON B.DMDonViDoID=A.DonViDoID
GO
PRINT N'Creating [dbo].[proc_PrintBang4_BCDK]...';


GO
--------BANG 4 BAO CAO DINH KY
CREATE PROC proc_PrintBang4_BCDK
	@IDBaoCaoDK INT
AS
SELECT * FROM BANG4 NOLOCK WHERE BaoCaoDinhKyID=@IDBaoCaoDK
GO
PRINT N'Creating [dbo].[proc_PrintBang5_BCDK]...';


GO
--------BANG 5 BAO CAO DINH KY
CREATE PROC proc_PrintBang5_BCDK
	@IDBaoCaoDK INT
as
	SELECT 
		a.*,B.Dot,B.SoTien
		,CONVERT(NVARCHAR(50),B.ThoiGian,103) AS pThoiGian
		 FROM(SELECT * FROM BANG5 NOLOCK WHERE BaoCaoDinhKyID=@IDBaoCaoDK) AS A
	LEFT JOIN(SELECT * FROM CHITIETBANG5 NOLOCK)AS B ON B.Bang5ID=A.Bang5ID
GO
PRINT N'Creating [dbo].[proc_PrintBang6_BCDK]...';


GO
--------BANG 6 BAO CAO DINH KY
CREATE PROC proc_PrintBang6_BCDK
	@IDBaoCaoDK INT
AS
	SELECT *,CONVERT(NVARCHAR(50),B.ThoiGianSuDung,103) AS pThoiGian 
	FROM(SELECT * FROM BANG6 NOLOCK WHERE BaoCaoDinhKyID=@IDBaoCaoDK) AS A
	LEFT JOIN(SELECT * FROM CHITIETBANG6 NOLOCK)AS B ON B.Bang6ID=A.Bang6ID
GO
PRINT N'Creating [dbo].[proc_PrintBCDK_III_CaNhanThamGia]...';


GO
----III- CA NHAN THAM GIA
CREATE PROC dbo.proc_PrintBCDK_III_CaNhanThamGia
	@BCKQID INT
AS
SELECT * FROM CANHANTHAMGIA NOLOCK WHERE BaoCaoKetQuaID=@BCKQID
GO
PRINT N'Creating [dbo].[proc_PrintBCDK_III_ToChucThamGia]...';


GO
----III--TO CHUC THAM GIA
CREATE PROC dbo.proc_PrintBCDK_III_ToChucThamGia
	@BCKQID INT
AS
SELECT * FROM TOCHUCTHAMGIA NOLOCK WHERE BaoCaoKetQuaID=@BCKQID
GO
PRINT N'Creating [dbo].[proc_PrintBCDK_IV_HopTacQuocTe]...';


GO
---IV--HopTacQuocTe
CREATE PROC dbo.proc_PrintBCDK_IV_HopTacQuocTe
	@BCKQID INT
AS
SELECT 
*,CONVERT(nvarchar(20),ThoiGian,103) pThoiGian
 FROM HOPTACQUOCTE NOLOCK WHERE BaoCaoKetQuaID=@BCKQID
GO
PRINT N'Creating [dbo].[proc_PrintBCDK_IV_ToChucHoiThao]...';


GO
---IV--tinh hinh to chuc hoi thao
CREATE PROC dbo.proc_PrintBCDK_IV_ToChucHoiThao
	@BCKQID INT
AS
SELECT 
*,CONVERT(nvarchar(20),ThoiGian,103) pThoiGian
 FROM TOCHUCHOITHAO NOLOCK WHERE BaoCaoKetQuaID=@BCKQID
GO
PRINT N'Creating [dbo].[proc_PrintBCDK_V_NoiDungCongViec]...';


GO
---V--Noi dung cong viec
CREATE PROC dbo.proc_PrintBCDK_V_NoiDungCongViec
	@BCKQID INT
AS
SELECT 
	TenNoiDungCongViec
	,CONVERT(nvarchar(20),KeHoach_BatDau,103) KeHoach_BatDau
	,CONVERT(nvarchar(20),KeHoach_KetThuc,103) KeHoach_KetThuc
	,CONVERT(nvarchar(20),ThucTe_BatDau,103) ThucTe_BatDau
	,CONVERT(nvarchar(20),ThucTe_KetThuc,103) ThucTe_KetThuc
	,Nguoi_CoQuanThucHien
 FROM NOIDUNGCONGVIEC NOLOCK WHERE BaoCaoKetQuaID=@BCKQID
GO
PRINT N'Creating [dbo].[proc_PrintBCDK_VI_DangKyBaoHo]...';


GO
---VI--SAN PHAM KHOA HOC VÀ CONG NGHE
---DANGKYBAOHO
CREATE PROC dbo.proc_PrintBCDK_VI_DangKyBaoHo
	@BCKQID INT
AS
SELECT * FROM DANGKYBAOHO NOLOCK WHERE BaoCaoKetQuaID=@BCKQID
GO
PRINT N'Creating [dbo].[proc_PrintBCDK_VI_KetQuaDaoTao]...';


GO
---VI--SAN PHAM KHOA HOC VÀ CONG NGHE
---Ket Qua dao tao
CREATE PROC dbo.proc_PrintBCDK_VI_KetQuaDaoTao
	@BCKQID INT
AS
SELECT * FROM KETQUADAOTAO NOLOCK WHERE BaoCaoKetQuaID=@BCKQID
GO
PRINT N'Creating [dbo].[proc_PrintBCDK_VI_SanPham1]...';


GO
---VI--SAN PHAM KHOA HOC VÀ CONG NGHE
---san pham 1
CREATE PROC dbo.proc_PrintBCDK_VI_SanPham1
	@BCKQID INT
AS
SELECT * FROM SANPHAMDANG1 NOLOCK WHERE BaoCaoKetQuaID=@BCKQID
GO
PRINT N'Creating [dbo].[proc_PrintBCDK_VI_SanPham2]...';


GO
---VI--SAN PHAM KHOA HOC VÀ CONG NGHE
---san pham 2
CREATE PROC dbo.proc_PrintBCDK_VI_SanPham2
	@BCKQID INT
AS
SELECT * FROM SANPHAMDANG2 NOLOCK WHERE BaoCaoKetQuaID=@BCKQID
GO
PRINT N'Creating [dbo].[proc_PrintBCDK_VI_SanPham3]...';


GO
---VI--SAN PHAM KHOA HOC VÀ CONG NGHE
---san pham 3
CREATE PROC dbo.proc_PrintBCDK_VI_SanPham3
	@BCKQID INT
AS
SELECT * FROM SANPHAMDANG3 NOLOCK WHERE BaoCaoKetQuaID=@BCKQID
GO
PRINT N'Creating [dbo].[proc_PrintBCDK_VI_SANPHAMTHUCTE]...';


GO
---VI--SAN PHAM KHOA HOC VÀ CONG NGHE
---SANPHAMTHUCTE
CREATE PROC dbo.proc_PrintBCDK_VI_SANPHAMTHUCTE
	@BCKQID INT
AS
SELECT *,CONVERT(nvarchar(20),ThoiGian,103) pThoiGian
 FROM SANPHAMTHUCTE NOLOCK WHERE BaoCaoKetQuaID=@BCKQID
GO
PRINT N'Creating [dbo].[proc_PrintBCDK_VIII_TINHHINHTHUCHIENBAOCAO]...';


GO
---VIII
---tinh hinh thực tế, chế độ báo cáo
CREATE PROC dbo.proc_PrintBCDK_VIII_TINHHINHTHUCHIENBAOCAO
	@BCKQID INT
AS
SELECT *,CONVERT(nvarchar(20),ThoiGianThucHien,103) pThoiGianThucHien
 FROM TINHHINHTHUCHIENBAOCAO NOLOCK WHERE BaoCaoKetQuaID=@BCKQID
GO
PRINT N'Creating [dbo].[proc_PrintBCKQ_I_GiaHan]...';


GO
-------------I
--Gia Han thời gian
CREATE PROC dbo.proc_PrintBCKQ_I_GiaHan
	@BCKQID INT
AS
SELECT
    Lan
	, CONVERT(nvarchar(20),TuNgay,103) TuNgay
	, CONVERT(nvarchar(20),DenNgay,103) DenNgay 
	FROM GIAHAN NOLOCK WHERE BaoCaoKetQuaID=@BCKQID
ORDER BY Lan ASC
GO
PRINT N'Creating [dbo].[proc_PrintBCKQ_II_KinhPhi_KhoanChi]...';


GO
----------II-
--Tình hình cấp và sử dụng kinh phí từ nguồn SNKH
CREATE PROC dbo.proc_PrintBCKQ_II_KinhPhi_KhoanChi
	@BCKQID INT
AS
SELECT 
	B.*
FROM
(SELECT * FROM KINHPHI NOLOCK where BaoCaoKetQuaID=@BCKQID )AS A
LEFT JOIN(SELECT * FROM KETQUASUDUNG NOLOCK) AS B ON B.KinhPhiID=A.KinhPhiID
GO
PRINT N'Creating [dbo].[proc_PrintBCKQ_II_KinhPhi_SuDung]...';


GO
----------II-
--Tình hình cấp và sử dụng kinh phí từ nguồn SNKH
CREATE PROC dbo.proc_PrintBCKQ_II_KinhPhi_SuDung
	@BCKQID INT
AS
SELECT 
	A.*
	,CONVERT(nvarchar(20),b.KeHoach_ThoiGian,103) KeHoach_ThoiGian
	, b.KeHoach_KinhPhi
	,CONVERT(nvarchar(20),b.ThucTe_ThoiGian,103) ThucTe_ThoiGian
	,b.ThucTe_KinhPhi
	,B.GhiChu
FROM
(SELECT * FROM KINHPHI NOLOCK WHERE BaoCaoKetQuaID=@BCKQID)AS A
LEFT JOIN(SELECT * FROM TINHHINHCAP NOLOCK) AS B ON B.KinhPhiID=A.KinhPhiID
GO
PRINT N'Creating [dbo].[proc_PrintBCKQ_II_KinhPhi_VanBan]...';


GO
----------II-
--Các văn bản hành chính trong quá trình thực hiện đề tài/ dự án
CREATE PROC dbo.proc_PrintBCKQ_II_KinhPhi_VanBan
	@BCKQID INT
AS
SELECT 
	B.*
FROM
(SELECT * FROM KINHPHI NOLOCK where BaoCaoKetQuaID=@BCKQID )AS A
LEFT JOIN(SELECT * FROM VANBAN NOLOCK) AS B ON B.KinhPhiID=A.KinhPhiID
GO
PRINT N'Creating [dbo].[proc_PrintBCKQ_ThongTinChung]...';


GO
-----------Bao cao ket qua thục hiện
--I, Thông tin chung
CREATE PROC dbo.proc_PrintBCKQ_ThongTinChung
	@BCKQID INT
AS
SELECT top 1
	A.*
	,CONVERT(nvarchar(20),a.NgayKy,103) pNgayKy
	,CONVERT(nvarchar(20),a.NgayBatDauHopDong,103) pNgayBatDauHopDong
	,CONVERT(nvarchar(20),a.NgayKetThucHopDong,103) pNgayKetThucHopDong
	,CONVERT(nvarchar(20),a.NgayBatDauThucHien,103) pNgayBatDauThucHien
	,CONVERT(nvarchar(20),a.NgayKetThucThucHien,103) pNgayKetThucThucHien
	,b.TenDeTai,b.CNDT_HoTen,b.MaSoDeTai,c.TenCapQuanLy
	,CONVERT(nvarchar(20),b.ThucHienTuNgay,103) pThucHienTuNgay
	,CONVERT(nvarchar(20),b.ThucHienDenNgay,103) pThucHienDenNgay
	,KinhPhi  pKinhPhi
	,d.HieuQuaKHCN,d.HieuQuaKTXH
	--,E.TongKinhPhiThucHien
	--,E.KinhPhiHoTroSNKH
	--,E.KinhPhiTuNguonKhac
	--,E.TyLeKinhPhiThuHoi
FROM
	(SELECT * FROM BAOCAOKETQUA NOLOCK WHERE BaoCaoKetQuaID=@BCKQID)AS A
LEFT JOIN
	(SELECT * FROM DETAI NOLOCK) AS B ON B.DeTaiID=A.BCKQ_DeTaiID
LEFT JOIN
    (SELECT DMCapQuanLyID,TenCapQuanLy FROM DM_CAPQUANLY NOLOCK) AS C ON C.DMCapQuanLyID=B.DMCapQuanLyID
LEFT JOIN
    (SELECT * FROM HIEUQUADETAI NOLOCK) AS D ON D.BaoCaoKetQuaID=A.BaoCaoKetQuaID
--KINH PHI
--LEFT JOIN(SELECT * FROM KINHPHI NOLOCK) AS E ON E.BaoCaoKetQuaID=A.BaoCaoKetQuaID
GO
PRINT N'Creating [dbo].[proc_PrintGiaHanDeTai]...';


GO
CREATE PROCEDURE [dbo].[proc_PrintGiaHanDeTai]
	@GiaHanDeTaiId INT
AS
   SELECT TOP 1 A.*,
   B.TenDeTai,B.CNDT_HoTen
	,CONVERT(nvarchar(20),A.GiaHanDenNgay,103) pNgayBaoCao
	,CONVERT(nvarchar(20),b.ThucHienTuNgay,103) pThucHienTuNgay
	,CONVERT(nvarchar(20),b.ThucHienDenNgay,103) pThucHienDenNgay
	,B.MaSoDeTai,C.TenCapQuanLy,B.KinhPhi 
	,CASE WHEN(A.DaDuyet=1) then N'Đã duyệt'ELSE N'Chưa duyệt' END pTinhTrang 
	,Cast(KinhPhi as nvarchar(50))+N' (VNĐ)' pKinhPhi
	,CONVERT(nvarchar(20),D.NgayQuyetDinh,103) NgayQuyetDinh
	,D.SoQuyetDinh
	,E.TenDonViBanHanh
  FROM(SELECT * FROM GIAHANTHUCHIENDETAI NOLOCK WHERE GiaHanThucHienDeTaiID=@GiaHanDeTaiId)AS A
  LEFT JOIN(SELECT * FROM DETAI NOLOCK) AS B ON B.DeTaiID=A.GHDT_DeTaiID
  LEFT JOIN(SELECT DMCapQuanLyID,TenCapQuanLy FROM DM_CAPQUANLY NOLOCK) AS C ON C.DMCapQuanLyID=B.DMCapQuanLyID
  LEFT JOIN(SELECT * FROM QUYETDINHPHEDUYET NOLOCK)AS D ON D.QDPD_DeTaiID=B.DeTaiID
  LEFT JOIN(SELECT * FROM DM_DONVIBANHANH NOLOCK)AS E ON E.DMDonViBanHanhID=D.DonViBanHanhID
GO
PRINT N'Creating [dbo].[proc_PrintThongTinChung_BCDK]...';


GO
----THONG TIN CHUNG BAO CAO DINH KY
CREATE PROC proc_PrintThongTinChung_BCDK
	@IDBaoCaoDK INT
AS
SELECT TOP 1
	A.*,B.TenDeTai,B.CNDT_HoTen,N'BÁO CÁO KỲ SỐ '+UPPER(A.KyBaoCao) AS pKyBaoCao
	,CONVERT(nvarchar(20),A.NgayBaoCao,103) pNgayBaoCao
	,CONVERT(nvarchar(20),b.ThucHienTuNgay,103) pThucHienTuNgay
	,CONVERT(nvarchar(20),b.ThucHienDenNgay,103) pThucHienDenNgay
	,B.MaSoDeTai,C.TenCapQuanLy,B.KinhPhi
 FROM
(SELECT * FROM BAOCAODINHKY NOLOCK) AS A
LEFT JOIN(SELECT * FROM DETAI NOLOCK) AS B ON B.DeTaiID=A.BCDK_DeTaiID
LEFT JOIN(SELECT DMCapQuanLyID,TenCapQuanLy FROM DM_CAPQUANLY NOLOCK) AS C ON C.DMCapQuanLyID=B.DMCapQuanLyID
GO
PRINT N'Creating [dbo].[proc_QuyetDinhPheDuyetDeTai_FullTextIndexSearch]...';


GO
CREATE PROCEDURE [dbo].[proc_QuyetDinhPheDuyetDeTai_FullTextIndexSearch]
	@SoQuyetDinh nvarchar(1000),
	@TenDeTai nvarchar(1000),
	@ChuNhiemDeTai nvarchar(1000),
	@QuyetDinhTuNgay date,
	@QuyetDinhDenNgay date,
	@UserId int
AS
BEGIN 

	SET NOCOUNT ON;

	IF @TenDeTai IS NOT NULL
		SELECT 
			DT.DeTaiID,
			QD.SoQuyetDinh,
			DT.TenDeTai,
			DT.CNDT_HoTen AS ChuNhiemDeTai,
			DT.ThucHienTuNgay,
			DT.ThucHienDenNgay,
			QD.NgayQuyetDinh,
			QD.QuyetDinhPheDuyetID
		FROM DETAI DT INNER JOIN FREETEXTTABLE(DETAI,TenDeTai,@TenDeTai) as FTS_DT ON DT.DeTaiID = FTS_DT.[KEY]
		INNER JOIN QUYETDINHPHEDUYET QD ON QD.QDPD_DeTaiID = DT.DeTaiID
		--WHERE FREETEXT(TenDeTai,@TenDeTai)
		AND (UPPER(LTRIM(RTRIM(QD.SoQuyetDinh))) LIKE '%' +UPPER(LTRIM(RTRIM(@SoQuyetDinh)))+ '%' OR @SoQuyetDinh IS NULL )
		AND (UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%' +UPPER(LTRIM(RTRIM(@ChuNhiemDeTai))) + '%' OR @ChuNhiemDeTai IS NULL)
		AND (CONVERT(DATE,QD.NgayQuyetDinh,105) >= CONVERT(DATE,@QuyetDinhTuNgay,105) OR @QuyetDinhTuNgay IS NULL)
		AND (CONVERT(DATE,QD.NgayQuyetDinh,105) <= CONVERT(DATE,@QuyetDinhDenNgay,105) OR @QuyetDinhDenNgay IS NULL)
		AND (DT.UserId = @UserId OR @UserId IS NULL)
	ELSE
		SELECT 
			DT.DeTaiID,
			QD.SoQuyetDinh,
			DT.TenDeTai,
			DT.CNDT_HoTen AS ChuNhiemDeTai,
			DT.ThucHienTuNgay,
			DT.ThucHienDenNgay,
			QD.NgayQuyetDinh,
			QD.QuyetDinhPheDuyetID
		FROM QUYETDINHPHEDUYET QD INNER JOIN DETAI DT ON DT.DeTaiID = QD.QDPD_DeTaiID
		WHERE
		(UPPER(LTRIM(RTRIM(QD.SoQuyetDinh))) LIKE '%' +UPPER(LTRIM(RTRIM(@SoQuyetDinh)))+ '%' OR @SoQuyetDinh IS NULL )
		AND (UPPER(LTRIM(RTRIM(DT.CNDT_HoTen))) LIKE '%' +UPPER(LTRIM(RTRIM(@ChuNhiemDeTai))) + '%' OR @ChuNhiemDeTai IS NULL)
		AND (CONVERT(DATE,QD.NgayQuyetDinh,105) >= CONVERT(DATE,@QuyetDinhTuNgay,105) OR @QuyetDinhTuNgay IS NULL)
		AND (CONVERT(DATE,QD.NgayQuyetDinh,105) <= CONVERT(DATE,@QuyetDinhDenNgay,105) OR @QuyetDinhDenNgay IS NULL)
		AND (DT.UserId = @UserId OR @UserId IS NULL)
END
GO
PRINT N'Creating [dbo].[proc_Search_BaoCaoDinhKy]...';


GO
CREATE PROCEDURE [dbo].[proc_Search_BaoCaoDinhKy]
	@tenDeTai nvarchar(1000),
	@maDeTai nvarchar(1000),
	@chuNhiemDeTai int,
	@coQuanChuTri nvarchar(1000),
	@ngayBaoCao date,
	@kyBaoCao int
AS
BEGIN
	SET NOCOUNT ON;

	IF @tenDeTai IS NOT NULL
	BEGIN
		SELECT DISTINCT(BCDK.BaoCaoDinhKyID),DKDT.DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,KinhPhiThucHien,CoQuanChuTri,MaCanBoThucHien,HoTen,TrangThaiDeTai
		FROM DANGKYDETAI DKDT 
		INNER JOIN FREETEXTTABLE(DANGKYDETAI,TenDeTai,@tenDeTai) as FTS_DKDT
		ON DKDT.DeTaiID = FTS_DKDT.[KEY]
		INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
		INNER JOIN THUCHIENDETAI_BAOCAODINHKY BCDK ON BCDK.DeTaiID = DKDT.DeTaiID
		--LEFT JOIN : TRƯỜNG HỢP KHÔNG CÓ CHI TIET VAN LAY DUOC DU LIEU
		LEFT JOIN THUCHIENDETAI_BAOCAODINHKY_CHITIET CT ON CT.BaoCaoDinhKyID = BCDK.BaoCaoDinhKyID
		AND (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
		AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
		AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
		AND (CT.NgayBaoCao = @ngayBaoCao OR @ngayBaoCao IS NULL)
		AND (CT.KyBaoCao = @kyBaoCao OR @kyBaoCao IS NULL)

	END
	ELSE
	BEGIN
		SELECT DISTINCT(BCDK.BaoCaoDinhKyID),DKDT.DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,KinhPhiThucHien,CoQuanChuTri,MaCanBoThucHien,HoTen,TrangThaiDeTai
		FROM DANGKYDETAI DKDT 		
		INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
		INNER JOIN THUCHIENDETAI_BAOCAODINHKY BCDK ON BCDK.DeTaiID = DKDT.DeTaiID
		LEFT JOIN THUCHIENDETAI_BAOCAODINHKY_CHITIET CT ON CT.BaoCaoDinhKyID = BCDK.BaoCaoDinhKyID
		WHERE (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
		AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
		AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
		AND (CT.NgayBaoCao = @ngayBaoCao OR @ngayBaoCao IS NULL)
		AND (CT.KyBaoCao = @kyBaoCao OR @kyBaoCao IS NULL)
	END
END
GO
PRINT N'Creating [dbo].[proc_Search_BaoCaoHoanTat]...';


GO
CREATE PROCEDURE [dbo].[proc_Search_BaoCaoHoanTat]
	@tenDeTai nvarchar(1000),
	@maDeTai nvarchar(1000),
	@ngayHoanTatLaySoLieu date,
	@chuNhiemDeTai nvarchar(1000)
AS
BEGIN
	SET NOCOUNT ON;

	IF (@tenDeTai IS NOT NULL)
	BEGIN 
		SELECT MaDeTai, TenDeTai, TrangThaiDeTaiBenNgoai, ThoiGianLaySoLieu, ChuNhiemDeTai, GT.DeTaiBenNgoaiID, GT.BaoCaoHoanTatID
		FROM FREETEXTTABLE(DETAIBENNGOAI_NHANYEUCAU,TenDeTai,@tenDeTai) as FTS_DKDT
		INNER JOIN DETAIBENNGOAI_NHANYEUCAU NYC ON NYC.DeTaiBenNgoaiID = FTS_DKDT.[KEY]
		INNER JOIN DETAIBENNGOAI_BAOCAOHOANTAT GT ON GT.DeTaiBenNgoaiID = NYC.DeTaiBenNgoaiID
		AND (UPPER(LTRIM(RTRIM(NYC.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
		AND (UPPER(LTRIM(RTRIM(NYC.ChuNhiemDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@chuNhiemDeTai)))+'%' OR @chuNhiemDeTai IS NULL)  	
		AND (ThoiGianLaySoLieu = @ngayHoanTatLaySoLieu OR @ngayHoanTatLaySoLieu IS NULL)
	END
	ELSE
	BEGIN
		SELECT MaDeTai, TenDeTai, TrangThaiDeTaiBenNgoai, ThoiGianLaySoLieu, ChuNhiemDeTai, GT.DeTaiBenNgoaiID, GT.BaoCaoHoanTatID
		FROM DETAIBENNGOAI_NHANYEUCAU NYC
		INNER JOIN DETAIBENNGOAI_BAOCAOHOANTAT GT ON GT.DeTaiBenNgoaiID = NYC.DeTaiBenNgoaiID
		WHERE (UPPER(LTRIM(RTRIM(NYC.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  
		AND (UPPER(LTRIM(RTRIM(NYC.ChuNhiemDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@chuNhiemDeTai)))+'%' OR @chuNhiemDeTai IS NULL)  	
		AND (ThoiGianLaySoLieu = @ngayHoanTatLaySoLieu OR @ngayHoanTatLaySoLieu IS NULL)
	END
END
GO
PRINT N'Creating [dbo].[proc_Search_BaoCaoHoiNghiDangTapChi]...';


GO
CREATE PROCEDURE [dbo].[proc_Search_BaoCaoHoiNghiDangTapChi]
	@tenDeTai nvarchar(1000),
	@maDeTai nvarchar(1000),
	@chuNhiemDeTai int,
	@coQuanChuTri nvarchar(1000),
	@thucHienTuNgay date,
	@thucHienDenNgay date,
	@kinhPhiNhoNhat money,
	@kinhPhiLonNhat money
AS
BEGIN
	SET NOCOUNT ON;

	IF @tenDeTai IS NOT NULL
	BEGIN
		SELECT DISTINCT(HNHT.ToChucHoiNghiHoiThaoID),DKDT.DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,KinhPhiThucHien,CoQuanChuTri,MaCanBoThucHien,HoTen,TrangThaiDeTai
		FROM DANGKYDETAI DKDT 
		INNER JOIN FREETEXTTABLE(DANGKYDETAI,TenDeTai,@tenDeTai) as FTS_DKDT
		ON DKDT.DeTaiID = FTS_DKDT.[KEY]
		INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
		INNER JOIN THUCHIENDETAI_TOCHUCHOINGHIHOITHAO HNHT ON HNHT.DeTaiID = DKDT.DeTaiID
		LEFT JOIN THUCHIENDETAI_TOCHUCHOINGHIHOITHAO_CHITIET CT ON CT.ToChucHoiNghiHoiThaoID = HNHT.ToChucHoiNghiHoiThaoID
		AND (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
		AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
		AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
		AND (DKDT.KinhPhiThucHien >= @kinhPhiNhoNhat OR @kinhPhiNhoNhat IS NULL)
		AND (DKDT.KinhPhiThucHien <= @kinhPhiLonNhat OR @kinhPhiLonNhat IS NULL)
		AND (CONVERT(DATE,DKDT.ThucHienTuNgay,105) >= CONVERT(DATE,@thucHienTuNgay,105) OR @thucHienTuNgay IS NULL )
		AND (CONVERT(DATE,DKDT.ThucHienDenNgay,105) <= CONVERT(DATE,@thucHienDenNgay,105) OR @thucHienDenNgay IS NULL  )
	END
	ELSE
	BEGIN
		SELECT DISTINCT(HNHT.ToChucHoiNghiHoiThaoID),DKDT.DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,KinhPhiThucHien,CoQuanChuTri,MaCanBoThucHien,HoTen,TrangThaiDeTai
		FROM DANGKYDETAI DKDT 		
		INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
		INNER JOIN THUCHIENDETAI_TOCHUCHOINGHIHOITHAO HNHT ON HNHT.DeTaiID = DKDT.DeTaiID
		LEFT JOIN THUCHIENDETAI_TOCHUCHOINGHIHOITHAO_CHITIET CT ON CT.ToChucHoiNghiHoiThaoID = HNHT.ToChucHoiNghiHoiThaoID
		WHERE (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
		AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
		AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
		AND (DKDT.KinhPhiThucHien >= @kinhPhiNhoNhat OR @kinhPhiNhoNhat IS NULL)
		AND (DKDT.KinhPhiThucHien <= @kinhPhiLonNhat OR @kinhPhiLonNhat IS NULL)
		AND (CONVERT(DATE,DKDT.ThucHienTuNgay,105) >= CONVERT(DATE,@thucHienTuNgay,105) OR @thucHienTuNgay IS NULL )
		AND (CONVERT(DATE,DKDT.ThucHienDenNgay,105) <= CONVERT(DATE,@thucHienDenNgay,105) OR @thucHienDenNgay IS NULL  )
	END
END
GO
PRINT N'Creating [dbo].[proc_Search_BoSungSuaDoiNghiemThu]...';


GO
CREATE PROCEDURE [dbo].[proc_Search_BoSungSuaDoiNghiemThu]
	@tenDeTai nvarchar(1000),
	@maDeTai nvarchar(1000),
	@chuNhiemDeTai int,
	@coQuanChuTri nvarchar(1000),
	@thucHienTuNgay date,
	@thucHienDenNgay date,
	@kinhPhiNhoNhat money,
	@kinhPhiLonNhat money
AS
BEGIN
	SET NOCOUNT ON;

	IF @tenDeTai IS NOT NULL
	BEGIN
		SELECT DKDT.DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,KinhPhiThucHien,CoQuanChuTri,MaCanBoThucHien,HoTen,TrangThaiDeTai,NT.BoSungSuaDoiID
		FROM DANGKYDETAI DKDT 
		INNER JOIN FREETEXTTABLE(DANGKYDETAI,TenDeTai,@tenDeTai) as FTS_DKDT
		ON DKDT.DeTaiID = FTS_DKDT.[KEY]
		INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
		INNER JOIN NGHIEMTHU_BOSUNGSUADOI NT ON NT.DeTaiID = DKDT.DeTaiID
		AND (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
		AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
		AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
		AND (DKDT.KinhPhiThucHien >= @kinhPhiNhoNhat OR @kinhPhiNhoNhat IS NULL)
		AND (DKDT.KinhPhiThucHien <= @kinhPhiLonNhat OR @kinhPhiLonNhat IS NULL)
		AND (CONVERT(DATE,DKDT.ThucHienTuNgay,105) >= CONVERT(DATE,@thucHienTuNgay,105) OR @thucHienTuNgay IS NULL )
		AND (CONVERT(DATE,DKDT.ThucHienDenNgay,105) <= CONVERT(DATE,@thucHienDenNgay,105) OR @thucHienDenNgay IS NULL  )
	END
	ELSE
	BEGIN
		SELECT DKDT.DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,KinhPhiThucHien,CoQuanChuTri,MaCanBoThucHien,HoTen,TrangThaiDeTai,NT.BoSungSuaDoiID
		FROM DANGKYDETAI DKDT 		
		INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
		INNER JOIN NGHIEMTHU_BOSUNGSUADOI NT ON NT.DeTaiID = DKDT.DeTaiID
		WHERE (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
		AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
		AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
		AND (DKDT.KinhPhiThucHien >= @kinhPhiNhoNhat OR @kinhPhiNhoNhat IS NULL)
		AND (DKDT.KinhPhiThucHien <= @kinhPhiLonNhat OR @kinhPhiLonNhat IS NULL)
		AND (CONVERT(DATE,DKDT.ThucHienTuNgay,105) >= CONVERT(DATE,@thucHienTuNgay,105) OR @thucHienTuNgay IS NULL )
		AND (CONVERT(DATE,DKDT.ThucHienDenNgay,105) <= CONVERT(DATE,@thucHienDenNgay,105) OR @thucHienDenNgay IS NULL  )
	END
END
GO
PRINT N'Creating [dbo].[proc_Search_BoSungSuaDoiXetDuyet]...';


GO
CREATE PROCEDURE [dbo].[proc_Search_BoSungSuaDoiXetDuyet]
	@tenDeTai nvarchar(1000),
	@maDeTai nvarchar(1000),
	@chuNhiemDeTai int,
	@coQuanChuTri nvarchar(1000),
	@thucHienTuNgay date,
	@thucHienDenNgay date,
	@kinhPhiNhoNhat money,
	@kinhPhiLonNhat money
AS
BEGIN
	SET NOCOUNT ON;

	IF @tenDeTai IS NOT NULL
	BEGIN
		SELECT DKDT.DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,KinhPhiThucHien,CoQuanChuTri,MaCanBoThucHien,HoTen,TrangThaiDeTai,BS.BoSungSuaDoiID
		FROM DANGKYDETAI DKDT 
		INNER JOIN FREETEXTTABLE(DANGKYDETAI,TenDeTai,@tenDeTai) as FTS_DKDT
		ON DKDT.DeTaiID = FTS_DKDT.[KEY]
		INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
		INNER JOIN XETDUYETDETAI_BOSUNGSUADOI BS ON BS.DeTaiID = DKDT.DeTaiID
		AND (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
		AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
		AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
		AND (DKDT.KinhPhiThucHien >= @kinhPhiNhoNhat OR @kinhPhiNhoNhat IS NULL)
		AND (DKDT.KinhPhiThucHien <= @kinhPhiLonNhat OR @kinhPhiLonNhat IS NULL)
		AND (CONVERT(DATE,DKDT.ThucHienTuNgay,105) >= CONVERT(DATE,@thucHienTuNgay,105) OR @thucHienTuNgay IS NULL )
		AND (CONVERT(DATE,DKDT.ThucHienDenNgay,105) <= CONVERT(DATE,@thucHienDenNgay,105) OR @thucHienDenNgay IS NULL  )
	END
	ELSE
	BEGIN
		SELECT DKDT.DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,KinhPhiThucHien,CoQuanChuTri,MaCanBoThucHien,HoTen,TrangThaiDeTai,BS.BoSungSuaDoiID
		FROM DANGKYDETAI DKDT 		
		INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
		INNER JOIN XETDUYETDETAI_BOSUNGSUADOI BS ON BS.DeTaiID = DKDT.DeTaiID
		WHERE (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
		AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
		AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
		AND (DKDT.KinhPhiThucHien >= @kinhPhiNhoNhat OR @kinhPhiNhoNhat IS NULL)
		AND (DKDT.KinhPhiThucHien <= @kinhPhiLonNhat OR @kinhPhiLonNhat IS NULL)
		AND (CONVERT(DATE,DKDT.ThucHienTuNgay,105) >= CONVERT(DATE,@thucHienTuNgay,105) OR @thucHienTuNgay IS NULL )
		AND (CONVERT(DATE,DKDT.ThucHienDenNgay,105) <= CONVERT(DATE,@thucHienDenNgay,105) OR @thucHienDenNgay IS NULL  )
	END
END
GO
PRINT N'Creating [dbo].[proc_Search_DangKyCapQuanLy]...';


GO
CREATE PROCEDURE [dbo].[proc_Search_DangKyCapQuanLy]
	@tenDeTai nvarchar(1000),
	@maDeTai nvarchar(1000),
	@chuNhiemDeTai int,
	@coQuanChuTri nvarchar(1000),
	@thucHienTuNgay date,
	@thucHienDenNgay date,
	@kinhPhiNhoNhat money,
	@kinhPhiLonNhat money
AS
BEGIN
	SET NOCOUNT ON;

	IF @tenDeTai IS NOT NULL
	BEGIN
		SELECT DKDT.DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,KinhPhiThucHien,CoQuanChuTri,MaCanBoThucHien,HoTen,TrangThaiDeTai,DK.DangKyCapQuanLyID
		FROM DANGKYDETAI DKDT 
		INNER JOIN FREETEXTTABLE(DANGKYDETAI,TenDeTai,@tenDeTai) as FTS_DKDT
		ON DKDT.DeTaiID = FTS_DKDT.[KEY]
		INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
		INNER JOIN XETDUYETDETAI_DANGKYCAPQUANLY DK ON DK.DeTaiID = DKDT.DeTaiID
		AND (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
		AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
		AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
		AND (DKDT.KinhPhiThucHien >= @kinhPhiNhoNhat OR @kinhPhiNhoNhat IS NULL)
		AND (DKDT.KinhPhiThucHien <= @kinhPhiLonNhat OR @kinhPhiLonNhat IS NULL)
		AND (CONVERT(DATE,DKDT.ThucHienTuNgay,105) >= CONVERT(DATE,@thucHienTuNgay,105) OR @thucHienTuNgay IS NULL )
		AND (CONVERT(DATE,DKDT.ThucHienDenNgay,105) <= CONVERT(DATE,@thucHienDenNgay,105) OR @thucHienDenNgay IS NULL  )
	END
	ELSE
	BEGIN
		SELECT DKDT.DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,KinhPhiThucHien,CoQuanChuTri,MaCanBoThucHien,HoTen,TrangThaiDeTai,DK.DangKyCapQuanLyID
		FROM DANGKYDETAI DKDT 		
		INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
		INNER JOIN XETDUYETDETAI_DANGKYCAPQUANLY DK ON DK.DeTaiID = DKDT.DeTaiID
		WHERE (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
		AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
		AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
		AND (DKDT.KinhPhiThucHien >= @kinhPhiNhoNhat OR @kinhPhiNhoNhat IS NULL)
		AND (DKDT.KinhPhiThucHien <= @kinhPhiLonNhat OR @kinhPhiLonNhat IS NULL)
		AND (CONVERT(DATE,DKDT.ThucHienTuNgay,105) >= CONVERT(DATE,@thucHienTuNgay,105) OR @thucHienTuNgay IS NULL )
		AND (CONVERT(DATE,DKDT.ThucHienDenNgay,105) <= CONVERT(DATE,@thucHienDenNgay,105) OR @thucHienDenNgay IS NULL  )
	END
END
GO
PRINT N'Creating [dbo].[proc_Search_DangKyDeTai]...';


GO
CREATE PROCEDURE [dbo].[proc_Search_DangKyDeTai]
	@tenDeTai nvarchar(1000),
	@maDeTai nvarchar(1000),
	@chuNhiemDeTai int,
	@coQuanChuTri nvarchar(1000),
	@thucHienTuNgay date,
	@thucHienDenNgay date,
	@kinhPhiNhoNhat money,
	@kinhPhiLonNhat money
AS
BEGIN
	SET NOCOUNT ON;

	IF @tenDeTai IS NOT NULL
	BEGIN
		SELECT DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,KinhPhiThucHien,CoQuanChuTri,MaCanBoThucHien,HoTen,TrangThaiDeTai
		FROM DANGKYDETAI DKDT 
		INNER JOIN FREETEXTTABLE(DANGKYDETAI,TenDeTai,@tenDeTai) as FTS_DKDT
		ON DKDT.DeTaiID = FTS_DKDT.[KEY]
		INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
		AND (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
		AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
		AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
		AND (DKDT.KinhPhiThucHien >= @kinhPhiNhoNhat OR @kinhPhiNhoNhat IS NULL)
		AND (DKDT.KinhPhiThucHien <= @kinhPhiLonNhat OR @kinhPhiLonNhat IS NULL)
		AND (CONVERT(DATE,DKDT.ThucHienTuNgay,105) >= CONVERT(DATE,@thucHienTuNgay,105) OR @thucHienTuNgay IS NULL )
		AND (CONVERT(DATE,DKDT.ThucHienDenNgay,105) <= CONVERT(DATE,@thucHienDenNgay,105) OR @thucHienDenNgay IS NULL  )
	END
	ELSE
	BEGIN
		SELECT DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,KinhPhiThucHien,CoQuanChuTri,MaCanBoThucHien,HoTen,TrangThaiDeTai
		FROM DANGKYDETAI DKDT 		
		INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
		WHERE (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
		AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
		AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
		AND (DKDT.KinhPhiThucHien >= @kinhPhiNhoNhat OR @kinhPhiNhoNhat IS NULL)
		AND (DKDT.KinhPhiThucHien <= @kinhPhiLonNhat OR @kinhPhiLonNhat IS NULL)
		AND (CONVERT(DATE,DKDT.ThucHienTuNgay,105) >= CONVERT(DATE,@thucHienTuNgay,105) OR @thucHienTuNgay IS NULL )
		AND (CONVERT(DATE,DKDT.ThucHienDenNgay,105) <= CONVERT(DATE,@thucHienDenNgay,105) OR @thucHienDenNgay IS NULL  )
	END
END
GO
PRINT N'Creating [dbo].[proc_Search_DeNghiDieuChinhNoiDung]...';


GO
CREATE PROCEDURE [dbo].[proc_Search_DeNghiDieuChinhNoiDung]
	@tenDeTai nvarchar(1000),
	@maDeTai nvarchar(1000),
	@chuNhiemDeTai int,
	@coQuanChuTri nvarchar(1000),
	@ngayDeNghi date,
	@loaiDieuChinh int
AS
BEGIN
	SET NOCOUNT ON;

	IF @tenDeTai IS NOT NULL
	BEGIN
		SELECT DISTINCT(DC.DeNghiDieuChinhNoiDungID),DKDT.DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,KinhPhiThucHien,CoQuanChuTri,MaCanBoThucHien,HoTen,TrangThaiDeTai
		FROM DANGKYDETAI DKDT 
		INNER JOIN FREETEXTTABLE(DANGKYDETAI,TenDeTai,@tenDeTai) as FTS_DKDT
		ON DKDT.DeTaiID = FTS_DKDT.[KEY]
		INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
		INNER JOIN THUCHIENDETAI_DENGHIDIEUCHINHNOIDUNG DC ON DC.DeTaiID = DKDT.DeTaiID
		--LEFT JOIN : TRƯỜNG HỢP KHÔNG CÓ CHI TIET VAN LAY DUOC DU LIEU
		LEFT JOIN THUCHIENDETAI_DENGHIDIEUCHINHNOIDUNG_CHITIET CT ON CT.DeNghiDieuChinhNoiDungID = DC.DeNghiDieuChinhNoiDungID
		AND (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
		AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
		AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
		AND (CT.NgayDeNghi = @ngayDeNghi OR @ngayDeNghi IS NULL)
		AND (CT.LoaiDieuChinh = @loaiDieuChinh OR @loaiDieuChinh IS NULL)

	END
	ELSE
	BEGIN
		SELECT DISTINCT(DC.DeNghiDieuChinhNoiDungID),DKDT.DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,KinhPhiThucHien,CoQuanChuTri,MaCanBoThucHien,HoTen,TrangThaiDeTai
		FROM DANGKYDETAI DKDT 		
		INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
		INNER JOIN THUCHIENDETAI_DENGHIDIEUCHINHNOIDUNG DC ON DC.DeTaiID = DKDT.DeTaiID
		LEFT JOIN THUCHIENDETAI_DENGHIDIEUCHINHNOIDUNG_CHITIET CT ON CT.DeNghiDieuChinhNoiDungID = DC.DeNghiDieuChinhNoiDungID
		WHERE (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
		AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
		AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
		AND (CT.NgayDeNghi = @ngayDeNghi OR @ngayDeNghi IS NULL)
		AND (CT.LoaiDieuChinh = @loaiDieuChinh OR @loaiDieuChinh IS NULL)
	END
END
GO
PRINT N'Creating [dbo].[proc_Search_DeNghiGiaHan]...';


GO
CREATE PROCEDURE [dbo].[proc_Search_DeNghiGiaHan]
	@tenDeTai nvarchar(1000),
	@maDeTai nvarchar(1000),
	@chuNhiemDeTai int,
	@coQuanChuTri nvarchar(1000),
	@ngayDeNghi date,
	@ketQuaDeNghiGiaHan int
AS
BEGIN
	SET NOCOUNT ON;

	IF @ketQuaDeNghiGiaHan IS NULL
		SET @ketQuaDeNghiGiaHan = 30

	IF @tenDeTai IS NOT NULL
	BEGIN		
		IF @ketQuaDeNghiGiaHan = 30
			SELECT DISTINCT(GH.DeNghiGiaHanID),DKDT.DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,KinhPhiThucHien,CoQuanChuTri,MaCanBoThucHien,HoTen,TrangThaiDeTai
			FROM DANGKYDETAI DKDT 
			INNER JOIN FREETEXTTABLE(DANGKYDETAI,TenDeTai,@tenDeTai) as FTS_DKDT
			ON DKDT.DeTaiID = FTS_DKDT.[KEY]
			INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
			INNER JOIN THUCHIENDETAI_DENGHIGIAHAN GH ON GH.DeTaiID = DKDT.DeTaiID
			--LEFT JOIN : TRƯỜNG HỢP KHÔNG CÓ CHI TIET VAN LAY DUOC DU LIEU
			LEFT JOIN THUCHIENDETAI_DENGHIGIAHAN_CHITIET CT ON CT.DeNghiGiaHanID = GH.DeNghiGiaHanID
			AND (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
			AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
			AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
			AND (CT.NgayDeNghiGiaHan = @ngayDeNghi OR @ngayDeNghi IS NULL)
		IF @ketQuaDeNghiGiaHan = 20
			SELECT DISTINCT(GH.DeNghiGiaHanID),DKDT.DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,KinhPhiThucHien,CoQuanChuTri,MaCanBoThucHien,HoTen,TrangThaiDeTai
			FROM DANGKYDETAI DKDT 
			INNER JOIN FREETEXTTABLE(DANGKYDETAI,TenDeTai,@tenDeTai) as FTS_DKDT
			ON DKDT.DeTaiID = FTS_DKDT.[KEY]
			INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
			INNER JOIN THUCHIENDETAI_DENGHIGIAHAN GH ON GH.DeTaiID = DKDT.DeTaiID
			LEFT JOIN THUCHIENDETAI_DENGHIGIAHAN_CHITIET CT ON CT.DeNghiGiaHanID = GH.DeNghiGiaHanID
			AND (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
			AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
			AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
			AND (CT.NgayDeNghiGiaHan = @ngayDeNghi OR @ngayDeNghi IS NULL)
			AND (CT.KetQuaDeNghiGiaHan = 0)
		IF @ketQuaDeNghiGiaHan = 10
			SELECT DISTINCT(GH.DeNghiGiaHanID),DKDT.DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,KinhPhiThucHien,CoQuanChuTri,MaCanBoThucHien,HoTen,TrangThaiDeTai
			FROM DANGKYDETAI DKDT 
			INNER JOIN FREETEXTTABLE(DANGKYDETAI,TenDeTai,@tenDeTai) as FTS_DKDT
			ON DKDT.DeTaiID = FTS_DKDT.[KEY]
			INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
			INNER JOIN THUCHIENDETAI_DENGHIGIAHAN GH ON GH.DeTaiID = DKDT.DeTaiID
			LEFT JOIN THUCHIENDETAI_DENGHIGIAHAN_CHITIET CT ON CT.DeNghiGiaHanID = GH.DeNghiGiaHanID
			AND (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
			AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
			AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
			AND (CT.NgayDeNghiGiaHan = @ngayDeNghi OR @ngayDeNghi IS NULL)
			AND (CT.KetQuaDeNghiGiaHan = 1)
	END
	ELSE
	BEGIN		
		IF @ketQuaDeNghiGiaHan = 30
			SELECT DISTINCT(GH.DeNghiGiaHanID),DKDT.DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,KinhPhiThucHien,CoQuanChuTri,MaCanBoThucHien,HoTen,TrangThaiDeTai
			FROM DANGKYDETAI DKDT 			
			INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
			INNER JOIN THUCHIENDETAI_DENGHIGIAHAN GH ON GH.DeTaiID = DKDT.DeTaiID
			LEFT JOIN THUCHIENDETAI_DENGHIGIAHAN_CHITIET CT ON CT.DeNghiGiaHanID = GH.DeNghiGiaHanID
			WHERE (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
			AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
			AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
			AND (CT.NgayDeNghiGiaHan = @ngayDeNghi OR @ngayDeNghi IS NULL)
		IF @ketQuaDeNghiGiaHan = 20
			SELECT DISTINCT(GH.DeNghiGiaHanID),DKDT.DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,KinhPhiThucHien,CoQuanChuTri,MaCanBoThucHien,HoTen,TrangThaiDeTai
				FROM DANGKYDETAI DKDT 			
				INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
				INNER JOIN THUCHIENDETAI_DENGHIGIAHAN GH ON GH.DeTaiID = DKDT.DeTaiID
				LEFT JOIN THUCHIENDETAI_DENGHIGIAHAN_CHITIET CT ON CT.DeNghiGiaHanID = GH.DeNghiGiaHanID
				WHERE (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
				AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
				AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
				AND (CT.NgayDeNghiGiaHan = @ngayDeNghi OR @ngayDeNghi IS NULL)
				AND (ct.KetQuaDeNghiGiaHan = 0)
		IF @ketQuaDeNghiGiaHan = 10
			SELECT DISTINCT(GH.DeNghiGiaHanID),DKDT.DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,KinhPhiThucHien,CoQuanChuTri,MaCanBoThucHien,HoTen,TrangThaiDeTai
				FROM DANGKYDETAI DKDT 			
				INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
				INNER JOIN THUCHIENDETAI_DENGHIGIAHAN GH ON GH.DeTaiID = DKDT.DeTaiID
				LEFT JOIN THUCHIENDETAI_DENGHIGIAHAN_CHITIET CT ON CT.DeNghiGiaHanID = GH.DeNghiGiaHanID
				WHERE (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
				AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
				AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
				AND (CT.NgayDeNghiGiaHan = @ngayDeNghi OR @ngayDeNghi IS NULL)
				AND (ct.KetQuaDeNghiGiaHan = 1)
	END
END
GO
PRINT N'Creating [dbo].[proc_Search_DeNghiNghiemThuCapCoSo]...';


GO
CREATE PROCEDURE [dbo].[proc_Search_DeNghiNghiemThuCapCoSo]
	@tenDeTai nvarchar(1000),
	@maDeTai nvarchar(1000),
	@chuNhiemDeTai int,
	@ngayDeNghi date
AS
BEGIN
	SET NOCOUNT ON;

	IF @tenDeTai IS NOT NULL
	BEGIN
		SELECT DN.DeNghiNghiemThuCapCoSoID,DN.NgayDeNghi,DKDT.DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,MaCanBoThucHien,HoTen,TrangThaiDeTai
		FROM DANGKYDETAI DKDT 
		INNER JOIN FREETEXTTABLE(DANGKYDETAI,TenDeTai,@tenDeTai) as FTS_DKDT
		ON DKDT.DeTaiID = FTS_DKDT.[KEY]
		INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
		INNER JOIN NGHIEMTHU_DENGHICAPCOSO DN ON DN.DeTaiID = DKDT.DeTaiID		
		AND (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
		AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
		AND (DN.NgayDeNghi = @ngayDeNghi OR @ngayDeNghi IS NULL)

	END
	ELSE
	BEGIN
		SELECT DN.DeNghiNghiemThuCapCoSoID,DN.NgayDeNghi,DKDT.DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,MaCanBoThucHien,HoTen,TrangThaiDeTai
		FROM DANGKYDETAI DKDT 		
		INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
		INNER JOIN NGHIEMTHU_DENGHICAPCOSO DN ON DN.DeTaiID = DKDT.DeTaiID	
		WHERE (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
		AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
		AND (DN.NgayDeNghi = @ngayDeNghi OR @ngayDeNghi IS NULL)
	END

END
GO
PRINT N'Creating [dbo].[proc_Search_DeNghiNghiemThuCapQuanLy]...';


GO
CREATE PROCEDURE [dbo].[proc_Search_DeNghiNghiemThuCapQuanLy]
	@tenDeTai nvarchar(1000),
	@maDeTai nvarchar(1000),
	@chuNhiemDeTai int,
	@ngayDeNghi date
AS
BEGIN
	SET NOCOUNT ON;

	IF @tenDeTai IS NOT NULL
	BEGIN
		SELECT DN.DeNghiNghiemThuCapQuanLyID,DN.NgayDeNghi,DKDT.DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,MaCanBoThucHien,HoTen,TrangThaiDeTai
		FROM DANGKYDETAI DKDT 
		INNER JOIN FREETEXTTABLE(DANGKYDETAI,TenDeTai,@tenDeTai) as FTS_DKDT
		ON DKDT.DeTaiID = FTS_DKDT.[KEY]
		INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
		INNER JOIN NGHIEMTHU_DENGHICAPQUANLY DN ON DN.DeTaiID = DKDT.DeTaiID		
		AND (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
		AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
		AND (DN.NgayDeNghi = @ngayDeNghi OR @ngayDeNghi IS NULL)

	END
	ELSE
	BEGIN
		SELECT DN.DeNghiNghiemThuCapQuanLyID,DN.NgayDeNghi,DKDT.DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,MaCanBoThucHien,HoTen,TrangThaiDeTai
		FROM DANGKYDETAI DKDT 		
		INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
		INNER JOIN NGHIEMTHU_DENGHICAPQUANLY DN ON DN.DeTaiID = DKDT.DeTaiID	
		WHERE (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
		AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
		AND (DN.NgayDeNghi = @ngayDeNghi OR @ngayDeNghi IS NULL)
	END

END
GO
PRINT N'Creating [dbo].[proc_Search_GhiNhanKetQuaXetDuyet]...';


GO
CREATE PROCEDURE [dbo].[proc_Search_GhiNhanKetQuaXetDuyet]
	@ketQuaXetDuyet int,
	@maDeTai nvarchar(1000),
	@tenDeTai nvarchar(1000)
AS
BEGIN
	SET NOCOUNT ON;

	IF @tenDeTai is not null
	begin
		if @ketQuaXetDuyet = 30
		begin
			select dt.DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,KinhPhiThucHien,CoQuanChuTri,cbth.MaCanBoThucHien,cbth.HoTen,TrangThaiDeTai,gnkq.GhiNhanKetQuaID
			from DANGKYDETAI dt 
			inner join freetexttable(DANGKYDETAI,TenDeTai,@tenDeTai) as FTS_DKDT on dt.DeTaiID = FTS_DKDT.[KEY]
			inner join XETDUYETDETAI_GHINHANKETQUA gnkq on gnkq.DeTaiID = dt.DeTaiID
			inner join DANHMUC_CANBOTHUCHIEN cbth on cbth.CanBoThucHienID = dt.ChuNhiemDeTaiID
			inner join XETDUYETDETAI_HOIDONGDAODUC hddd on hddd.DeTaiID = dt.DeTaiID
			AND (UPPER(LTRIM(RTRIM(dt.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL) 

		end

		if @ketQuaXetDuyet = 20
		begin
			select dt.DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,KinhPhiThucHien,CoQuanChuTri,cbth.MaCanBoThucHien,cbth.HoTen,TrangThaiDeTai,gnkq.GhiNhanKetQuaID
			from DANGKYDETAI dt 
			inner join freetexttable(DANGKYDETAI,TenDeTai,@tenDeTai) as FTS_DKDT on dt.DeTaiID = FTS_DKDT.[KEY]
			inner join XETDUYETDETAI_GHINHANKETQUA gnkq on gnkq.DeTaiID = dt.DeTaiID
			inner join DANHMUC_CANBOTHUCHIEN cbth on cbth.CanBoThucHienID = dt.ChuNhiemDeTaiID
			inner join XETDUYETDETAI_HOIDONGDAODUC hddd on hddd.DeTaiID = dt.DeTaiID
			AND (UPPER(LTRIM(RTRIM(dt.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)
			AND (hddd.CoChinhSuaBoSung = 0 OR hddd.CoChinhSuaBoSung IS NULL)
		end

		if @ketQuaXetDuyet = 10
		begin
			select dt.DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,KinhPhiThucHien,CoQuanChuTri,cbth.MaCanBoThucHien,cbth.HoTen,TrangThaiDeTai,gnkq.GhiNhanKetQuaID
			from DANGKYDETAI dt 
			inner join freetexttable(DANGKYDETAI,TenDeTai,@tenDeTai) as FTS_DKDT on dt.DeTaiID = FTS_DKDT.[KEY]
			inner join XETDUYETDETAI_GHINHANKETQUA gnkq on gnkq.DeTaiID = dt.DeTaiID
			inner join DANHMUC_CANBOTHUCHIEN cbth on cbth.CanBoThucHienID = dt.ChuNhiemDeTaiID
			inner join XETDUYETDETAI_HOIDONGDAODUC hddd on hddd.DeTaiID = dt.DeTaiID
			AND (UPPER(LTRIM(RTRIM(dt.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)
			AND (hddd.CoChinhSuaBoSung = 1 OR hddd.CoChinhSuaBoSung IS NULL)
		end
	end
	ELSE
	begin
		if @ketQuaXetDuyet = 30
			begin
			select dt.DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,KinhPhiThucHien,CoQuanChuTri,cbth.MaCanBoThucHien,cbth.HoTen,TrangThaiDeTai,gnkq.GhiNhanKetQuaID
			from DANGKYDETAI dt 
			inner join XETDUYETDETAI_GHINHANKETQUA gnkq on gnkq.DeTaiID = dt.DeTaiID
			inner join DANHMUC_CANBOTHUCHIEN cbth on cbth.CanBoThucHienID = dt.ChuNhiemDeTaiID
			inner join XETDUYETDETAI_HOIDONGDAODUC hddd on hddd.DeTaiID = dt.DeTaiID
			where
			(UPPER(LTRIM(RTRIM(dt.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL) 
		end

		if @ketQuaXetDuyet = 20
			begin
			select dt.DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,KinhPhiThucHien,CoQuanChuTri,cbth.MaCanBoThucHien,cbth.HoTen,TrangThaiDeTai,gnkq.GhiNhanKetQuaID
			from DANGKYDETAI dt 
			inner join XETDUYETDETAI_GHINHANKETQUA gnkq on gnkq.DeTaiID = dt.DeTaiID
			inner join DANHMUC_CANBOTHUCHIEN cbth on cbth.CanBoThucHienID = dt.ChuNhiemDeTaiID
			inner join XETDUYETDETAI_HOIDONGDAODUC hddd on hddd.DeTaiID = dt.DeTaiID
			where
			(UPPER(LTRIM(RTRIM(dt.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)
			AND (hddd.CoChinhSuaBoSung = 0 OR hddd.CoChinhSuaBoSung IS NULL)
		end

		if @ketQuaXetDuyet = 10
			begin
			select dt.DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,KinhPhiThucHien,CoQuanChuTri,cbth.MaCanBoThucHien,cbth.HoTen,TrangThaiDeTai,gnkq.GhiNhanKetQuaID
			from DANGKYDETAI dt 
			inner join XETDUYETDETAI_GHINHANKETQUA gnkq on gnkq.DeTaiID = dt.DeTaiID
			inner join DANHMUC_CANBOTHUCHIEN cbth on cbth.CanBoThucHienID = dt.ChuNhiemDeTaiID
			inner join XETDUYETDETAI_HOIDONGDAODUC hddd on hddd.DeTaiID = dt.DeTaiID
			where
			(UPPER(LTRIM(RTRIM(dt.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)
			AND (hddd.CoChinhSuaBoSung = 1 OR hddd.CoChinhSuaBoSung IS NULL)
		end
	end
END
GO
PRINT N'Creating [dbo].[proc_Search_GiamSatDeTai]...';


GO
CREATE PROCEDURE [dbo].[proc_Search_GiamSatDeTai]
	@maDeTai nvarchar(1000),
	@tenDeTai nvarchar(1000),
	@ngayThucHienGS date,
	@chuNhiemDeTai nvarchar(1000)
AS
BEGIN
	SET NOCOUNT ON;

	IF (@tenDeTai IS NOT NULL)
	BEGIN 
		SELECT  distinct(GT.GiamSatKiemTraID), MaDeTai, TenDeTai, TrangThaiDeTaiBenNgoai
								, GT.DeTaiBenNgoaiID, GT.NgayThucHienGS,  ChuNhiemDeTai
		FROM FREETEXTTABLE(DETAIBENNGOAI_NHANYEUCAU,TenDeTai,@tenDeTai) as FTS_DKDT
		INNER JOIN DETAIBENNGOAI_NHANYEUCAU NYC ON NYC.DeTaiBenNgoaiID = FTS_DKDT.[KEY]
		INNER JOIN DETAIBENNGOAI_GIAMSATKIEMTRA GT ON GT.DeTaiBenNgoaiID = NYC.DeTaiBenNgoaiID
		AND (UPPER(LTRIM(RTRIM(NYC.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  
		AND (UPPER(LTRIM(RTRIM(NYC.ChuNhiemDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@chuNhiemDeTai)))+'%' OR @chuNhiemDeTai IS NULL)  
		AND (GT.NgayThucHienGS = @ngayThucHienGS OR @ngayThucHienGS IS NULL)
	END
	ELSE
	BEGIN
		SELECT  distinct(GT.GiamSatKiemTraID), MaDeTai, TenDeTai, TrangThaiDeTaiBenNgoai
								, GT.DeTaiBenNgoaiID, GT.NgayThucHienGS,  ChuNhiemDeTai
		FROM DETAIBENNGOAI_NHANYEUCAU NYC
		INNER JOIN DETAIBENNGOAI_GIAMSATKIEMTRA GT ON GT.DeTaiBenNgoaiID = NYC.DeTaiBenNgoaiID
		WHERE (UPPER(LTRIM(RTRIM(NYC.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  
		AND (UPPER(LTRIM(RTRIM(NYC.ChuNhiemDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@chuNhiemDeTai)))+'%' OR @chuNhiemDeTai IS NULL)  
		AND (GT.NgayThucHienGS = @ngayThucHienGS OR @ngayThucHienGS IS NULL)
	END
END
GO
PRINT N'Creating [dbo].[proc_Search_GiayGioiThieu]...';


GO
CREATE PROCEDURE [dbo].[proc_Search_GiayGioiThieu]
	@tenDeTai nvarchar(1000),
	@maDeTai nvarchar(1000),
	@thoiGianLaySoLieuTu date,
	@thoiGianLaySoLieuDen date,
	@dmKhoaPhongID int
AS
BEGIN
	SET NOCOUNT ON;

	IF (@tenDeTai IS NOT NULL)
	BEGIN 
		SELECT TenKhoaPhong, MaDeTai, TenDeTai, TrangThaiDeTaiBenNgoai, ThoiGianLaySoLieu_Tu, ThoiGianLaySoLieu_Den, LamGiayGioiThieuID, GT.DeTaiBenNgoaiID, GT.DMKhoaPhongID
		FROM FREETEXTTABLE(DETAIBENNGOAI_NHANYEUCAU,TenDeTai,@tenDeTai) as FTS_DKDT
		INNER JOIN DETAIBENNGOAI_NHANYEUCAU NYC ON NYC.DeTaiBenNgoaiID = FTS_DKDT.[KEY]
		INNER JOIN DETAIBENNGOAI_LAMGIAYGIOITHIEU GT ON GT.DeTaiBenNgoaiID = NYC.DeTaiBenNgoaiID
		INNER JOIN DANHMUC_KHOAPHONG KO ON GT.DMKhoaPhongID = KO.DMKhoaPhongID  
		AND (UPPER(LTRIM(RTRIM(NYC.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
		AND (ThoiGianLaySoLieu_Tu = @thoiGianLaySoLieuTu OR @thoiGianLaySoLieuTu IS NULL)
		AND (ThoiGianLaySoLieu_Den = @thoiGianLaySoLieuDen OR @thoiGianLaySoLieuDen IS NULL)
		AND (GT.DMKhoaPhongID = @dmKhoaPhongID OR @dmKhoaPhongID IS NULL)
	END
	ELSE
	BEGIN
		SELECT TenKhoaPhong, MaDeTai, TenDeTai, TrangThaiDeTaiBenNgoai, ThoiGianLaySoLieu_Tu, ThoiGianLaySoLieu_Den, LamGiayGioiThieuID, GT.DMKhoaPhongID, GT.DeTaiBenNgoaiID
		FROM DETAIBENNGOAI_NHANYEUCAU NYC
		INNER JOIN DETAIBENNGOAI_LAMGIAYGIOITHIEU GT ON GT.DeTaiBenNgoaiID = NYC.DeTaiBenNgoaiID
		INNER JOIN DANHMUC_KHOAPHONG KO ON GT.DMKhoaPhongID = KO.DMKhoaPhongID  
		WHERE (UPPER(LTRIM(RTRIM(NYC.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
		AND (ThoiGianLaySoLieu_Tu = @thoiGianLaySoLieuTu OR @thoiGianLaySoLieuTu IS NULL)
		AND (ThoiGianLaySoLieu_Den = @thoiGianLaySoLieuDen OR @thoiGianLaySoLieuDen IS NULL)
		AND (GT.DMKhoaPhongID = @dmKhoaPhongID OR @dmKhoaPhongID IS NULL)
	END
END
GO
PRINT N'Creating [dbo].[proc_Search_KiemTraGiamSat]...';


GO
CREATE PROCEDURE [dbo].[proc_Search_KiemTraGiamSat]
	@tenDeTai nvarchar(1000),
	@maDeTai nvarchar(1000),
	@chuNhiemDeTai int,
	@coQuanChuTri nvarchar(1000),
	@ngayKiemTra date
AS
BEGIN
	SET NOCOUNT ON;

	IF @tenDeTai IS NOT NULL
	BEGIN
		SELECT DISTINCT(KT.KiemTraGiamSatID),DKDT.DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,KinhPhiThucHien,CoQuanChuTri,MaCanBoThucHien,HoTen,TrangThaiDeTai
		FROM DANGKYDETAI DKDT 
		INNER JOIN FREETEXTTABLE(DANGKYDETAI,TenDeTai,@tenDeTai) as FTS_DKDT
		ON DKDT.DeTaiID = FTS_DKDT.[KEY]
		INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
		INNER JOIN THUCHIENDETAI_KIEMTRAGIAMSAT KT ON KT.DeTaiID = DKDT.DeTaiID
		LEFT JOIN THUCHIENDETAI_KIEMTRAGIAMSAT_CHITIET CT ON CT.KiemTraGiamSatID = KT.KiemTraGiamSatID
		--LEFT JOIN : TRƯỜNG HỢP KHÔNG CÓ CHI TIET VAN LAY DUOC DU LIEU		
		AND (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
		AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
		AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
		AND (CT.NgayKiemTra = @ngayKiemTra OR @ngayKiemTra IS NULL)
	END
	ELSE
	BEGIN
		SELECT DISTINCT(KT.KiemTraGiamSatID),DKDT.DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,KinhPhiThucHien,CoQuanChuTri,MaCanBoThucHien,HoTen,TrangThaiDeTai
		FROM DANGKYDETAI DKDT 		
		INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
		INNER JOIN THUCHIENDETAI_KIEMTRAGIAMSAT KT ON KT.DeTaiID = DKDT.DeTaiID
		LEFT JOIN THUCHIENDETAI_KIEMTRAGIAMSAT_CHITIET CT ON CT.KiemTraGiamSatID = KT.KiemTraGiamSatID
		WHERE (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
		AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
		AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
		AND (CT.NgayKiemTra = @ngayKiemTra OR @ngayKiemTra IS NULL)
	END
END
GO
PRINT N'Creating [dbo].[proc_Search_NghiemThuCapCoSo]...';


GO
CREATE PROCEDURE [dbo].[proc_Search_NghiemThuCapCoSo]
	@tenDeTai nvarchar(1000),
	@maDeTai nvarchar(1000),
	@chuNhiemDeTai int,
	@coQuanChuTri nvarchar(1000),
	@ngayBaoVe date,
	@ketQuaNghiemThu int
AS
BEGIN
	SET NOCOUNT ON;

	IF @ketQuaNghiemThu IS NULL
		SET @ketQuaNghiemThu = 30

	IF @tenDeTai IS NOT NULL
	BEGIN		
		IF @ketQuaNghiemThu = 30
			SELECT NT.NghiemThuDeTaiCapCoSoID,DKDT.DeTaiID,MaDeTai,TenDeTai,MaCanBoThucHien,HoTen,TrangThaiDeTai,NgayBaoVeBaoCaoNghiemThu,KetQuaDeTai,KetQuaNghiemThuCapCoSo,CoChinhSuaBoSung
			FROM DANGKYDETAI DKDT 
			INNER JOIN FREETEXTTABLE(DANGKYDETAI,TenDeTai,@tenDeTai) as FTS_DKDT
			ON DKDT.DeTaiID = FTS_DKDT.[KEY]
			INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
			INNER JOIN NGHIEMTHU_NGHIEMTHUDETAICAPCOSO NT ON NT.DeTaiID = DKDT.DeTaiID
			AND (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
			AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
			AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
			AND (NT.NgayBaoVeBaoCaoNghiemThu = @ngayBaoVe OR @ngayBaoVe IS NULL)
		IF @ketQuaNghiemThu = 20
			SELECT NT.NghiemThuDeTaiCapCoSoID,DKDT.DeTaiID,MaDeTai,TenDeTai,MaCanBoThucHien,HoTen,TrangThaiDeTai,NgayBaoVeBaoCaoNghiemThu,KetQuaDeTai,KetQuaNghiemThuCapCoSo,CoChinhSuaBoSung
			FROM DANGKYDETAI DKDT 
			INNER JOIN FREETEXTTABLE(DANGKYDETAI,TenDeTai,@tenDeTai) as FTS_DKDT
			ON DKDT.DeTaiID = FTS_DKDT.[KEY]
			INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
			INNER JOIN NGHIEMTHU_NGHIEMTHUDETAICAPCOSO NT ON NT.DeTaiID = DKDT.DeTaiID
			AND (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
			AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
			AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
			AND (NT.NgayBaoVeBaoCaoNghiemThu = @ngayBaoVe OR @ngayBaoVe IS NULL)
			AND (NT.KetQuaNghiemThuCapCoSo = 0)
		IF @ketQuaNghiemThu = 10
			SELECT NT.NghiemThuDeTaiCapCoSoID,DKDT.DeTaiID,MaDeTai,TenDeTai,MaCanBoThucHien,HoTen,TrangThaiDeTai,NgayBaoVeBaoCaoNghiemThu,KetQuaDeTai,KetQuaNghiemThuCapCoSo,CoChinhSuaBoSung
			FROM DANGKYDETAI DKDT 
			INNER JOIN FREETEXTTABLE(DANGKYDETAI,TenDeTai,@tenDeTai) as FTS_DKDT
			ON DKDT.DeTaiID = FTS_DKDT.[KEY]
			INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
			INNER JOIN NGHIEMTHU_NGHIEMTHUDETAICAPCOSO NT ON NT.DeTaiID = DKDT.DeTaiID
			AND (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
			AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
			AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
			AND (NT.NgayBaoVeBaoCaoNghiemThu = @ngayBaoVe OR @ngayBaoVe IS NULL)
			AND (NT.KetQuaNghiemThuCapCoSo = 1)
	END
	ELSE
	BEGIN		
		IF @ketQuaNghiemThu = 30
			SELECT NT.NghiemThuDeTaiCapCoSoID,DKDT.DeTaiID,MaDeTai,TenDeTai,MaCanBoThucHien,HoTen,TrangThaiDeTai,NgayBaoVeBaoCaoNghiemThu,KetQuaDeTai,KetQuaNghiemThuCapCoSo,CoChinhSuaBoSung
			FROM DANGKYDETAI DKDT 			
			INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
			INNER JOIN NGHIEMTHU_NGHIEMTHUDETAICAPCOSO NT ON NT.DeTaiID = DKDT.DeTaiID
			WHERE (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
			AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
			AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
			AND (NT.NgayBaoVeBaoCaoNghiemThu = @ngayBaoVe OR @ngayBaoVe IS NULL)
		IF @ketQuaNghiemThu = 20
			SELECT NT.NghiemThuDeTaiCapCoSoID,DKDT.DeTaiID,MaDeTai,TenDeTai,MaCanBoThucHien,HoTen,TrangThaiDeTai,NgayBaoVeBaoCaoNghiemThu,KetQuaDeTai,KetQuaNghiemThuCapCoSo,CoChinhSuaBoSung
				FROM DANGKYDETAI DKDT 			
				INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
				INNER JOIN NGHIEMTHU_NGHIEMTHUDETAICAPCOSO NT ON NT.DeTaiID = DKDT.DeTaiID
				WHERE (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
				AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
				AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
				AND (NT.NgayBaoVeBaoCaoNghiemThu = @ngayBaoVe OR @ngayBaoVe IS NULL)
				AND (NT.KetQuaNghiemThuCapCoSo = 0)
		IF @ketQuaNghiemThu = 10
			SELECT NT.NghiemThuDeTaiCapCoSoID,DKDT.DeTaiID,MaDeTai,TenDeTai,MaCanBoThucHien,HoTen,TrangThaiDeTai,NgayBaoVeBaoCaoNghiemThu,KetQuaDeTai,KetQuaNghiemThuCapCoSo,CoChinhSuaBoSung
				FROM DANGKYDETAI DKDT 			
				INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
				INNER JOIN NGHIEMTHU_NGHIEMTHUDETAICAPCOSO NT ON NT.DeTaiID = DKDT.DeTaiID
				WHERE (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
				AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
				AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
				AND (NT.NgayBaoVeBaoCaoNghiemThu = @ngayBaoVe OR @ngayBaoVe IS NULL)
				AND (NT.KetQuaNghiemThuCapCoSo = 1)
	END

END
GO
PRINT N'Creating [dbo].[proc_Search_NghiemThuCapQuanLy]...';


GO
CREATE PROCEDURE [dbo].[proc_Search_NghiemThuCapQuanLy]
	@tenDeTai nvarchar(1000),
	@maDeTai nvarchar(1000),
	@chuNhiemDeTai int,
	@coQuanChuTri nvarchar(1000),
	@ngayNghiemThu date,
	@ketQuaNghiemThu int
AS
BEGIN
	SET NOCOUNT ON;

	IF @ketQuaNghiemThu IS NULL
		SET @ketQuaNghiemThu = 30

	IF @tenDeTai IS NOT NULL
	BEGIN		
		IF @ketQuaNghiemThu = 30
			SELECT NT.NghiemThuDeTaiCapQuanLyID,DKDT.DeTaiID,MaDeTai,TenDeTai,MaCanBoThucHien,HoTen,TrangThaiDeTai,NgayNghiemThu,KetQuaNghiemThuCapQuanLy
			FROM DANGKYDETAI DKDT 
			INNER JOIN FREETEXTTABLE(DANGKYDETAI,TenDeTai,@tenDeTai) as FTS_DKDT
			ON DKDT.DeTaiID = FTS_DKDT.[KEY]
			INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
			INNER JOIN NGHIEMTHU_NGHIEMTHUDETAICAPQUANLY NT ON NT.DeTaiID = DKDT.DeTaiID
			AND (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
			AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
			AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
			AND (NT.NgayNghiemThu = @ngayNghiemThu OR @ngayNghiemThu IS NULL)
		IF @ketQuaNghiemThu = 20
			SELECT NT.NghiemThuDeTaiCapQuanLyID,DKDT.DeTaiID,MaDeTai,TenDeTai,MaCanBoThucHien,HoTen,TrangThaiDeTai,NgayNghiemThu,KetQuaNghiemThuCapQuanLy
			FROM DANGKYDETAI DKDT 
			INNER JOIN FREETEXTTABLE(DANGKYDETAI,TenDeTai,@tenDeTai) as FTS_DKDT
			ON DKDT.DeTaiID = FTS_DKDT.[KEY]
			INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
			INNER JOIN NGHIEMTHU_NGHIEMTHUDETAICAPQUANLY NT ON NT.DeTaiID = DKDT.DeTaiID
			AND (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
			AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
			AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
			AND (NT.NgayNghiemThu = @ngayNghiemThu OR @ngayNghiemThu IS NULL)
			AND (NT.KetQuaNghiemThuCapQuanLy = 0)
		IF @ketQuaNghiemThu = 10
			SELECT NT.NghiemThuDeTaiCapQuanLyID,DKDT.DeTaiID,MaDeTai,TenDeTai,MaCanBoThucHien,HoTen,TrangThaiDeTai,NgayNghiemThu,KetQuaNghiemThuCapQuanLy
			FROM DANGKYDETAI DKDT 
			INNER JOIN FREETEXTTABLE(DANGKYDETAI,TenDeTai,@tenDeTai) as FTS_DKDT
			ON DKDT.DeTaiID = FTS_DKDT.[KEY]
			INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
			INNER JOIN NGHIEMTHU_NGHIEMTHUDETAICAPQUANLY NT ON NT.DeTaiID = DKDT.DeTaiID
			AND (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
			AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
			AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
			AND (NT.NgayNghiemThu = @ngayNghiemThu OR @ngayNghiemThu IS NULL)
			AND (NT.KetQuaNghiemThuCapQuanLy = 1)
	END
	ELSE
	BEGIN		
		IF @ketQuaNghiemThu = 30
			SELECT NT.NghiemThuDeTaiCapQuanLyID,DKDT.DeTaiID,MaDeTai,TenDeTai,MaCanBoThucHien,HoTen,TrangThaiDeTai,NgayNghiemThu,KetQuaNghiemThuCapQuanLy
			FROM DANGKYDETAI DKDT 			
			INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
			INNER JOIN NGHIEMTHU_NGHIEMTHUDETAICAPQUANLY NT ON NT.DeTaiID = DKDT.DeTaiID
			WHERE (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
			AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
			AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
			AND (NT.NgayNghiemThu = @ngayNghiemThu OR @ngayNghiemThu IS NULL)
		IF @ketQuaNghiemThu = 20
			SELECT NT.NghiemThuDeTaiCapQuanLyID,DKDT.DeTaiID,MaDeTai,TenDeTai,MaCanBoThucHien,HoTen,TrangThaiDeTai,NgayNghiemThu,KetQuaNghiemThuCapQuanLy
				FROM DANGKYDETAI DKDT 			
				INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
				INNER JOIN NGHIEMTHU_NGHIEMTHUDETAICAPQUANLY NT ON NT.DeTaiID = DKDT.DeTaiID
				WHERE (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
				AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
				AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
				AND (NT.NgayNghiemThu = @ngayNghiemThu OR @ngayNghiemThu IS NULL)
				AND (NT.KetQuaNghiemThuCapQuanLy = 0)
		IF @ketQuaNghiemThu = 10
			SELECT NT.NghiemThuDeTaiCapQuanLyID,DKDT.DeTaiID,MaDeTai,TenDeTai,MaCanBoThucHien,HoTen,TrangThaiDeTai,NgayNghiemThu,KetQuaNghiemThuCapQuanLy
				FROM DANGKYDETAI DKDT 			
				INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
				INNER JOIN NGHIEMTHU_NGHIEMTHUDETAICAPQUANLY NT ON NT.DeTaiID = DKDT.DeTaiID
				WHERE (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
				AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
				AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
				AND (NT.NgayNghiemThu = @ngayNghiemThu OR @ngayNghiemThu IS NULL)
				AND (NT.KetQuaNghiemThuCapQuanLy = 1)
	END

END
GO
PRINT N'Creating [dbo].[proc_Search_NhanYeuCauLaySoLieu]...';


GO
CREATE PROCEDURE [dbo].[proc_Search_NhanYeuCauLaySoLieu]
	@tenDeTai nvarchar(1000),
	@maDeTai nvarchar(1000),
	@chuNhiemDeTai nvarchar(1000),
	@thucHienTuNgay date,
	@thucHienDenNgay date,
	@loaiDeTai int,
	@ngayHopHoiDDDNCYSH date
AS
BEGIN
	SET NOCOUNT ON;

	IF @tenDeTai IS NOT NULL
	BEGIN
		SELECT DKDT.DeTaiBenNgoaiID,MaDeTai,TenDeTai,ThoiGianThucHien_Tu,ThoiGianThucHien_Den, TrangThaiDeTaiBenNgoai, LoaiDeTai, ChuNhiemDeTai, NgayHopHĐĐĐNCYSH
		FROM DETAIBENNGOAI_NHANYEUCAU DKDT 
		INNER JOIN FREETEXTTABLE(DETAIBENNGOAI_NHANYEUCAU,TenDeTai,@tenDeTai) as FTS_DKDT
		ON DKDT.DeTaiBenNgoaiID = FTS_DKDT.[KEY]
		AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
		AND (UPPER(LTRIM(RTRIM(DKDT.ChuNhiemDeTai))) LIKE '%' +UPPER(LTRIM(RTRIM(@chuNhiemDeTai)))+ '%' OR @chuNhiemDeTai IS NULL)
		AND (DKDT.LoaiDeTai = @loaiDeTai OR @loaiDeTai IS NULL)
		AND (CONVERT(DATE,DKDT.ThoiGianThucHien_Tu,105) >= CONVERT(DATE,@thucHienTuNgay,105) OR @thucHienTuNgay IS NULL )
		AND (CONVERT(DATE,DKDT.ThoiGianThucHien_Den,105) <= CONVERT(DATE,@thucHienDenNgay,105) OR @thucHienDenNgay IS NULL  )
		AND (DKDT.NgayHopHĐĐĐNCYSH = @ngayHopHoiDDDNCYSH OR @ngayHopHoiDDDNCYSH IS NULL  )
	END
	ELSE
	BEGIN
		SELECT DKDT.DeTaiBenNgoaiID,MaDeTai,TenDeTai,ThoiGianThucHien_Tu,ThoiGianThucHien_Den, TrangThaiDeTaiBenNgoai, LoaiDeTai, ChuNhiemDeTai, NgayHopHĐĐĐNCYSH
		FROM DETAIBENNGOAI_NHANYEUCAU DKDT 		
		WHERE (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
		AND (UPPER(LTRIM(RTRIM(DKDT.ChuNhiemDeTai))) LIKE '%' +UPPER(LTRIM(RTRIM(@chuNhiemDeTai)))+ '%' OR @chuNhiemDeTai IS NULL)
		AND (DKDT.LoaiDeTai = @loaiDeTai OR @loaiDeTai IS NULL)
		AND (CONVERT(DATE,DKDT.ThoiGianThucHien_Tu,105) >= CONVERT(DATE,@thucHienTuNgay,105) OR @thucHienTuNgay IS NULL )
		AND (CONVERT(DATE,DKDT.ThoiGianThucHien_Den,105) <= CONVERT(DATE,@thucHienDenNgay,105) OR @thucHienDenNgay IS NULL  )
		AND (DKDT.NgayHopHĐĐĐNCYSH = @ngayHopHoiDDDNCYSH OR @ngayHopHoiDDDNCYSH IS NULL  )
	END
END
GO
PRINT N'Creating [dbo].[proc_Search_TiepNhanYeuCauXetDuyetDeTai]...';


GO
CREATE PROCEDURE [dbo].[proc_Search_TiepNhanYeuCauXetDuyetDeTai]
	@loaiHoiDong int,
	@phuongThucXetDuyet int,
	@thoiGianXetDuyet date
AS
BEGIN
	SET NOCOUNT ON;
	SELECT YCXD.YeuCauXetDuyetID,ThoiGianXetDuyet,PhuongThucXetDuyet,YCXD.DeTaiID,LoaiHoiDong,TenDeTai,MaDeTai,TrangThaiDeTai
	FROM (SELECT *
		FROM XETDUYETDETAI_YEUCAUXETDUYET
		WHERE (LoaiHoiDong = @loaiHoiDong OR @loaiHoiDong IS NULL)
		AND (PhuongThucXetDuyet = @phuongThucXetDuyet OR @phuongThucXetDuyet IS NULL)
		AND (ThoiGianXetDuyet = @thoiGianXetDuyet OR @thoiGianXetDuyet IS NULL)) YCXD
	INNER JOIN DANGKYDETAI DT ON DT.DeTaiID = YCXD.DeTaiID
END
GO
PRINT N'Creating [dbo].[proc_Search_TuyenChonCapQuanLy]...';


GO
CREATE PROCEDURE [dbo].[proc_Search_TuyenChonCapQuanLy]
	@tenDeTai nvarchar(1000),
	@maDeTai nvarchar(1000),
	@chuNhiemDeTai int,
	@coQuanChuTri nvarchar(1000),
	@thucHienTuNgay date,
	@thucHienDenNgay date,
	@kinhPhiNhoNhat money,
	@kinhPhiLonNhat money
AS
BEGIN
	SET NOCOUNT ON;

	IF @tenDeTai IS NOT NULL
	BEGIN
		SELECT DKDT.DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,KinhPhiThucHien,CoQuanChuTri,MaCanBoThucHien,HoTen,TrangThaiDeTai,TC.TuyenChonCapQuanLyID
		FROM DANGKYDETAI DKDT 
		INNER JOIN FREETEXTTABLE(DANGKYDETAI,TenDeTai,@tenDeTai) as FTS_DKDT
		ON DKDT.DeTaiID = FTS_DKDT.[KEY]
		INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
		INNER JOIN XETDUYETDETAI_TUYENCHONCAPQUANLY TC ON TC.DeTaiID = DKDT.DeTaiID
		AND (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
		AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
		AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
		AND (DKDT.KinhPhiThucHien >= @kinhPhiNhoNhat OR @kinhPhiNhoNhat IS NULL)
		AND (DKDT.KinhPhiThucHien <= @kinhPhiLonNhat OR @kinhPhiLonNhat IS NULL)
		AND (CONVERT(DATE,DKDT.ThucHienTuNgay,105) >= CONVERT(DATE,@thucHienTuNgay,105) OR @thucHienTuNgay IS NULL )
		AND (CONVERT(DATE,DKDT.ThucHienDenNgay,105) <= CONVERT(DATE,@thucHienDenNgay,105) OR @thucHienDenNgay IS NULL  )
	END
	ELSE
	BEGIN
		SELECT DKDT.DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,KinhPhiThucHien,CoQuanChuTri,MaCanBoThucHien,HoTen,TrangThaiDeTai,TC.TuyenChonCapQuanLyID
		FROM DANGKYDETAI DKDT 		
		INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
		INNER JOIN XETDUYETDETAI_TUYENCHONCAPQUANLY TC ON TC.DeTaiID = DKDT.DeTaiID
		WHERE (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
		AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
		AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
		AND (DKDT.KinhPhiThucHien >= @kinhPhiNhoNhat OR @kinhPhiNhoNhat IS NULL)
		AND (DKDT.KinhPhiThucHien <= @kinhPhiLonNhat OR @kinhPhiLonNhat IS NULL)
		AND (CONVERT(DATE,DKDT.ThucHienTuNgay,105) >= CONVERT(DATE,@thucHienTuNgay,105) OR @thucHienTuNgay IS NULL )
		AND (CONVERT(DATE,DKDT.ThucHienDenNgay,105) <= CONVERT(DATE,@thucHienDenNgay,105) OR @thucHienDenNgay IS NULL  )
	END
END
GO
PRINT N'Creating [dbo].[proc_Search_XetDuyetDeTaiTheoQuyTrinh]...';


GO
CREATE PROCEDURE [dbo].[proc_Search_XetDuyetDeTaiTheoQuyTrinh]
	@ngayXetDuyet date,
	@ngayChapThuan date,
	@phuongThucXetDuyet int
AS 
BEGIN
	SET NOCOUNT ON;

	SELECT HoiDongDaoDucID,DT.DeTaiID,MaDeTai,TenDeTai,CBTH.MaCanBoThucHien,CBTH.HoTen as ChuNhiemDeTai,NgayChapThuan,NgayXetDuyet,KetQuaXetDuyet,CoChinhSuaBoSung,TrangThaiDeTai,PhuongThucXetDuyet
	FROM (SELECT HoiDongDaoDucID,XETDUYETDETAI_YEUCAUXETDUYET.DeTaiID,NgayChapThuan,NgayXetDuyet,KetQuaXetDuyet,CoChinhSuaBoSung,XETDUYETDETAI_YEUCAUXETDUYET.PhuongThucXetDuyet
		  FROM XETDUYETDETAI_HOIDONGDAODUC, XETDUYETDETAI_YEUCAUXETDUYET
		  WHERE (@ngayXetDuyet = NgayXetDuyet OR @ngayXetDuyet IS NULL)
		  AND (@ngayChapThuan = NgayChapThuan OR @ngayChapThuan IS NULL)
		  AND (@phuongThucXetDuyet = XETDUYETDETAI_YEUCAUXETDUYET.PhuongThucXetDuyet OR @phuongThucXetDuyet IS NULL)
		  AND (XETDUYETDETAI_HOIDONGDAODUC.DeTaiID = XETDUYETDETAI_YEUCAUXETDUYET.DeTaiID)) HDDD
	LEFT JOIN DANGKYDETAI DT ON HDDD.DeTaiID = DT.DeTaiID
	LEFT JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DT.ChuNhiemDeTaiID		  
END
GO
PRINT N'Creating [dbo].[proc_Search_XetDuyetHoiDongKHKT]...';


GO
CREATE PROCEDURE [dbo].[proc_Search_XetDuyetHoiDongKHKT]
	@tenDeTai nvarchar(1000),
	@maDeTai nvarchar(1000),
	@chuNhiemDeTai int,
	@coQuanChuTri nvarchar(1000),
	@thucHienTuNgay date,
	@thucHienDenNgay date,
	@kinhPhiNhoNhat money,
	@kinhPhiLonNhat money
AS
BEGIN
	SET NOCOUNT ON;

	IF @tenDeTai IS NOT NULL
	BEGIN
		SELECT DISTINCT(XD.XetDuyetHoiDongKHKTID),DKDT.DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,KinhPhiThucHien,CoQuanChuTri,MaCanBoThucHien,HoTen,TrangThaiDeTai
		FROM DANGKYDETAI DKDT 
		INNER JOIN FREETEXTTABLE(DANGKYDETAI,TenDeTai,@tenDeTai) as FTS_DKDT
		ON DKDT.DeTaiID = FTS_DKDT.[KEY]
		INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
		INNER JOIN THUCHIENDETAI_XETDUYETHOIDONGKHKT XD ON XD.DeTaiID = DKDT.DeTaiID
		LEFT JOIN THUCHIENDETAI_XETDUYETHOIDONGKHKT_CHITIET CT ON CT.XetDuyetHoiDongKHKTID = XD.XetDuyetHoiDongKHKTID
		AND (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
		AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
		AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
		AND (DKDT.KinhPhiThucHien >= @kinhPhiNhoNhat OR @kinhPhiNhoNhat IS NULL)
		AND (DKDT.KinhPhiThucHien <= @kinhPhiLonNhat OR @kinhPhiLonNhat IS NULL)
		AND (CONVERT(DATE,DKDT.ThucHienTuNgay,105) >= CONVERT(DATE,@thucHienTuNgay,105) OR @thucHienTuNgay IS NULL )
		AND (CONVERT(DATE,DKDT.ThucHienDenNgay,105) <= CONVERT(DATE,@thucHienDenNgay,105) OR @thucHienDenNgay IS NULL  )
	END
	ELSE
	BEGIN
		SELECT DISTINCT(XD.XetDuyetHoiDongKHKTID),DKDT.DeTaiID,MaDeTai,TenDeTai,ThucHienTuNgay,ThucHienDenNgay,KinhPhiThucHien,CoQuanChuTri,MaCanBoThucHien,HoTen,TrangThaiDeTai
		FROM DANGKYDETAI DKDT 		
		INNER JOIN DANHMUC_CANBOTHUCHIEN CBTH ON CBTH.CanBoThucHienID = DKDT.ChuNhiemDeTaiID
		INNER JOIN THUCHIENDETAI_XETDUYETHOIDONGKHKT XD ON XD.DeTaiID = DKDT.DeTaiID
		LEFT JOIN THUCHIENDETAI_XETDUYETHOIDONGKHKT_CHITIET CT ON CT.XetDuyetHoiDongKHKTID = XD.XetDuyetHoiDongKHKTID
		WHERE (CBTH.CanBoThucHienID = @chuNhiemDeTai OR @chuNhiemDeTai IS NULL)
		AND (UPPER(LTRIM(RTRIM(DKDT.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
		AND (UPPER(LTRIM(RTRIM(DKDT.CoQuanChuTri))) LIKE '%' +UPPER(LTRIM(RTRIM(@coQuanChuTri)))+ '%' OR @coQuanChuTri IS NULL)
		AND (DKDT.KinhPhiThucHien >= @kinhPhiNhoNhat OR @kinhPhiNhoNhat IS NULL)
		AND (DKDT.KinhPhiThucHien <= @kinhPhiLonNhat OR @kinhPhiLonNhat IS NULL)
		AND (CONVERT(DATE,DKDT.ThucHienTuNgay,105) >= CONVERT(DATE,@thucHienTuNgay,105) OR @thucHienTuNgay IS NULL )
		AND (CONVERT(DATE,DKDT.ThucHienDenNgay,105) <= CONVERT(DATE,@thucHienDenNgay,105) OR @thucHienDenNgay IS NULL  )
	END
END
GO
PRINT N'Creating [dbo].[proc_Search_XetDuyetYeuCauLaySoLieu]...';


GO
CREATE PROCEDURE [dbo].[proc_Search_XetDuyetYeuCauLaySoLieu]
	@ngayChapThuan date,
	@phuongThucXetDuyet nvarchar(1000),
	@ngayXetDuyet date,
	@tenDeTai nvarchar(1000), 
	@maDeTai nvarchar(1000),
	@chuNhiemDeTai nvarchar(1000)
AS
BEGIN
	SET NOCOUNT ON;

	IF (@tenDeTai IS NOT NULL)
	BEGIN 
		SELECT XD.XetDuyetHDDDID,NgayChapThuan,PhuongThucXetDuyet, NgayXetDuyet, XD.DeTaiBenNgoaiID ,TenDeTai ,MaDeTai , TrangThaiDeTaiBenNgoai , ChuNhiemDeTai
		FROM FREETEXTTABLE(DETAIBENNGOAI_NHANYEUCAU,TenDeTai,@tenDeTai) as FTS_DKDT
		INNER JOIN DETAIBENNGOAI_NHANYEUCAU NYC ON NYC.DeTaiBenNgoaiID = FTS_DKDT.[KEY]
		INNER JOIN DETAIBENNGOAI_XETDUYET_HDDAODUC XD ON XD.DeTaiBenNgoaiID = NYC.DeTaiBenNgoaiID
		AND (UPPER(LTRIM(RTRIM(NYC.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
		AND (UPPER(LTRIM(RTRIM(NYC.ChuNhiemDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@chuNhiemDeTai)))+'%' OR @chuNhiemDeTai IS NULL)  	
		AND (UPPER(LTRIM(RTRIM(XD.PhuongThucXetDuyet))) LIKE '%'+UPPER(LTRIM(RTRIM(@phuongThucXetDuyet)))+'%' OR @phuongThucXetDuyet IS NULL)  
		AND (NgayXetDuyet = @ngayXetDuyet OR @ngayXetDuyet IS NULL)
		AND (NgayChapThuan = @ngayChapThuan OR @ngayChapThuan IS NULL)
	END
	ELSE
	BEGIN
		SELECT XD.XetDuyetHDDDID,NgayChapThuan,PhuongThucXetDuyet, NgayXetDuyet, XD.DeTaiBenNgoaiID ,TenDeTai ,MaDeTai , TrangThaiDeTaiBenNgoai , ChuNhiemDeTai
		FROM DETAIBENNGOAI_NHANYEUCAU NYC 
		INNER JOIN DETAIBENNGOAI_XETDUYET_HDDAODUC XD ON XD.DeTaiBenNgoaiID = NYC.DeTaiBenNgoaiID
		AND (UPPER(LTRIM(RTRIM(NYC.MaDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@maDeTai)))+'%' OR @maDeTai IS NULL)  	
		AND (UPPER(LTRIM(RTRIM(NYC.ChuNhiemDeTai))) LIKE '%'+UPPER(LTRIM(RTRIM(@chuNhiemDeTai)))+'%' OR @chuNhiemDeTai IS NULL)  	
		AND (UPPER(LTRIM(RTRIM(XD.PhuongThucXetDuyet))) LIKE '%'+UPPER(LTRIM(RTRIM(@phuongThucXetDuyet)))+'%' OR @phuongThucXetDuyet IS NULL)  
		AND (NgayXetDuyet = @ngayXetDuyet OR @ngayXetDuyet IS NULL)
		AND (NgayChapThuan = @ngayChapThuan OR @ngayChapThuan IS NULL)
	END
END
GO
PRINT N'Creating [dbo].[proc_SearchCuocHop]...';


GO
CREATE PROC dbo.proc_SearchCuocHop
    @LoaiHoiDong NVARCHAR(50)
	,@MaHoiDong NVARCHAR(1000)
	,@ThoiGian NVARCHAR(50)
	,@DiaDiem NVARCHAR(1000)
	,@LoaiXetDuyet NVARCHAR(50)
AS
	DECLARE @str nvarchar(max)=''
			,@strLoaiHoiDong NVARCHAR(1000)=''
			,@strMaHoiDong NVARCHAR(1000)=''
			,@strThoiGian NVARCHAR(1000)=''
			,@strDiaDiem NVARCHAR(1000)=''
			,@strLoaiXetDuyet NVARCHAR(1000)=''
	IF(@LoaiHoiDong!='')
	BEGIN
		SET @strLoaiHoiDong= ' AND LoaiHoiDong IN('+@LoaiHoiDong+')'
	END
	IF(@MaHoiDong!='')
	BEGIN
		SET @strMaHoiDong= ' AND MaHoiDong like'''+@MaHoiDong+''''
	END
	IF(@ThoiGian!='')
	BEGIN
		SET @strThoiGian=' AND CONVERT(date,ThoiGian,103) LIKE CONVERT(date,'''+ @ThoiGian +''',103) '
	END
	IF(@DiaDiem!='')
	BEGIN
		SET @strDiaDiem=' AND DiaDiem LIKE '''+@DiaDiem+'%'''
	END
	IF(@LoaiXetDuyet!='')
	BEGIN
		SET @strLoaiXetDuyet=' AND LoaiXetDuyetID='+@LoaiXetDuyet
	END
	SET @str='SELECT distinct CuocHopID,a.HoiDongID,B.MaHoiDong,ThoiGian,DiaDiem,LoaiXetDuyetID,C.LoaiHoiDong,B.TrangThaiHD '
	SET @str+=' FROM(SELECT * FROM HOIDONG_CHUANBI_CUOCHOP NOLOCK'
	SET @str+=' WHERE 1=1 '+ @strLoaiXetDuyet+@strThoiGian+@strDiaDiem+' ) AS A'
	SET @str+=' INNER JOIN(SELECT * FROM HOIDONG_CHONLUA NOLOCK WHERE 1=1'+ @strLoaiHoiDong+') AS C ON C.HoiDongID=A.HoiDongID'
	SET @str+=' INNER JOIN(SELECT * FROM HOIDONG_YEUCAU_XETDUYET NOLOCK WHERE 1=1 '+@strMaHoiDong+') AS B ON B.HoiDongID=C.HoiDongID ORDER BY LoaiHoiDong,MaHoiDong,ThoiGian'
	exec(@str)
GO
PRINT N'Creating [dbo].[proc_SearchDanhSachDuyetBaiDangKy]...';


GO
CREATE PROCEDURE [dbo].[proc_SearchDanhSachDuyetBaiDangKy]
	@HoiNghiID NVARCHAR(50)
	,@KetQuaDuyetBai NVARCHAR(50)
	,@NgayNhan NVARCHAR(50)
AS
	declare @str nvarchar(max), @strHoiNghiID NVARCHAR(1000)='',@strKetQuaDuyetBai NVARCHAR(1000)='',@strNgayNhan NVARCHAR(1000)=''
	IF(@HoiNghiID!='')
	BEGIN
		SET @strHoiNghiID=' AND HoiNghiID='+@HoiNghiID
	END
	IF(@KetQuaDuyetBai!='')
	BEGIN
		SET @strKetQuaDuyetBai=' AND Duyet='+@KetQuaDuyetBai 
	END
	IF(@NgayNhan!='')
	BEGIN
		SET @strNgayNhan=' AND CONVERT(date,NgayNhan,103) LIKE CONVERT(date,'''+ @NgayNhan +''',103) '
	END

	SET @str= ' SELECT A.*,B.MaHoiNGhi,B.TenHoiNghi,B.ThoiGianTu,B.ThoiGianDen,B.TrangThaiHoiNghi FROM(SELECT * FROM HOINGHI_DUYEBAIDANGKY NOLOCK WHERE 1=1 '+ @strHoiNghiID+@strKetQuaDuyetBai+@strNgayNhan+' ) AS A '
	SET @str+=' INNER JOIN(SELECT * FROM HOINGHI_TOCHUCMODOT NOLOCK) AS B ON B.HoiNghiID=A.HoiNghiID ORDER BY NgayNhan DESC '
	exec(@str)
GO
PRINT N'Creating [dbo].[proc_SearchGhiNhanKetQua]...';


GO
CREATE PROC proc_SearchGhiNhanKetQua
		 @LoaiHoiDong NVARCHAR(50)
	,@MaHoiDong NVARCHAR(1000)
	,@ThoiGian NVARCHAR(50)
	,@DiaDiem NVARCHAR(1000)

AS
	DECLARE @str nvarchar(max)=''
			,@strLoaiHoiDong NVARCHAR(1000)=''
			,@strMaHoiDong NVARCHAR(1000)=''
			,@strThoiGian NVARCHAR(1000)=''
			,@strDiaDiem NVARCHAR(1000)=''
		
	IF(@LoaiHoiDong!='')
	BEGIN
		SET @strLoaiHoiDong= ' AND LoaiHoiDong IN('+@LoaiHoiDong+')'
	END
	IF(@MaHoiDong!='')
	BEGIN
		SET @strMaHoiDong= ' AND MaHoiDong like'''+@MaHoiDong+''''
	END
	IF(@ThoiGian!='')
	BEGIN
		SET @strThoiGian=' AND CONVERT(date,ThoiGian,103) LIKE CONVERT(date,'''+ @ThoiGian +''',103) '
	END
	IF(@DiaDiem!='')
	BEGIN
		SET @strDiaDiem=' AND DiaDiem LIKE '''+@DiaDiem+'%'''
	END

	SET @str='SELECT distinct GhiNhanKetQuaID,A.ThoiGian,A.DiaDiem,A.KetLuan,A.HoiDongID,MaHoiDong,LoaiHoiDong ,DoiTuongXetDuyet,B.TrangThaiHD '
	SET @str+=' FROM(SELECT * FROM HOIDONG_GHINHAN_KETQUA NOLOCK'
	SET @str+=' WHERE 1=1 '+@strThoiGian+@strDiaDiem+' ) AS A'
	SET  @str+=' INNER JOIN(SELECT * FROM HOIDONG_CHUANBI_CUOCHOP NOLOCK ) AS B1 ON B1.HoiDongID=A.HoiDongID '
	SET @str+=' INNER JOIN(SELECT * FROM HOIDONG_CHONLUA NOLOCK WHERE 1=1'+ @strLoaiHoiDong+') AS C ON C.HoiDongID=B1.HoiDongID'
	SET @str+=' INNER JOIN(SELECT * FROM HOIDONG_YEUCAU_XETDUYET NOLOCK WHERE 1=1 '+@strMaHoiDong+') AS B ON B.HoiDongID=C.HoiDongID ORDER BY LoaiHoiDong,MaHoiDong,ThoiGian'
	exec(@str)
GO
PRINT N'Creating [dbo].[proc_SearchHoiDong_YeuCau_XetDuyet]...';


GO
CREATE PROC proc_SearchHoiDong_YeuCau_XetDuyet
	@LoaiHoSo int
	,@DoiTuongXetDuyet NVARCHAR(1000)
	,@DayDuHoSo int
	,@KhoaPhong int
	,@MaHoiDong NVARCHAR(1000)
	,@ThoiGianDangKy date
AS
BEGIN
	
	IF @DayDuHoSo IS NULL
		SET @DayDuHoSo = 2
	IF @DayDuHoSo = 2
		SELECT *
		FROM HOIDONG_YEUCAU_XETDUYET xd
		WHERE (UPPER(LTRIM(RTRIM(xd.DoiTuongXetDuyet))) LIKE '%'+UPPER(LTRIM(RTRIM(@DoiTuongXetDuyet)))+'%' OR @DoiTuongXetDuyet IS NULL)  	
		AND (xd.DMLoaiHoSoID = @LoaiHoSo OR @LoaiHoSo IS NULL)
		AND (xd.DMKhoaPhongID = @KhoaPhong or @KhoaPhong is null)
		and (UPPER(LTRIM(RTRIM(xd.MaHoiDong))) LIKE '%'+UPPER(LTRIM(RTRIM(@MaHoiDong)))+'%' OR @MaHoiDong IS NULL)  
		and (xd.ThoiGianDangKy = @ThoiGianDangKy or @ThoiGianDangKy is null)	

	IF @DayDuHoSo = 1
		SELECT *
		FROM HOIDONG_YEUCAU_XETDUYET xd
		WHERE (UPPER(LTRIM(RTRIM(xd.DoiTuongXetDuyet))) LIKE '%'+UPPER(LTRIM(RTRIM(@DoiTuongXetDuyet)))+'%' OR @DoiTuongXetDuyet IS NULL)  	
		AND (xd.DMLoaiHoSoID = @LoaiHoSo OR @LoaiHoSo IS NULL)
		AND (xd.DMKhoaPhongID = @KhoaPhong or @KhoaPhong is null)
		and (UPPER(LTRIM(RTRIM(xd.MaHoiDong))) LIKE '%'+UPPER(LTRIM(RTRIM(@MaHoiDong)))+'%' OR @MaHoiDong IS NULL)  
		and (xd.ThoiGianDangKy = @ThoiGianDangKy or @ThoiGianDangKy is null)	
		and (xd.DayDuHoSo = 1)

	IF @DayDuHoSo = 0
		SELECT *
		FROM HOIDONG_YEUCAU_XETDUYET xd
		WHERE (UPPER(LTRIM(RTRIM(xd.DoiTuongXetDuyet))) LIKE '%'+UPPER(LTRIM(RTRIM(@DoiTuongXetDuyet)))+'%' OR @DoiTuongXetDuyet IS NULL)  	
		AND (xd.DMLoaiHoSoID = @LoaiHoSo OR @LoaiHoSo IS NULL)
		AND (xd.DMKhoaPhongID = @KhoaPhong or @KhoaPhong is null)
		and (UPPER(LTRIM(RTRIM(xd.MaHoiDong))) LIKE '%'+UPPER(LTRIM(RTRIM(@MaHoiDong)))+'%' OR @MaHoiDong IS NULL)  
		and (xd.ThoiGianDangKy = @ThoiGianDangKy or @ThoiGianDangKy is null)	
		and (xd.DayDuHoSo = 0)

END
GO
PRINT N'Creating [dbo].[proc_SearchHoiDongLuaChon]...';


GO
CREATE PROC proc_SearchHoiDongLuaChon
	 @LoaiHoiDong NVARCHAR(50)
	,@NgayThanhLap NVARCHAR(50)
AS
DECLARE @str NVARCHAR(MAX)='',@strLoaiHD NVARCHAR(1000)='',@strNgayThanhLap NVARCHAR(1000)=''
IF(@LoaiHoiDong!='')
	SET @strLoaiHD=' AND LoaiHoiDong IN ('+@LoaiHoiDong+')'
IF(@NgayThanhLap!='')
	SET @strNgayThanhLap=' AND CONVERT(date,NgayThanhLap,103) LIKE CONVERT(DATE,'''+ @NgayThanhLap +''',103) '
SET @str='SELECT A.*,iSNULL(MaHoiDong,'''') MaHoiDong,DoiTuongXetDuyet,B.DMKhoaPhongID,B.DMLoaiHoSoID,B.TrangThaiHD FROM (SELECT * FROM HOIDONG_CHONLUA NOLOCK WHERE 1=1 '
+@strLoaiHD +@strNgayThanhLap+ ' ) AS A INNER JOIN(SELECT * FROM HOIDONG_YEUCAU_XETDUYET NOLOCK)AS B ON B.HoiDongID=A.HoiDongID ORDER BY NgayThanhLap ,MaHoiDong'
EXEC (@str)
GO
PRINT N'Creating [dbo].[proc_SearchHoiDongNhiemKy]...';


GO
CREATE PROC proc_SearchHoiDongNhiemKy
    @LoaiHoiDong VARCHAR(50)
	,@NhiemKyTu VARCHAR(50)
	,@NhiemKyDen VARCHAR(50)
	,@NgayThanhLap VARCHAR(50)
	,@MaHoiDong NVARCHAR(1000)
AS
	DECLARE @strQuery NVARCHAR(MAX)=''
	,@strNhiemKyTu NVARCHAR(1000)='',@strNhiemKyDen NVARCHAR(1000)=''
	,@strNgayThanhLap NVARCHAR(1000)='',@strMaHoiDong NVARCHAR(1000)=''
	---------------
	IF(@NhiemKyTu!='')
	BEGIN
		SET @strNhiemKyTu= ' AND convert(DATE,ISNULL(NhiemKy_Tu,''''),103) >= CONVERT(DATE,'''+@NhiemKyTu+''',103)'
	END
	IF(@NhiemKyDen!='')
	BEGIN
		SET @strNhiemKyDen= ' AND convert(DATE,ISNULL(NhiemKy_Den,''''),103) <=CONVERT(DATE,'''+@NhiemKyDen+''',103)'
	END
	IF(@NgayThanhLap!='')
	BEGIN
		SET @strNgayThanhLap= ' AND  convert(DATE,ISNULL(NgayThanhLap,''''),103) = CONVERT(DATE,''' +@NgayThanhLap+''',103)'
	END
	IF(@MaHoiDong!='')
		SET @strMaHoiDong= ' AND ISNULL(MaHoiDong,'''') LIKE'''+@MaHoiDong+'%'''
	SET @strQuery=' SELECT * FROM HOIDONG_NHIEMKY NOLOCK WHERE LoaiHoiDong in('+@LoaiHoiDong+')'
		+@strNhiemKyTu+@strNhiemKyDen+@strNgayThanhLap+@strMaHoiDong+' ORDER BY LoaiHoiDong,NhiemKy_Tu'
	EXEC( @strQuery)
GO
PRINT N'Creating [dbo].[proc_SearchHoiDongNhiemKybyID]...';


GO
CREATE PROC proc_SearchHoiDongNhiemKybyID
	@ID int
	
AS
	SELECT A.ThanhVienNhiemKyID,MaThanhVien
	       ,TenThanhVien,ThongTinLienLac,ChucVuID 
		   ,'' TenChucVu,NoiCongTac,NhiemVuTrongHD,HDNhiemKyID
	 FROM(SELECT * FROM HOIDONG_NHIEMKY_CHITIET NOLOCK WHERE HDNhiemKyID=@ID) AS A
	INNER JOIN(SELECT * FROM DANHMUC_HOIDONG_NHIEMKY_THANHVIEN NOLOCK)AS B ON B.ThanhVienNhiemKyID=A.ThanhVienNhiemKyID
GO
PRINT N'Creating [dbo].[proc_SearchHoiNghi]...';


GO
CREATE PROCEDURE [dbo].[proc_SearchHoiNghi]
     @MaHoiNghi VARCHAR(50)
	,@TenHoiNghi VARCHAR(50)
	,@ThoiGianTu VARCHAR(50)
	,@ThoiGianDen VARCHAR(50)
AS
	DECLARE @strQuery NVARCHAR(MAX)=''
	,@strMaHoiNghi NVARCHAR(1000)='',@strTenHoiNghi NVARCHAR(1000)=''
	,@strThoiGianTu NVARCHAR(1000)='',@strThoiGianDen NVARCHAR(1000)=''
	---------------
	IF(@MaHoiNghi!='')
	BEGIN
		SET @strMaHoiNghi=  ' AND ISNULL(MaHoiNghi,'''') LIKE'''+@MaHoiNghi+'%'''
	END
	IF(@TenHoiNghi!='')
	BEGIN
		SET @strTenHoiNghi= ' AND ISNULL(TenHoiNghi,'''') LIKE'''+@TenHoiNghi+'%'''
	END
	IF(@ThoiGianTu!='')
	BEGIN
		SET @strThoiGianTu=' AND convert(DATE,ISNULL(ThoiGianTu,''''),103) >= CONVERT(DATE,'''+@ThoiGianTu+''',103)'
	END
	IF(@ThoiGianDen!='')
		SET @strThoiGianDen=  ' AND convert(DATE,ISNULL(ThoiGianDen,''''),103) <=CONVERT(DATE,'''+@ThoiGianDen+''',103)'

	SET @strQuery=' SELECT * FROM HOINGHI_TOCHUCMODOT NOLOCK WHERE 1=1 '
		+@strMaHoiNghi+@strTenHoiNghi+@strThoiGianTu+@strThoiGianTu+' ORDER BY ThoiGianDen,ThoiGianTu DESC'
	exec( @strQuery)
GO
PRINT N'Creating [dbo].[proc_SearchHoiNghi_DangKy]...';


GO
CREATE PROCEDURE [dbo].[proc_SearchHoiNghi_DangKy]
		@TenBai NVARCHAR(1000)
	,@ChuyenKhoa NVARCHAR(1000)
	,@BaoCaoVien NVARCHAR(1000)
	,@SoDt NVARCHAR(1000)
	,@KhoaPhongID NVARCHAR(1000)
	,@LoaiBaoCao NVARCHAR(100)
	,@HoiNghi NVARCHAR(100)
	,@DangTapChi NVARCHAR(100)
	,@TapChiDang NVARCHAR(100)
AS
	declare @str nvarchar(max),
		 @strTenBai NVARCHAR(1000)='',@strChuyenKhoa NVARCHAR(1000)='',@strBaoCaoVien NVARCHAR(1000)=''
		,@strSoDt NVARCHAR(1000)='',@strKhoaPhongID NVARCHAR(1000)=''
		,@strLoaiBaoCao NVARCHAR(100)='',@strHoiNghi NVARCHAR(100)=''
		,@strDangTapChi NVARCHAR(100)='',@strTapChiDang NVARCHAR(100)=''
	IF(@TenBai !='')
	BEGIN 
		SET @strTenBai=' AND ISNULL(TenBai,'''') LIKE'''+ @TenBai+'%'''
	END
	IF(@ChuyenKhoa !='')
	BEGIN
		SET @strChuyenKhoa=' AND ISNULL(ChuyenKhoa,'''') LIKE'''+ @strChuyenKhoa+'%'''
	END
	IF(@BaoCaoVien !='')
	BEGIN 
		SET @strBaoCaoVien=' AND ISNULL(BaoCaoVien,'''') LIKE'''+ @BaoCaoVien+'%'''
	 END
	IF(@SoDt !='')
	BEGIN 
		SET @strSoDt=' AND ISNULL(SoDt_BCV,'''') LIKE'''+ @SoDt+'%'''
	END
	IF(@KhoaPhongID !='')
	BEGIN
		SET @strKhoaPhongID=' AND ISNULL(DMKhoaPhongID,'''') ='+ @KhoaPhongID 
	 END
	IF(@LoaiBaoCao !='')
	BEGIN 
		SET @strLoaiBaoCao=' AND ISNULL(LoaiBaoCao,'''') in ('+ @LoaiBaoCao+')' 
	 END
	IF(@HoiNghi !='')
	BEGIN 
		SET @strHoiNghi=' AND ISNULL(HoiNghiID,'''') ='+ @HoiNghi
	END
	IF(@DangTapChi !='')
	BEGIN 
	   SET @strDangTapChi=' AND ISNULL(DangTapChi,'''') in ('+ @DangTapChi +')'
	 END
	IF(@TapChiDang !='')
	BEGIN
		SET @strTapChiDang=' AND ISNULL(TapChiDang,'''') in ('+ @TapChiDang +')'
	END
	SET @str=' SELECT A.*,B.TrangThaiHoiNghi FROM ('
	SET @str+=' SELECT * FROM HOINGHI_DANGKY NOLOCK  WHERE 1 =1 '
		   +@strTenBai
			+@strChuyenKhoa
			+@strBaoCaoVien
			+@strSoDt
			+@strKhoaPhongID
			+@strLoaiBaoCao
			+@strHoiNghi
			+@strDangTapChi
		+@strTapChiDang +') AS A INNER JOIN(SELECT * FROM HOINGHI_TOCHUCMODOT NOLOCK WHERE 1=1 '+@strHoiNghi+' ) AS B ON B.HoiNghiID=A.HoiNghiID ORDER BY TenBai,ChuyenKhoa,DMKhoaPhongID'
EXEC (@str)
GO
PRINT N'Creating [dbo].[proc_SearchHoiNghi_GhiNhanKetQua]...';


GO
CREATE PROCEDURE [dbo].[proc_SearchHoiNghi_GhiNhanKetQua]
   @HoiNghiID NVARCHAR(100)
	,@NgayGhiNhan nvarchar(100)
AS
IF(ISDATE(@NgayGhiNhan)>0)
	  SET @NgayGhiNhan=CONVERT(DATE,@NgayGhiNhan,103)
ELSE
	 SET @NgayGhiNhan='%'
SELECT *,B.TrangThaiHoiNghi FROM(
 SELECT * FROM HOINGHI_GHINHANKETQUA NOLOCK WHERE HoiNghiID LIKE @HoiNghiID AND convert(date,NgayGhiNhan,103) LIKE @NgayGhiNhan) AS A
 INNER JOIN(SELECT * FROM HOINGHI_TOCHUCMODOT NOLOCK WHERE  HoiNghiID LIKE @HoiNghiID) AS B ON B.HoiNghiID=A.HoiNghiID
  ORDER BY A.HoiNghiID,NgayGhiNhan DESC
GO
PRINT N'Creating [dbo].[proc_SearchHoiNghi_GuiBaiDangKy]...';


GO
CREATE PROC dbo.proc_SearchHoiNghi_GuiBaiDangKy
	@HoiNghiID NVARCHAR(100)
	,@DMKhoaPhongID NVARCHAR(100)
	,@NguoiNhan NVARCHAR(100)
	,@NgayGui nvarchar(100)
AS
IF(ISDATE(@NgayGui)>0)
	  SET @NgayGui=CONVERT(DATE,@NgayGui,103)
ELSE
	 SET @NgayGui='%'
SELECT A.*,B.TrangThaiHoiNghi FROM(
	 SELECT * FROM HOINGHI_GUIBAIDANGKY NOLOCK WHERE HoiNghiID LIKE @HoiNghiID AND DMKhoaPhongID LIKE @DMKhoaPhongID 
	 AND NguoiNhan LIKE @NguoiNhan AND convert(date,NgayGui,103) LIKE  @NgayGui) AS A
	 INNER JOIN(SELECT * FROM HOINGHI_TOCHUCMODOT NOLOCK) AS B ON B.HoiNghiID=A.HoiNghiID ORDER BY A.HoiNghiID,NgayGui DESC
GO
PRINT N'Creating [dbo].[proc_SearchHoiNghi_LapChuongTrinh]...';


GO
CREATE PROC dbo.proc_SearchHoiNghi_LapChuongTrinh
	 @HoiNghiID NVARCHAR(100)
	,@Ngay nvarchar(100)
AS
	IF(ISDATE(@Ngay)>0)
		  SET @Ngay=CONVERT(DATE,@Ngay,103)
	ELSE
		 SET @Ngay='%'
	SELECT A.*,B.TrangThaiHoiNghi FROM(
	SELECT * FROM HOINGHI_LAPCHUONGTRINH NOLOCK WHERE HoiNghiID LIKE @HoiNghiID AND Ngay LIKE @Ngay) AS A
	INNER JOIN(SELECT *FROM HOINGHI_TOCHUCMODOT NOLOCK) AS B ON B.HoiNghiID=A.HoiNghiID
	 ORDER BY Ngay DESC
GO
PRINT N'Creating [dbo].[proc_ThongTinHoiDong]...';


GO

CREATE PROC proc_ThongTinHoiDong
	@HoiDongID INT
AS
SELECT DISTINCT A.*,B.TenLoaiHoSo,C.TenKhoaPhong,CONVERT(NVARCHAR(50),A.ThoiGianDangKy,103) NgayDangKy FROM
(
	SELECT * FROM HOIDONG_YEUCAU_XETDUYET nolock WHERE HoiDongID=@HoiDongID)A
	INNER JOIN(SELECT * FROM DANHMUC_LOAIHOSO NOLOCK)AS B ON B.DMLoaiHoSoID=A.DMLoaiHoSoID
	INNER JOIN(SELECT * FROM DANHMUC_KHOAPHONG NOLOCK) AS C ON C.DMKhoaPhongID=A.DMKhoaPhongID
GO
PRINT N'Creating [dbo].[proc_TrangThaiDeTai]...';


GO
create procedure proc_TrangThaiDeTai
	@id int
as
begin
	--PhieuDanhGiaKetQuaDeTai 12
	--BangNhanXetKetQuaNghienCuuDeTai 11
	--HoiDongNghiemThu 10
	--BaoCaoKetQua 9
	--GiaHanDeTai 8
	--BaoCaoDinhKy 7
	--HopDongKhoaHocCongNghe 6
	--QuyetDinhPheDuyetDeTai 5
	--DiemDanhGia 4
	--BangKiemLuaChonQuyTrinh 3
	--HoiDongNghienCuu 2
	--ThongTinDeTai 1
	set nocount on;
	declare @code int = 0;
	set @code = [dbo].[check_status] (@id)
	declare @status nvarchar(100);
	set @status = (
		case
		when @code = 1 then N'Thông tin đề tài'
		when @code = 2 then N'Hội đồng nghiên cứu'
		when @code = 3 then N'Bảng kiểm lựa chọn quy trình'
		when @code = 4 then N'Điểm đánh giá'
		when @code = 5 then N'Quyết định phê duyệt đề tài'
		--when @code = 6 then N'Hợp đồng khoa học công nghệ'
		--when @code = 7 then N'Báo cáo định kỳ'
		--when @code = 8 then N'Gia hạn đề tài'		
		when @code = 9 then N'Báo cáo kết quả'
		when @code = 10 then N'Hội đồng nghiệm thu'
		when @code = 11 then N'Bảng nhận xét kết quả nghiên cứu'
		when @code = 12 then N'Phiếu đánh giá kết quả nghiên cứu'
	end)
	select @status as TrangThaiDeTai
end
GO
PRINT N'Creating [dbo].[proc_UpdateTrangThaiHoiDong]...';


GO
CREATE PROCEDURE [dbo].[proc_UpdateTrangThaiHoiDong]
	@HoiDongID INT
	,@TrangThaiHD INT
AS
	UPDATE HOIDONG_YEUCAU_XETDUYET SET TrangThaiHD=@TrangThaiHD WHERE HoiDongID=@HoiDongID
GO
PRINT N'Creating [dbo].[proc_UpdateTrangThaiHoiNghi]...';


GO
CREATE PROCEDURE proc_UpdateTrangThaiHoiNghi
	@HoiNghiID INT
	,@TrangThaiHoiNghi INT
AS
	UPDATE HOINGHI_TOCHUCMODOT SET TrangThaiHoiNghi=@TrangThaiHoiNghi WHERE HoiNghiID=@HoiNghiID
GO
-- Refactoring step to update target server with deployed transaction logs

IF OBJECT_ID(N'dbo.__RefactorLog') IS NULL
BEGIN
    CREATE TABLE [dbo].[__RefactorLog] (OperationKey UNIQUEIDENTIFIER NOT NULL PRIMARY KEY)
    EXEC sp_addextendedproperty N'microsoft_database_tools_support', N'refactoring log', N'schema', N'dbo', N'table', N'__RefactorLog'
END
GO
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'acb58afb-167f-4567-9aa9-52e21323ca74')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('acb58afb-167f-4567-9aa9-52e21323ca74')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '500d42ac-5600-4bf2-ac77-05ee87800ce0')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('500d42ac-5600-4bf2-ac77-05ee87800ce0')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '2d2a6abf-11fa-4eb3-a570-3d2320a2d105')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('2d2a6abf-11fa-4eb3-a570-3d2320a2d105')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'fded4d38-70d1-4d2a-8314-3ff56c9a49c9')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('fded4d38-70d1-4d2a-8314-3ff56c9a49c9')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'fcf52f97-1222-4925-a96a-b9bef7a227c2')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('fcf52f97-1222-4925-a96a-b9bef7a227c2')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'eba07aad-91d1-4ea8-a508-e8f2266dcb21')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('eba07aad-91d1-4ea8-a508-e8f2266dcb21')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '8a982070-837d-40f1-8b3c-d0dfc2ec07c7')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('8a982070-837d-40f1-8b3c-d0dfc2ec07c7')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'f113d15f-e91d-4056-84cc-86b791b1c7df')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('f113d15f-e91d-4056-84cc-86b791b1c7df')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '72cee34b-20ab-4b52-82a1-43ce9dabc402')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('72cee34b-20ab-4b52-82a1-43ce9dabc402')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '79772c3e-e642-4a93-a12a-437f6275f275')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('79772c3e-e642-4a93-a12a-437f6275f275')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '589469ef-1b0e-4e01-85c9-a923a5388d31')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('589469ef-1b0e-4e01-85c9-a923a5388d31')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '9279e0c8-03dc-4945-bdd9-734c45eb8b6a')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('9279e0c8-03dc-4945-bdd9-734c45eb8b6a')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '4b37ec58-156b-443d-b431-2792feada459')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('4b37ec58-156b-443d-b431-2792feada459')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'f7fd76ef-ffe6-46a7-bfc7-c7b51ad1731a')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('f7fd76ef-ffe6-46a7-bfc7-c7b51ad1731a')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '8dbddace-088d-4391-9968-5fd850ed6eb4')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('8dbddace-088d-4391-9968-5fd850ed6eb4')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '887442ac-ce69-41b2-a377-03baf7a68584')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('887442ac-ce69-41b2-a377-03baf7a68584')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '15f0c7b7-6241-4e54-873c-19977bddac99')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('15f0c7b7-6241-4e54-873c-19977bddac99')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '4b4e10fa-60ff-4971-8687-c3e63259ff87')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('4b4e10fa-60ff-4971-8687-c3e63259ff87')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'a0b415d9-5d0c-47ef-b7e1-5b72ad4e8549')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('a0b415d9-5d0c-47ef-b7e1-5b72ad4e8549')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '10866b43-8b2d-4430-966d-f29e6cb84741')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('10866b43-8b2d-4430-966d-f29e6cb84741')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'ff5c46a6-0d30-4c3d-b65e-c30d5fcc9b56')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('ff5c46a6-0d30-4c3d-b65e-c30d5fcc9b56')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'cf2048c4-71f5-41de-b627-0f1f9fe4c01c')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('cf2048c4-71f5-41de-b627-0f1f9fe4c01c')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '2afe0eb5-b6fb-4143-8d8b-d8b1a3d6df4e')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('2afe0eb5-b6fb-4143-8d8b-d8b1a3d6df4e')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '1afea307-f968-4fdc-a99f-3c1b57c60825')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('1afea307-f968-4fdc-a99f-3c1b57c60825')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '305b708f-1acf-44d3-9317-f4db621c5390')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('305b708f-1acf-44d3-9317-f4db621c5390')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'ac0b4f29-873a-44df-9775-23abd667f50c')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('ac0b4f29-873a-44df-9775-23abd667f50c')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'bda74bdb-6d7a-4d40-aba4-0f2ff1f20696')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('bda74bdb-6d7a-4d40-aba4-0f2ff1f20696')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'da4ed208-3d18-4416-ac7b-f25b87edd474')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('da4ed208-3d18-4416-ac7b-f25b87edd474')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '5daa5b7a-f378-4de7-ac9a-185125663ca6')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('5daa5b7a-f378-4de7-ac9a-185125663ca6')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '69793c45-3587-44c7-895e-913084109628')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('69793c45-3587-44c7-895e-913084109628')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '645b3855-dd31-4678-b437-1983709ada8b')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('645b3855-dd31-4678-b437-1983709ada8b')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '5e90bb7c-c90e-4c01-925f-4bdc8970d914')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('5e90bb7c-c90e-4c01-925f-4bdc8970d914')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'd3cf1e9b-0314-4d74-996b-0e1fab74b7d8')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('d3cf1e9b-0314-4d74-996b-0e1fab74b7d8')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '40a58457-2c21-479e-8a93-b4cddad135fc')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('40a58457-2c21-479e-8a93-b4cddad135fc')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'a7e02507-70d1-4737-98f1-00ad76d7c9d7')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('a7e02507-70d1-4737-98f1-00ad76d7c9d7')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '0423bd8d-8f38-4c9b-a7ff-0e77678f7bed')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('0423bd8d-8f38-4c9b-a7ff-0e77678f7bed')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '2bcbd8be-3b8c-45f5-a81c-80c4c96c9087')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('2bcbd8be-3b8c-45f5-a81c-80c4c96c9087')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '5014e825-1b17-4919-8e91-ecf0ab603d31')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('5014e825-1b17-4919-8e91-ecf0ab603d31')

GO

GO
DECLARE @VarDecimalSupported AS BIT;

SELECT @VarDecimalSupported = 0;

IF ((ServerProperty(N'EngineEdition') = 3)
    AND (((@@microsoftversion / power(2, 24) = 9)
          AND (@@microsoftversion & 0xffff >= 3024))
         OR ((@@microsoftversion / power(2, 24) = 10)
             AND (@@microsoftversion & 0xffff >= 1600))))
    SELECT @VarDecimalSupported = 1;

IF (@VarDecimalSupported > 0)
    BEGIN
        EXECUTE sp_db_vardecimal_storage_format N'$(DatabaseName)', 'ON';
    END


GO
PRINT N'Update complete.';


GO
